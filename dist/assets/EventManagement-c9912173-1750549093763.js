import{u as e,j as t}from"./index-a37bae51-1750549093763.js";import{r as s}from"./vendor-18e24f2a-1750549093763.js";import{s as l}from"./storage-afc0bc2e-1750549093763.js";import{c as n}from"./dateUtils-d91f8443-1750549093763.js";import{P as a,r,i,p as o,C as d}from"./icons-6c88ec70-1750549093763.js";import"./routing-b3bac0e0-1750549093763.js";import"./supabase-195fc627-1750549093763.js";const c=({children:n})=>{const{user:r}=e(),[i,o]=s.useState([]),[d,c]=s.useState([]),[m,u]=s.useState(!1),[h,g]=s.useState("active");s.useEffect(()=>{b()},[]);const b=()=>{o(l.getEvents()),c(l.getEventResults())},v=i.filter(e=>!e.dueDate||new Date(e.dueDate)>=new Date),j=i.filter(e=>!!e.dueDate&&new Date(e.dueDate)<new Date),f=e=>{const t=n.find(t=>t.id===e);return(null==t?void 0:t.name)||"ä¸æ˜"};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[t.jsx("h2",{className:"text-3xl font-bold text-purple-800",children:"ğŸ‰ ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†"}),"PARENT"===(null==r?void 0:r.role)&&t.jsxs("button",{onClick:()=>u(!0),className:"btn-primary flex items-center gap-2",children:[t.jsx(a,{className:"w-5 h-5"}),"âœ¨ æ–°ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆ"]})]}),t.jsxs("div",{className:"card",children:[t.jsxs("div",{className:"flex gap-2 mb-6",children:[t.jsxs("button",{onClick:()=>g("active"),className:"px-6 py-3 rounded-full font-bold transition-all "+("active"===h?"bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:["ğŸ”¥ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¤ãƒ™ãƒ³ãƒˆ (",v.length,")"]}),t.jsxs("button",{onClick:()=>g("completed"),className:"px-6 py-3 rounded-full font-bold transition-all "+("completed"===h?"bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:["âœ… å®Œäº†ã‚¤ãƒ™ãƒ³ãƒˆ (",j.length,")"]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[("active"===h?v:j).map(e=>{return t.jsx(x,{event:e,results:(s=e.id,d.filter(e=>e.eventId===s)),children:n,getChildName:f,onUpdate:b},e.id);var s}),0===("active"===h?v:j).length&&t.jsx("div",{className:"col-span-full text-center py-12",children:t.jsx("p",{className:"text-purple-600 text-lg",children:"active"===h?"ğŸ¯ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¤ãƒ™ãƒ³ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“":"ğŸ“… å®Œäº†ã—ãŸã‚¤ãƒ™ãƒ³ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“"})})]})]}),m&&t.jsx(p,{onClose:()=>u(!1),onSave:b,children:n})]})},x=({event:l,results:n,children:a,getChildName:c,onUpdate:x})=>{const{user:p}=e(),[u,h]=s.useState(!1),g=l.assignedTo?a.find(e=>e.id===l.assignedTo):null,b=l.dueDate&&new Date(l.dueDate)<new Date,v=n.find(e=>e.childId===(null==p?void 0:p.id)),j=!("CHILD"!==(null==p?void 0:p.role)||l.assignedTo&&l.assignedTo!==p.id||v||b);return t.jsxs("div",{className:"p-6 rounded-2xl border-2 shadow-lg transition-all hover:shadow-xl "+(b?"bg-gradient-to-br from-gray-100 to-gray-200 border-gray-300":"bg-gradient-to-br from-yellow-100 to-orange-100 border-yellow-300"),children:[t.jsxs("div",{className:"flex items-start justify-between mb-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"font-bold text-lg text-orange-800",children:l.title}),t.jsx("p",{className:"text-sm text-orange-600 font-medium",children:l.category})]}),t.jsx("div",{className:"text-2xl",children:(e=>{switch(e){case"SCORE_BASED":return"ğŸ“Š";case"EVALUATION_BASED":return"â­";case"COMPLETION_BASED":return"âœ…";default:return"ğŸ¯"}})(l.eventType)})]}),t.jsx("p",{className:"text-sm text-orange-700 mb-4",children:l.description}),t.jsxs("div",{className:"space-y-2 mb-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-xs px-3 py-1 bg-orange-200 text-orange-700 rounded-full",children:(e=>{switch(e){case"SCORE_BASED":return"ç‚¹æ•°ãƒ™ãƒ¼ã‚¹";case"EVALUATION_BASED":return"è©•ä¾¡ãƒ™ãƒ¼ã‚¹";case"COMPLETION_BASED":return"å®Œäº†ãƒ™ãƒ¼ã‚¹";default:return e}})(l.eventType)}),t.jsx("span",{className:"text-xs px-3 py-1 bg-purple-200 text-purple-700 rounded-full",children:g?g.name:"å…¨å“¡"})]}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-orange-600",children:[t.jsx(r,{className:"w-4 h-4"}),t.jsxs("span",{children:[l.pointsConfig.basePoints,"pt ï½ ",l.pointsConfig.maxPoints,"pt",l.pointsConfig.bonusPoints&&` (+${l.pointsConfig.bonusPoints}pt ãƒœãƒ¼ãƒŠã‚¹)`]})]}),l.dueDate&&t.jsxs("div",{className:"flex items-center gap-2 text-sm text-orange-600",children:[t.jsx(i,{className:"w-4 h-4"}),t.jsxs("span",{children:["æœŸé™: ",new Date(l.dueDate).toLocaleDateString("ja-JP")]}),b&&t.jsx("span",{className:"text-red-500 font-bold",children:"ï¼ˆæœŸé™åˆ‡ã‚Œï¼‰"})]})]}),n.length>0&&t.jsxs("div",{className:"mb-4",children:[t.jsx("h4",{className:"font-bold text-sm text-orange-800 mb-2",children:"ğŸ“ çµæœ"}),t.jsx("div",{className:"space-y-2",children:n.map(e=>t.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded-lg border border-orange-200",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium text-sm",children:c(e.childId)}),t.jsxs("div",{className:"text-xs text-gray-600",children:["SCORE"===e.resultType&&`${e.score}ç‚¹`,"EVALUATION"===e.resultType&&e.evaluation,"COMPLETED"===e.resultType&&"å®Œäº†"]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("span",{className:"font-bold text-purple-600",children:[e.earnedPoints,"pt"]}),e.bonusEarned&&t.jsx("span",{className:"text-xs text-green-600 block",children:"ãƒœãƒ¼ãƒŠã‚¹ç²å¾—ï¼"})]})]},e.id))})]}),j&&t.jsxs("button",{onClick:()=>h(!0),className:"w-full btn-primary text-sm flex items-center justify-center gap-2",children:[t.jsx(o,{className:"w-4 h-4"}),"ğŸš€ çµæœã‚’å ±å‘Š"]}),v&&t.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[t.jsx(d,{className:"w-4 h-4 text-green-500"}),t.jsxs("span",{className:"text-green-600 font-medium",children:["çµæœå ±å‘Šæ¸ˆã¿ (",v.earnedPoints,"ptç²å¾—)"]})]}),u&&t.jsx(m,{event:l,onClose:()=>h(!1),onSave:x})]})},p=({onClose:e,onSave:r,children:i})=>{const[o,d]=s.useState({title:"",description:"",category:"ãƒ†ã‚¹ãƒˆ",eventType:"SCORE_BASED",assignedTo:"",basePoints:10,maxPoints:50,bonusPoints:10,targetScore:80,dueDate:""});return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:t.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 rounded-3xl p-8 w-full max-w-2xl border-4 border-purple-300 shadow-2xl max-h-[90vh] overflow-y-auto",children:[t.jsx("h3",{className:"text-2xl font-bold text-purple-800 mb-6 text-center",children:"ğŸ‰ æ–°ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½œæˆ"}),t.jsxs("form",{onSubmit:t=>{var s;t.preventDefault();const n=l.getEvents(),a={id:l.generateId(),title:o.title,description:o.description,category:o.category,eventType:o.eventType,pointsConfig:{basePoints:o.basePoints,maxPoints:o.maxPoints,bonusPoints:o.bonusPoints,targetScore:o.targetScore,scoreThresholds:"SCORE_BASED"===o.eventType?[{score:90,points:o.maxPoints},{score:80,points:Math.floor(.8*o.maxPoints)},{score:70,points:Math.floor(.6*o.maxPoints)},{score:60,points:Math.floor(.4*o.maxPoints)},{score:0,points:o.basePoints}]:void 0},assignedTo:o.assignedTo||void 0,createdBy:(null==(s=l.getCurrentUser())?void 0:s.id)||"",dueDate:o.dueDate?new Date(o.dueDate):void 0,createdAt:new Date};n.push(a),l.saveEvents(n),r(),e()},className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"ğŸ“ ã‚¤ãƒ™ãƒ³ãƒˆå"}),t.jsx("input",{type:"text",value:o.title,onChange:e=>d({...o,title:e.target.value}),className:"input-field",placeholder:"ä¾‹: ç®—æ•°ã®ãƒ†ã‚¹ãƒˆ",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"ğŸ·ï¸ ã‚«ãƒ†ã‚´ãƒª"}),t.jsxs("select",{value:o.category,onChange:e=>d({...o,category:e.target.value}),className:"input-field",children:[t.jsx("option",{value:"ãƒ†ã‚¹ãƒˆ",children:"ãƒ†ã‚¹ãƒˆ"}),t.jsx("option",{value:"ç™ºè¡¨ä¼š",children:"ç™ºè¡¨ä¼š"}),t.jsx("option",{value:"ã‚³ãƒ³ã‚¯ãƒ¼ãƒ«",children:"ã‚³ãƒ³ã‚¯ãƒ¼ãƒ«"}),t.jsx("option",{value:"ç¿’ã„äº‹",children:"ç¿’ã„äº‹"}),t.jsx("option",{value:"ãã®ä»–",children:"ãã®ä»–"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"ğŸ“‹ èª¬æ˜"}),t.jsx("textarea",{value:o.description,onChange:e=>d({...o,description:e.target.value}),className:"input-field",rows:3,placeholder:"ã‚¤ãƒ™ãƒ³ãƒˆã®è©³ç´°ã‚’èª¬æ˜ã—ã¦ãã ã•ã„"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"âš™ï¸ ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—"}),t.jsxs("select",{value:o.eventType,onChange:e=>d({...o,eventType:e.target.value}),className:"input-field",children:[t.jsx("option",{value:"SCORE_BASED",children:"ğŸ“Š ç‚¹æ•°ãƒ™ãƒ¼ã‚¹ï¼ˆãƒ†ã‚¹ãƒˆç­‰ï¼‰"}),t.jsx("option",{value:"EVALUATION_BASED",children:"â­ è©•ä¾¡ãƒ™ãƒ¼ã‚¹ï¼ˆç™ºè¡¨ä¼šç­‰ï¼‰"}),t.jsx("option",{value:"COMPLETION_BASED",children:"âœ… å®Œäº†ãƒ™ãƒ¼ã‚¹"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"ğŸ‘§ å¯¾è±¡"}),t.jsxs("select",{value:o.assignedTo,onChange:e=>d({...o,assignedTo:e.target.value}),className:"input-field",children:[t.jsx("option",{value:"",children:"å…¨å“¡"}),i.map(e=>t.jsxs("option",{value:e.id,children:[e.name," (",e.birthDate?`${n(e.birthDate)}æ­³`:`${e.age||0}æ­³`,")"]},e.id))]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-2",children:"ğŸ’ åŸºæœ¬ãƒã‚¤ãƒ³ãƒˆ"}),t.jsx("input",{type:"number",value:o.basePoints,onChange:e=>d({...o,basePoints:parseInt(e.target.value)}),className:"input-field",min:"1",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-2",children:"âœ¨ æœ€å¤§ãƒã‚¤ãƒ³ãƒˆ"}),t.jsx("input",{type:"number",value:o.maxPoints,onChange:e=>d({...o,maxPoints:parseInt(e.target.value)}),className:"input-field",min:"1",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-2",children:"ğŸ ãƒœãƒ¼ãƒŠã‚¹"}),t.jsx("input",{type:"number",value:o.bonusPoints,onChange:e=>d({...o,bonusPoints:parseInt(e.target.value)}),className:"input-field",min:"0"})]}),"SCORE_BASED"===o.eventType&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-2",children:"ğŸ¯ ç›®æ¨™ç‚¹æ•°"}),t.jsx("input",{type:"number",value:o.targetScore,onChange:e=>d({...o,targetScore:parseInt(e.target.value)}),className:"input-field",min:"0",max:"100"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"ğŸ“… æœŸé™ï¼ˆä»»æ„ï¼‰"}),t.jsx("input",{type:"date",value:o.dueDate,onChange:e=>d({...o,dueDate:e.target.value}),className:"input-field"})]}),t.jsxs("div",{className:"flex justify-center gap-4",children:[t.jsx("button",{type:"button",onClick:e,className:"btn-secondary text-lg px-8",children:"ğŸ”™ ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),t.jsxs("button",{type:"submit",className:"btn-primary text-lg flex items-center gap-3 px-8",children:[t.jsx(a,{className:"w-6 h-6"}),"ğŸ‰ ä½œæˆ"]})]})]})]})})},m=({event:n,onClose:a,onSave:r})=>{const{user:i}=e(),[o,c]=s.useState({score:0,evaluation:"",comments:""}),x=()=>{const{pointsConfig:e}=n;let t=e.basePoints,s=!1;if("SCORE_BASED"===n.eventType&&e.scoreThresholds){for(const s of e.scoreThresholds)if(o.score>=s.score){t=s.points;break}e.targetScore&&o.score>=e.targetScore&&e.bonusPoints&&(t+=e.bonusPoints,s=!0)}else"COMPLETION_BASED"===n.eventType&&(t=e.maxPoints,e.bonusPoints&&(t+=e.bonusPoints,s=!0));return{earnedPoints:t,bonusEarned:s}},{earnedPoints:p,bonusEarned:m}=x();return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:t.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 rounded-3xl p-8 w-full max-w-md border-4 border-purple-300 shadow-2xl",children:[t.jsx("h3",{className:"text-2xl font-bold text-purple-800 mb-6 text-center",children:"ğŸ“ çµæœã‚’å ±å‘Š"}),t.jsxs("div",{className:"mb-6 p-4 bg-gradient-to-br from-yellow-100 to-orange-100 rounded-2xl border-2 border-yellow-300",children:[t.jsx("h4",{className:"font-bold text-orange-800",children:n.title}),t.jsx("p",{className:"text-sm text-orange-600 mt-1",children:n.description})]}),t.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!i)return;const{earnedPoints:t,bonusEarned:s}=x(),d=l.getEventResults(),c={id:l.generateId(),eventId:n.id,childId:i.id,resultType:"SCORE_BASED"===n.eventType?"SCORE":"EVALUATION_BASED"===n.eventType?"EVALUATION":"COMPLETED",score:"SCORE_BASED"===n.eventType?o.score:void 0,evaluation:"EVALUATION_BASED"===n.eventType?o.evaluation:void 0,earnedPoints:t,bonusEarned:s,submittedAt:new Date,status:"PENDING",comments:o.comments};d.push(c),l.saveEventResults(d),r(),a()},className:"space-y-6",children:["SCORE_BASED"===n.eventType&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"ğŸ“Š ç‚¹æ•°"}),t.jsx("input",{type:"number",value:o.score,onChange:e=>c({...o,score:parseInt(e.target.value)||0}),className:"input-field text-center text-2xl",min:"0",max:"100",placeholder:"ç‚¹æ•°ã‚’å…¥åŠ›",required:!0})]}),"EVALUATION_BASED"===n.eventType&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"â­ è©•ä¾¡"}),t.jsxs("select",{value:o.evaluation,onChange:e=>c({...o,evaluation:e.target.value}),className:"input-field",required:!0,children:[t.jsx("option",{value:"",children:"è©•ä¾¡ã‚’é¸æŠ"}),t.jsx("option",{value:"ã¨ã¦ã‚‚ã‚ˆãã§ãã¾ã—ãŸ",children:"ã¨ã¦ã‚‚ã‚ˆãã§ãã¾ã—ãŸ"}),t.jsx("option",{value:"ã‚ˆãã§ãã¾ã—ãŸ",children:"ã‚ˆãã§ãã¾ã—ãŸ"}),t.jsx("option",{value:"ã§ãã¾ã—ãŸ",children:"ã§ãã¾ã—ãŸ"}),t.jsx("option",{value:"ãŒã‚“ã°ã‚Šã¾ã—ã‚‡ã†",children:"ãŒã‚“ã°ã‚Šã¾ã—ã‚‡ã†"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"ğŸ’­ ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆä»»æ„ï¼‰"}),t.jsx("textarea",{value:o.comments,onChange:e=>c({...o,comments:e.target.value}),className:"input-field",rows:3,placeholder:"ãŒã‚“ã°ã£ãŸã“ã¨ã‚„æ„Ÿæƒ³ã‚’æ›¸ã„ã¦ã­"})]}),t.jsxs("div",{className:"p-4 bg-gradient-to-r from-green-100 to-emerald-100 rounded-2xl border-2 border-green-300",children:[t.jsx("h4",{className:"font-bold text-green-800 mb-2",children:"ğŸ‰ ç²å¾—äºˆå®šãƒã‚¤ãƒ³ãƒˆ"}),t.jsxs("div",{className:"text-3xl font-bold text-green-600 text-center",children:[p,"pt",m&&t.jsx("span",{className:"text-lg text-yellow-600 block",children:"+ ãƒœãƒ¼ãƒŠã‚¹ç²å¾—ï¼"})]})]}),t.jsxs("div",{className:"flex justify-center gap-4",children:[t.jsx("button",{type:"button",onClick:a,className:"btn-secondary text-lg px-8",children:"ğŸ”™ ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),t.jsxs("button",{type:"submit",className:"btn-primary text-lg flex items-center gap-3 px-8",children:[t.jsx(d,{className:"w-6 h-6"}),"ğŸ“¤ é€ä¿¡"]})]})]})]})})};export{c as default};
