import{u as e,j as t}from"./index-a37bae51-1750549093763.js";import{r as s}from"./vendor-18e24f2a-1750549093763.js";import{s as l}from"./storage-afc0bc2e-1750549093763.js";import{c as n}from"./dateUtils-d91f8443-1750549093763.js";import{P as a,r,i,p as o,C as d}from"./icons-6c88ec70-1750549093763.js";import"./routing-b3bac0e0-1750549093763.js";import"./supabase-195fc627-1750549093763.js";const c=({children:n})=>{const{user:r}=e(),[i,o]=s.useState([]),[d,c]=s.useState([]),[m,u]=s.useState(!1),[h,g]=s.useState("active");s.useEffect(()=>{b()},[]);const b=()=>{o(l.getEvents()),c(l.getEventResults())},v=i.filter(e=>!e.dueDate||new Date(e.dueDate)>=new Date),j=i.filter(e=>!!e.dueDate&&new Date(e.dueDate)<new Date),f=e=>{const t=n.find(t=>t.id===e);return(null==t?void 0:t.name)||"不明"};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[t.jsx("h2",{className:"text-3xl font-bold text-purple-800",children:"🎉 イベント管理"}),"PARENT"===(null==r?void 0:r.role)&&t.jsxs("button",{onClick:()=>u(!0),className:"btn-primary flex items-center gap-2",children:[t.jsx(a,{className:"w-5 h-5"}),"✨ 新しいイベント"]})]}),t.jsxs("div",{className:"card",children:[t.jsxs("div",{className:"flex gap-2 mb-6",children:[t.jsxs("button",{onClick:()=>g("active"),className:"px-6 py-3 rounded-full font-bold transition-all "+("active"===h?"bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:["🔥 アクティブイベント (",v.length,")"]}),t.jsxs("button",{onClick:()=>g("completed"),className:"px-6 py-3 rounded-full font-bold transition-all "+("completed"===h?"bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:["✅ 完了イベント (",j.length,")"]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[("active"===h?v:j).map(e=>{return t.jsx(x,{event:e,results:(s=e.id,d.filter(e=>e.eventId===s)),children:n,getChildName:f,onUpdate:b},e.id);var s}),0===("active"===h?v:j).length&&t.jsx("div",{className:"col-span-full text-center py-12",children:t.jsx("p",{className:"text-purple-600 text-lg",children:"active"===h?"🎯 アクティブなイベントはありません":"📅 完了したイベントはありません"})})]})]}),m&&t.jsx(p,{onClose:()=>u(!1),onSave:b,children:n})]})},x=({event:l,results:n,children:a,getChildName:c,onUpdate:x})=>{const{user:p}=e(),[u,h]=s.useState(!1),g=l.assignedTo?a.find(e=>e.id===l.assignedTo):null,b=l.dueDate&&new Date(l.dueDate)<new Date,v=n.find(e=>e.childId===(null==p?void 0:p.id)),j=!("CHILD"!==(null==p?void 0:p.role)||l.assignedTo&&l.assignedTo!==p.id||v||b);return t.jsxs("div",{className:"p-6 rounded-2xl border-2 shadow-lg transition-all hover:shadow-xl "+(b?"bg-gradient-to-br from-gray-100 to-gray-200 border-gray-300":"bg-gradient-to-br from-yellow-100 to-orange-100 border-yellow-300"),children:[t.jsxs("div",{className:"flex items-start justify-between mb-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"font-bold text-lg text-orange-800",children:l.title}),t.jsx("p",{className:"text-sm text-orange-600 font-medium",children:l.category})]}),t.jsx("div",{className:"text-2xl",children:(e=>{switch(e){case"SCORE_BASED":return"📊";case"EVALUATION_BASED":return"⭐";case"COMPLETION_BASED":return"✅";default:return"🎯"}})(l.eventType)})]}),t.jsx("p",{className:"text-sm text-orange-700 mb-4",children:l.description}),t.jsxs("div",{className:"space-y-2 mb-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-xs px-3 py-1 bg-orange-200 text-orange-700 rounded-full",children:(e=>{switch(e){case"SCORE_BASED":return"点数ベース";case"EVALUATION_BASED":return"評価ベース";case"COMPLETION_BASED":return"完了ベース";default:return e}})(l.eventType)}),t.jsx("span",{className:"text-xs px-3 py-1 bg-purple-200 text-purple-700 rounded-full",children:g?g.name:"全員"})]}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-orange-600",children:[t.jsx(r,{className:"w-4 h-4"}),t.jsxs("span",{children:[l.pointsConfig.basePoints,"pt ～ ",l.pointsConfig.maxPoints,"pt",l.pointsConfig.bonusPoints&&` (+${l.pointsConfig.bonusPoints}pt ボーナス)`]})]}),l.dueDate&&t.jsxs("div",{className:"flex items-center gap-2 text-sm text-orange-600",children:[t.jsx(i,{className:"w-4 h-4"}),t.jsxs("span",{children:["期限: ",new Date(l.dueDate).toLocaleDateString("ja-JP")]}),b&&t.jsx("span",{className:"text-red-500 font-bold",children:"（期限切れ）"})]})]}),n.length>0&&t.jsxs("div",{className:"mb-4",children:[t.jsx("h4",{className:"font-bold text-sm text-orange-800 mb-2",children:"📝 結果"}),t.jsx("div",{className:"space-y-2",children:n.map(e=>t.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded-lg border border-orange-200",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium text-sm",children:c(e.childId)}),t.jsxs("div",{className:"text-xs text-gray-600",children:["SCORE"===e.resultType&&`${e.score}点`,"EVALUATION"===e.resultType&&e.evaluation,"COMPLETED"===e.resultType&&"完了"]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("span",{className:"font-bold text-purple-600",children:[e.earnedPoints,"pt"]}),e.bonusEarned&&t.jsx("span",{className:"text-xs text-green-600 block",children:"ボーナス獲得！"})]})]},e.id))})]}),j&&t.jsxs("button",{onClick:()=>h(!0),className:"w-full btn-primary text-sm flex items-center justify-center gap-2",children:[t.jsx(o,{className:"w-4 h-4"}),"🚀 結果を報告"]}),v&&t.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[t.jsx(d,{className:"w-4 h-4 text-green-500"}),t.jsxs("span",{className:"text-green-600 font-medium",children:["結果報告済み (",v.earnedPoints,"pt獲得)"]})]}),u&&t.jsx(m,{event:l,onClose:()=>h(!1),onSave:x})]})},p=({onClose:e,onSave:r,children:i})=>{const[o,d]=s.useState({title:"",description:"",category:"テスト",eventType:"SCORE_BASED",assignedTo:"",basePoints:10,maxPoints:50,bonusPoints:10,targetScore:80,dueDate:""});return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:t.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 rounded-3xl p-8 w-full max-w-2xl border-4 border-purple-300 shadow-2xl max-h-[90vh] overflow-y-auto",children:[t.jsx("h3",{className:"text-2xl font-bold text-purple-800 mb-6 text-center",children:"🎉 新しいイベントを作成"}),t.jsxs("form",{onSubmit:t=>{var s;t.preventDefault();const n=l.getEvents(),a={id:l.generateId(),title:o.title,description:o.description,category:o.category,eventType:o.eventType,pointsConfig:{basePoints:o.basePoints,maxPoints:o.maxPoints,bonusPoints:o.bonusPoints,targetScore:o.targetScore,scoreThresholds:"SCORE_BASED"===o.eventType?[{score:90,points:o.maxPoints},{score:80,points:Math.floor(.8*o.maxPoints)},{score:70,points:Math.floor(.6*o.maxPoints)},{score:60,points:Math.floor(.4*o.maxPoints)},{score:0,points:o.basePoints}]:void 0},assignedTo:o.assignedTo||void 0,createdBy:(null==(s=l.getCurrentUser())?void 0:s.id)||"",dueDate:o.dueDate?new Date(o.dueDate):void 0,createdAt:new Date};n.push(a),l.saveEvents(n),r(),e()},className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"📝 イベント名"}),t.jsx("input",{type:"text",value:o.title,onChange:e=>d({...o,title:e.target.value}),className:"input-field",placeholder:"例: 算数のテスト",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"🏷️ カテゴリ"}),t.jsxs("select",{value:o.category,onChange:e=>d({...o,category:e.target.value}),className:"input-field",children:[t.jsx("option",{value:"テスト",children:"テスト"}),t.jsx("option",{value:"発表会",children:"発表会"}),t.jsx("option",{value:"コンクール",children:"コンクール"}),t.jsx("option",{value:"習い事",children:"習い事"}),t.jsx("option",{value:"その他",children:"その他"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"📋 説明"}),t.jsx("textarea",{value:o.description,onChange:e=>d({...o,description:e.target.value}),className:"input-field",rows:3,placeholder:"イベントの詳細を説明してください"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"⚙️ イベントタイプ"}),t.jsxs("select",{value:o.eventType,onChange:e=>d({...o,eventType:e.target.value}),className:"input-field",children:[t.jsx("option",{value:"SCORE_BASED",children:"📊 点数ベース（テスト等）"}),t.jsx("option",{value:"EVALUATION_BASED",children:"⭐ 評価ベース（発表会等）"}),t.jsx("option",{value:"COMPLETION_BASED",children:"✅ 完了ベース"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"👧 対象"}),t.jsxs("select",{value:o.assignedTo,onChange:e=>d({...o,assignedTo:e.target.value}),className:"input-field",children:[t.jsx("option",{value:"",children:"全員"}),i.map(e=>t.jsxs("option",{value:e.id,children:[e.name," (",e.birthDate?`${n(e.birthDate)}歳`:`${e.age||0}歳`,")"]},e.id))]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-2",children:"💎 基本ポイント"}),t.jsx("input",{type:"number",value:o.basePoints,onChange:e=>d({...o,basePoints:parseInt(e.target.value)}),className:"input-field",min:"1",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-2",children:"✨ 最大ポイント"}),t.jsx("input",{type:"number",value:o.maxPoints,onChange:e=>d({...o,maxPoints:parseInt(e.target.value)}),className:"input-field",min:"1",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-2",children:"🎁 ボーナス"}),t.jsx("input",{type:"number",value:o.bonusPoints,onChange:e=>d({...o,bonusPoints:parseInt(e.target.value)}),className:"input-field",min:"0"})]}),"SCORE_BASED"===o.eventType&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-2",children:"🎯 目標点数"}),t.jsx("input",{type:"number",value:o.targetScore,onChange:e=>d({...o,targetScore:parseInt(e.target.value)}),className:"input-field",min:"0",max:"100"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"📅 期限（任意）"}),t.jsx("input",{type:"date",value:o.dueDate,onChange:e=>d({...o,dueDate:e.target.value}),className:"input-field"})]}),t.jsxs("div",{className:"flex justify-center gap-4",children:[t.jsx("button",{type:"button",onClick:e,className:"btn-secondary text-lg px-8",children:"🔙 キャンセル"}),t.jsxs("button",{type:"submit",className:"btn-primary text-lg flex items-center gap-3 px-8",children:[t.jsx(a,{className:"w-6 h-6"}),"🎉 作成"]})]})]})]})})},m=({event:n,onClose:a,onSave:r})=>{const{user:i}=e(),[o,c]=s.useState({score:0,evaluation:"",comments:""}),x=()=>{const{pointsConfig:e}=n;let t=e.basePoints,s=!1;if("SCORE_BASED"===n.eventType&&e.scoreThresholds){for(const s of e.scoreThresholds)if(o.score>=s.score){t=s.points;break}e.targetScore&&o.score>=e.targetScore&&e.bonusPoints&&(t+=e.bonusPoints,s=!0)}else"COMPLETION_BASED"===n.eventType&&(t=e.maxPoints,e.bonusPoints&&(t+=e.bonusPoints,s=!0));return{earnedPoints:t,bonusEarned:s}},{earnedPoints:p,bonusEarned:m}=x();return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:t.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 rounded-3xl p-8 w-full max-w-md border-4 border-purple-300 shadow-2xl",children:[t.jsx("h3",{className:"text-2xl font-bold text-purple-800 mb-6 text-center",children:"📝 結果を報告"}),t.jsxs("div",{className:"mb-6 p-4 bg-gradient-to-br from-yellow-100 to-orange-100 rounded-2xl border-2 border-yellow-300",children:[t.jsx("h4",{className:"font-bold text-orange-800",children:n.title}),t.jsx("p",{className:"text-sm text-orange-600 mt-1",children:n.description})]}),t.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!i)return;const{earnedPoints:t,bonusEarned:s}=x(),d=l.getEventResults(),c={id:l.generateId(),eventId:n.id,childId:i.id,resultType:"SCORE_BASED"===n.eventType?"SCORE":"EVALUATION_BASED"===n.eventType?"EVALUATION":"COMPLETED",score:"SCORE_BASED"===n.eventType?o.score:void 0,evaluation:"EVALUATION_BASED"===n.eventType?o.evaluation:void 0,earnedPoints:t,bonusEarned:s,submittedAt:new Date,status:"PENDING",comments:o.comments};d.push(c),l.saveEventResults(d),r(),a()},className:"space-y-6",children:["SCORE_BASED"===n.eventType&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"📊 点数"}),t.jsx("input",{type:"number",value:o.score,onChange:e=>c({...o,score:parseInt(e.target.value)||0}),className:"input-field text-center text-2xl",min:"0",max:"100",placeholder:"点数を入力",required:!0})]}),"EVALUATION_BASED"===n.eventType&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"⭐ 評価"}),t.jsxs("select",{value:o.evaluation,onChange:e=>c({...o,evaluation:e.target.value}),className:"input-field",required:!0,children:[t.jsx("option",{value:"",children:"評価を選択"}),t.jsx("option",{value:"とてもよくできました",children:"とてもよくできました"}),t.jsx("option",{value:"よくできました",children:"よくできました"}),t.jsx("option",{value:"できました",children:"できました"}),t.jsx("option",{value:"がんばりましょう",children:"がんばりましょう"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"💭 コメント（任意）"}),t.jsx("textarea",{value:o.comments,onChange:e=>c({...o,comments:e.target.value}),className:"input-field",rows:3,placeholder:"がんばったことや感想を書いてね"})]}),t.jsxs("div",{className:"p-4 bg-gradient-to-r from-green-100 to-emerald-100 rounded-2xl border-2 border-green-300",children:[t.jsx("h4",{className:"font-bold text-green-800 mb-2",children:"🎉 獲得予定ポイント"}),t.jsxs("div",{className:"text-3xl font-bold text-green-600 text-center",children:[p,"pt",m&&t.jsx("span",{className:"text-lg text-yellow-600 block",children:"+ ボーナス獲得！"})]})]}),t.jsxs("div",{className:"flex justify-center gap-4",children:[t.jsx("button",{type:"button",onClick:a,className:"btn-secondary text-lg px-8",children:"🔙 キャンセル"}),t.jsxs("button",{type:"submit",className:"btn-primary text-lg flex items-center gap-3 px-8",children:[t.jsx(d,{className:"w-6 h-6"}),"📤 送信"]})]})]})]})})};export{c as default};
