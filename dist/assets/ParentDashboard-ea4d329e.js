import{_ as v}from"./supabase-e6e84841.js";import{u as Z,j as e}from"./index-55d7bea8.js";import{b as w,r as i}from"./vendor-ce4ffebd.js";import{d as p}from"./database-94fba64c.js";import{c as V}from"./dateUtils-280973c0.js";import{P as ee,g as z,h as se,i as te,d as le,j as ae,k as O,l as ne,C as re,m as ie,n as de}from"./icons-ce793056.js";import"./routing-89dfa7f7.js";const ce=w.lazy(()=>v(()=>import("./EventManagement-3dbf4a99.js"),["assets/EventManagement-3dbf4a99.js","assets/index-55d7bea8.js","assets/vendor-ce4ffebd.js","assets/routing-89dfa7f7.js","assets/supabase-e6e84841.js","assets/icons-ce793056.js","assets/index-1beb27b5.css","assets/storage-8020bd0d.js","assets/dateUtils-280973c0.js"])),oe=w.lazy(()=>v(()=>import("./Statistics-21ef0097.js"),["assets/Statistics-21ef0097.js","assets/index-55d7bea8.js","assets/vendor-ce4ffebd.js","assets/routing-89dfa7f7.js","assets/supabase-e6e84841.js","assets/icons-ce793056.js","assets/index-1beb27b5.css","assets/storage-8020bd0d.js","assets/dateUtils-280973c0.js"])),xe=w.lazy(()=>v(()=>import("./RateManagement-1a4b25d1.js"),["assets/RateManagement-1a4b25d1.js","assets/index-55d7bea8.js","assets/vendor-ce4ffebd.js","assets/routing-89dfa7f7.js","assets/supabase-e6e84841.js","assets/icons-ce793056.js","assets/index-1beb27b5.css","assets/storage-8020bd0d.js","assets/dateUtils-280973c0.js"])),me=w.lazy(()=>v(()=>import("./PointExchange-cf711dd5.js"),["assets/PointExchange-cf711dd5.js","assets/index-55d7bea8.js","assets/vendor-ce4ffebd.js","assets/routing-89dfa7f7.js","assets/supabase-e6e84841.js","assets/icons-ce793056.js","assets/index-1beb27b5.css","assets/storage-8020bd0d.js","assets/dateUtils-280973c0.js"])),pe=w.lazy(()=>v(()=>import("./FamilyManagement-3814a4ff.js"),["assets/FamilyManagement-3814a4ff.js","assets/index-55d7bea8.js","assets/vendor-ce4ffebd.js","assets/routing-89dfa7f7.js","assets/supabase-e6e84841.js","assets/icons-ce793056.js","assets/index-1beb27b5.css"])),we=()=>{const{user:l}=Z(),[g,h]=i.useState([]),[u,d]=i.useState([]),[r,k]=i.useState([]),[n,T]=i.useState({}),[M,_]=i.useState(!1),[x,y]=i.useState(""),[c,F]=i.useState("tasks"),[q,S]=i.useState(!0),[P,C]=i.useState(null),f=s=>{F(s),c==="family"&&s!=="family"&&b()};i.useEffect(()=>{l!=null&&l.familyId&&b()},[l==null?void 0:l.familyId]);const b=async()=>{if(l!=null&&l.familyId)try{S(!0),C(null);const[s,t,a,o]=await Promise.all([p.getTasks(l.familyId),p.getTaskCompletions(l.familyId),p.getUsers(l.familyId),p.getPointTransactions(l.familyId)]);h(s),d(t.filter(j=>j.status==="PENDING"));const N=a.filter(j=>j.role==="CHILD");k(N);const R={};N.forEach(j=>{const L=o.filter(m=>m.userId===j.id),Q=L.filter(m=>m.type==="EARNED").reduce((m,I)=>m+I.amount,0),W=L.filter(m=>m.type==="EXCHANGED").reduce((m,I)=>m+I.amount,0);R[j.id]=Q-W}),T(R)}catch(s){console.error("データ読み込みエラー:",s),C("データベースの初期設定が必要です。Supabaseでdatabase-schema.sqlを実行してください。")}finally{S(!1)}},A=async(s,t)=>{if(l!=null&&l.familyId)try{const a=u.find(o=>o.id===s);if(!a)return;if(await p.updateTaskCompletion(s,{status:t?"APPROVED":"REJECTED",approvedAt:new Date}),t){const o=g.find(N=>N.id===a.taskId);o&&await p.createPointTransaction({userId:a.childId,type:"EARNED",amount:o.points,description:`タスク完了: ${o.title}`,createdAt:new Date},l.familyId)}await b()}catch(a){console.error("承認処理エラー:",a),C("承認処理に失敗しました")}},B=s=>{const t=r.find(a=>a.id===s);return(t==null?void 0:t.name)||"不明"},G=s=>{const t=g.find(a=>a.id===s);return(t==null?void 0:t.title)||"不明なタスク"},U=s=>!u.some(a=>a.taskId===s),H=async s=>{if(l!=null&&l.familyId)if(U(s)){if(confirm("このタスクを削除してもよろしいですか？"))try{await p.deleteTask(s),await b()}catch(t){console.error("タスク削除エラー:",t),C("タスクの削除に失敗しました")}}else alert("子供が実行済みのタスクは削除できません。")},X=s=>g.filter(t=>t.assignedTo===s),J=()=>g.filter(s=>!s.assignedTo),$=s=>u.filter(a=>a.taskId===s),Y=s=>{const t=[],a=[];return s.forEach(o=>{$(o.id).length===0?t.push(o):a.push(o)}),{notExecuted:t,executed:a}};i.useEffect(()=>{r.length>0&&!x&&y("all")},[r,x]);const K=(()=>x==="all"?g:x==="general"?J():X(x))(),{notExecuted:E,executed:D}=Y(K);return q?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-purple-500 border-t-transparent mx-auto mb-4"}),e.jsx("p",{className:"text-purple-600 text-lg font-medium",children:"データを読み込み中..."})]})}):P?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-red-600 text-lg mb-4",children:P}),e.jsx("button",{onClick:b,className:"btn-primary",children:"再読み込み"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-purple-800",children:"👨‍👩‍👧‍👦 保護者ダッシュボード"}),c==="tasks"&&e.jsxs("button",{onClick:()=>_(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),"✨ 新しいクエスト"]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"md:hidden",children:e.jsxs("select",{value:c,onChange:s=>f(s.target.value),className:"w-full p-4 bg-white border-2 border-purple-300 rounded-2xl font-bold text-purple-800 text-lg shadow-lg focus:ring-4 focus:ring-purple-200 focus:border-purple-500",children:[e.jsx("option",{value:"tasks",children:"🎯 クエスト管理"}),e.jsx("option",{value:"events",children:"🎉 イベント管理"}),e.jsx("option",{value:"statistics",children:"📊 統計・レポート"}),e.jsx("option",{value:"rates",children:"⚙️ レート設定"}),e.jsx("option",{value:"exchange",children:"💰 ポイント交換"}),e.jsx("option",{value:"family",children:"👨‍👩‍👧‍👦 家族管理"})]})}),e.jsxs("div",{className:"hidden md:flex gap-2 lg:gap-4 flex-wrap",children:[e.jsxs("button",{onClick:()=>f("tasks"),className:`px-4 lg:px-6 py-3 rounded-full font-bold transition-all flex items-center gap-2 text-sm lg:text-base ${c==="tasks"?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx(z,{className:"w-4 h-4 lg:w-5 lg:h-5"}),e.jsx("span",{className:"hidden lg:inline",children:"🎯 クエスト管理"}),e.jsx("span",{className:"lg:hidden",children:"🎯 クエスト"})]}),e.jsxs("button",{onClick:()=>f("events"),className:`px-4 lg:px-6 py-3 rounded-full font-bold transition-all flex items-center gap-2 text-sm lg:text-base ${c==="events"?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx(se,{className:"w-4 h-4 lg:w-5 lg:h-5"}),e.jsx("span",{className:"hidden lg:inline",children:"🎉 イベント管理"}),e.jsx("span",{className:"lg:hidden",children:"🎉 イベント"})]}),e.jsxs("button",{onClick:()=>f("statistics"),className:`px-4 lg:px-6 py-3 rounded-full font-bold transition-all flex items-center gap-2 text-sm lg:text-base ${c==="statistics"?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx(te,{className:"w-4 h-4 lg:w-5 lg:h-5"}),e.jsx("span",{className:"hidden lg:inline",children:"📊 統計・レポート"}),e.jsx("span",{className:"lg:hidden",children:"📊 統計"})]}),e.jsxs("button",{onClick:()=>f("rates"),className:`px-4 lg:px-6 py-3 rounded-full font-bold transition-all flex items-center gap-2 text-sm lg:text-base ${c==="rates"?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx(le,{className:"w-4 h-4 lg:w-5 lg:h-5"}),e.jsx("span",{className:"hidden lg:inline",children:"⚙️ レート設定"}),e.jsx("span",{className:"lg:hidden",children:"⚙️ レート"})]}),e.jsxs("button",{onClick:()=>f("exchange"),className:`px-4 lg:px-6 py-3 rounded-full font-bold transition-all flex items-center gap-2 text-sm lg:text-base ${c==="exchange"?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx(ae,{className:"w-4 h-4 lg:w-5 lg:h-5"}),e.jsx("span",{className:"hidden lg:inline",children:"💰 ポイント交換"}),e.jsx("span",{className:"lg:hidden",children:"💰 ポイント"})]}),e.jsxs("button",{onClick:()=>f("family"),className:`px-4 lg:px-6 py-3 rounded-full font-bold transition-all flex items-center gap-2 text-sm lg:text-base ${c==="family"?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx(O,{className:"w-4 h-4 lg:w-5 lg:h-5"}),e.jsx("span",{className:"hidden lg:inline",children:"👨‍👩‍👧‍👦 家族管理"}),e.jsx("span",{className:"lg:hidden",children:"👨‍👩‍👧‍👦 家族"})]})]})]}),c==="events"?e.jsx(i.Suspense,{fallback:e.jsx("div",{className:"text-center py-8",children:"イベント管理を読み込み中..."}),children:e.jsx(ce,{children:r})}):c==="statistics"?e.jsx(i.Suspense,{fallback:e.jsx("div",{className:"text-center py-8",children:"統計データを読み込み中..."}),children:e.jsx(oe,{children:r})}):c==="rates"?e.jsx(i.Suspense,{fallback:e.jsx("div",{className:"text-center py-8",children:"レート設定を読み込み中..."}),children:e.jsx(xe,{})}):c==="exchange"?e.jsx(i.Suspense,{fallback:e.jsx("div",{className:"text-center py-8",children:"ポイント交換を読み込み中..."}),children:e.jsx(me,{children:r})}):c==="family"?e.jsx(i.Suspense,{fallback:e.jsx("div",{className:"text-center py-8",children:"家族管理を読み込み中..."}),children:e.jsx(pe,{onDataUpdate:b})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(O,{className:"w-8 h-8 text-purple-500"}),e.jsx("h3",{className:"text-xl font-bold text-purple-700",children:"👧 お子様の状況"})]}),e.jsx("div",{className:"space-y-3",children:r.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-pink-50 to-purple-50 rounded-2xl border-2 border-pink-200",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-purple-800",children:s.name}),e.jsx("p",{className:"text-sm text-purple-600",children:s.birthDate?`${V(s.birthDate)}歳`:`${s.age||0}歳`})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-2xl text-purple-600",children:[n[s.id]||0,"pt"]}),e.jsx("p",{className:"text-xs text-purple-500",children:"保有ポイント"})]})]},s.id))})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(ne,{className:"w-8 h-8 text-yellow-500 animate-pulse"}),e.jsx("h3",{className:"text-xl font-bold text-yellow-700",children:"⏰ 承認待ち"})]}),e.jsxs("div",{className:"space-y-3",children:[u.slice(0,4).map(s=>e.jsxs("div",{className:"p-4 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-2xl border-2 border-yellow-300",children:[e.jsx("p",{className:"font-bold text-orange-800 mb-1",children:G(s.taskId)}),e.jsxs("p",{className:"text-sm text-orange-600 mb-3",children:[B(s.childId),"さん"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>A(s.id,!0),className:"flex-1 bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-3 rounded-full flex items-center justify-center gap-2 transition-all",children:[e.jsx(re,{className:"w-4 h-4"}),"✅ 承認"]}),e.jsxs("button",{onClick:()=>A(s.id,!1),className:"flex-1 bg-red-500 hover:bg-red-600 text-white font-medium py-2 px-3 rounded-full flex items-center justify-center gap-2 transition-all",children:[e.jsx(ie,{className:"w-4 h-4"}),"❌ 却下"]})]})]},s.id)),u.length===0&&e.jsx("div",{className:"text-center py-6",children:e.jsx("p",{className:"text-yellow-600",children:"📝 承認待ちのクエストはありません"})})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(z,{className:"w-8 h-8 text-green-500"}),e.jsx("h3",{className:"text-xl font-bold text-green-700",children:"🎯 クエスト管理"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"md:hidden",children:e.jsxs("select",{value:x,onChange:s=>y(s.target.value),className:"w-full p-3 bg-white border-2 border-purple-300 rounded-xl font-medium text-purple-800 shadow-md",children:[e.jsx("option",{value:"all",children:"👨‍👩‍👧‍👦 全体表示"}),e.jsx("option",{value:"general",children:"👥 全員対象"}),r.map(s=>e.jsxs("option",{value:s.id,children:[s.name,"さん"]},s.id))]})}),e.jsxs("div",{className:"hidden md:flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>y("all"),className:`px-3 lg:px-4 py-2 rounded-full font-medium transition-all text-sm lg:text-base ${x==="all"?"bg-purple-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"👨‍👩‍👧‍👦 全体表示"}),e.jsx("button",{onClick:()=>y("general"),className:`px-3 lg:px-4 py-2 rounded-full font-medium transition-all text-sm lg:text-base ${x==="general"?"bg-purple-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"👥 全員対象"}),r.map(s=>e.jsxs("button",{onClick:()=>y(s.id),className:`px-3 lg:px-4 py-2 rounded-full font-medium transition-all text-sm lg:text-base ${x===s.id?"bg-purple-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[s.name,"さん"]},s.id))]})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4 lg:gap-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-bold text-blue-700 mb-4 flex items-center gap-2",children:["🎯 実行前クエスト (",E.length,"件)"]}),e.jsxs("div",{className:"space-y-3",children:[E.map(s=>{const t=s.assignedTo?r.find(a=>a.id===s.assignedTo):null;return e.jsxs("div",{className:"p-3 lg:p-4 bg-gradient-to-r from-blue-50 to-cyan-50 rounded-2xl border-2 border-blue-200 hover:shadow-lg transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h5",{className:"font-bold text-blue-800 text-sm lg:text-base leading-tight",children:s.title}),e.jsxs("span",{className:"text-sm lg:text-lg font-bold text-purple-600 bg-white px-2 lg:px-3 py-1 rounded-full border-2 border-purple-300 whitespace-nowrap ml-2",children:[s.points,"pt"]})]}),e.jsxs("div",{className:"flex items-center gap-1 lg:gap-2 mb-2 flex-wrap",children:[e.jsx("span",{className:"text-xs px-2 lg:px-3 py-1 bg-blue-200 text-blue-700 rounded-full",children:s.category}),e.jsx("span",{className:"text-xs px-2 lg:px-3 py-1 bg-purple-200 text-purple-700 rounded-full",children:t?t.name:"全員"})]}),e.jsx("p",{className:"text-xs lg:text-sm text-blue-700 mb-3 leading-relaxed",children:s.description}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>H(s.id),className:"p-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-full transition-colors touch-manipulation",title:"クエストを削除",children:e.jsx(de,{className:"w-4 h-4"})})})]},s.id)}),E.length===0&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-blue-600",children:"🎉 実行前のクエストはありません"})})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-bold text-green-700 mb-4 flex items-center gap-2",children:["✅ 実行済みクエスト (",D.length,"件)"]}),e.jsxs("div",{className:"space-y-3",children:[D.map(s=>{const t=s.assignedTo?r.find(o=>o.id===s.assignedTo):null,a=$(s.id);return e.jsxs("div",{className:"p-3 lg:p-4 bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl border-2 border-green-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h5",{className:"font-bold text-green-800 text-sm lg:text-base leading-tight",children:s.title}),e.jsxs("span",{className:"text-sm lg:text-lg font-bold text-purple-600 bg-white px-2 lg:px-3 py-1 rounded-full border-2 border-purple-300 whitespace-nowrap ml-2",children:[s.points,"pt"]})]}),e.jsxs("div",{className:"flex items-center gap-1 lg:gap-2 mb-2 flex-wrap",children:[e.jsx("span",{className:"text-xs px-2 lg:px-3 py-1 bg-green-200 text-green-700 rounded-full",children:s.category}),e.jsx("span",{className:"text-xs px-2 lg:px-3 py-1 bg-purple-200 text-purple-700 rounded-full",children:t?t.name:"全員"}),e.jsxs("span",{className:"text-xs px-2 lg:px-3 py-1 bg-emerald-200 text-emerald-700 rounded-full",children:[a.length,"回実行"]})]}),e.jsx("p",{className:"text-xs lg:text-sm text-green-700 leading-relaxed",children:s.description})]},s.id)}),D.length===0&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-green-600",children:"📝 実行済みのクエストはありません"})})]})]})]})]}),M&&e.jsx(ge,{onClose:()=>_(!1),onSave:b,user:l,children:r})]})]})},ge=({onClose:l,onSave:g,user:h,children:u})=>{const[d,r]=i.useState({title:"",description:"",points:10,category:"家事",difficulty:"EASY",isRecurring:!1,assignedTo:""}),k=async n=>{if(n.preventDefault(),!!(h!=null&&h.familyId))try{await p.createTask({...d,assignedTo:d.assignedTo||void 0,createdBy:h.id},h.familyId),g(),l()}catch(T){console.error("タスク作成エラー:",T),alert("タスクの作成に失敗しました")}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"新しいタスクを作成"}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"タスク名"}),e.jsx("input",{type:"text",value:d.title,onChange:n=>r({...d,title:n.target.value}),className:"input-field",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"説明"}),e.jsx("textarea",{value:d.description,onChange:n=>r({...d,description:n.target.value}),className:"input-field",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"対象のお子様"}),e.jsxs("select",{value:d.assignedTo,onChange:n=>r({...d,assignedTo:n.target.value}),className:"input-field",children:[e.jsx("option",{value:"",children:"全員"}),u.map(n=>e.jsxs("option",{value:n.id,children:[n.name," (",n.birthDate?`${V(n.birthDate)}歳`:`${n.age||0}歳`,")"]},n.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ポイント"}),e.jsx("input",{type:"number",value:d.points,onChange:n=>r({...d,points:parseInt(n.target.value)}),className:"input-field",min:"1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"カテゴリ"}),e.jsxs("select",{value:d.category,onChange:n=>r({...d,category:n.target.value}),className:"input-field",children:[e.jsx("option",{value:"家事",children:"家事"}),e.jsx("option",{value:"勉強",children:"勉強"}),e.jsx("option",{value:"運動",children:"運動"}),e.jsx("option",{value:"その他",children:"その他"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:l,className:"btn-secondary",children:"キャンセル"}),e.jsx("button",{type:"submit",className:"btn-primary",children:"作成"})]})]})]})})};export{we as default};
