import{j as e}from"./index-a37bae51-1750549093763.js";import{r as t}from"./vendor-18e24f2a-1750549093763.js";import{s}from"./storage-afc0bc2e-1750549093763.js";import{c as a}from"./dateUtils-d91f8443-1750549093763.js";import{P as i,o as l}from"./icons-6c88ec70-1750549093763.js";import"./routing-b3bac0e0-1750549093763.js";import"./supabase-195fc627-1750549093763.js";const n=()=>{const[l,n]=t.useState([]),[d,x]=t.useState([]),[m,p]=t.useState(!1),[u,g]=t.useState("active");t.useEffect(()=>{h()},[]);const h=()=>{const e=s.getRateRules();n(e),x(s.getUsers().filter(e=>"CHILD"===e.role))},b=e=>{if(confirm("このレート設定を削除してもよろしいですか？")){const t=l.filter(t=>t.id!==e);n(t),s.saveRateRules(t)}},j=e=>{const t=l.map(t=>t.id===e?{...t,isActive:!t.isActive}:t);n(t),s.saveRateRules(t)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-purple-800",children:"⚙️ レート設定システム"}),e.jsxs("button",{onClick:()=>p(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(i,{className:"w-5 h-5"}),"✨ 新しいレート設定"]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsxs("button",{onClick:()=>g("active"),className:"px-6 py-3 rounded-full font-bold transition-all "+("active"===u?"bg-gradient-to-r from-green-500 to-blue-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:["🔥 適用中のレート (",l.filter(e=>e.isActive).length,")"]}),e.jsxs("button",{onClick:()=>g("rules"),className:"px-6 py-3 rounded-full font-bold transition-all "+("rules"===u?"bg-gradient-to-r from-green-500 to-blue-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:["📋 全レート設定 (",l.length,")"]}),e.jsx("button",{onClick:()=>g("preview"),className:"px-6 py-3 rounded-full font-bold transition-all "+("preview"===u?"bg-gradient-to-r from-green-500 to-blue-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"👀 ポイント計算プレビュー"})]}),"active"===u&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-green-700 mb-4",children:"🔥 現在適用中のレート設定"}),e.jsxs("div",{className:"space-y-4",children:[l.filter(e=>e.isActive).map(t=>e.jsx(r,{rate:t,onToggle:j,onDelete:b,children:d},t.id)),0===l.filter(e=>e.isActive).length&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-green-600",children:"📝 現在適用中のレート設定はありません"}),e.jsx("p",{className:"text-green-500 text-sm mt-2",children:"新しいレート設定を作成してみてください。"})]})]})]}),"rules"===u&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-700 mb-4",children:"📋 すべてのレート設定"}),e.jsxs("div",{className:"space-y-4",children:[l.map(t=>e.jsx(r,{rate:t,onToggle:j,onDelete:b,children:d},t.id)),0===l.length&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-600",children:"📝 まだレート設定がありません"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"最初のレート設定を作成してみてください。"})]})]})]}),"preview"===u&&e.jsx(o,{children:d,previewFunction:(e,t,s)=>{const i=d.find(t=>t.id===e);if(!i)return{finalPoints:t,appliedRules:[]};const n=i.birthDate?a(i.birthDate):i.age||0,r=new Date;let o=t,c=[];return l.filter(e=>e.isActive).forEach(e=>{let t=!1;switch(e.type){case"AGE_BASED":void 0!==e.conditions.minAge&&n>=e.conditions.minAge&&(void 0===e.conditions.maxAge||n<=e.conditions.maxAge)&&(t=!0);break;case"PERIOD_BASED":if(e.conditions.startDate&&e.conditions.endDate){const a=new Date(e.conditions.startDate),i=new Date(e.conditions.endDate);r>=a&&r<=i&&(e.conditions.taskCategory&&e.conditions.taskCategory!==s||(t=!0))}break;case"PERFORMANCE_BASED":e.conditions.taskCategory&&e.conditions.taskCategory!==s||(t=!0)}t&&(o=Math.round(o*e.multiplier),e.bonusPoints&&(o+=e.bonusPoints),c.push(e.name))}),{finalPoints:o,appliedRules:c}},getActiveRules:e=>{const t=d.find(t=>t.id===e);if(!t)return[];const s=t.birthDate?a(t.birthDate):t.age||0,i=new Date;return l.filter(e=>e.isActive).filter(e=>{switch(e.type){case"AGE_BASED":return void 0!==e.conditions.minAge&&s>=e.conditions.minAge&&(void 0===e.conditions.maxAge||s<=e.conditions.maxAge);case"PERIOD_BASED":if(e.conditions.startDate&&e.conditions.endDate){const t=new Date(e.conditions.startDate),s=new Date(e.conditions.endDate);return i>=t&&i<=s}return!1;case"PERFORMANCE_BASED":return!0;default:return!1}})}})]}),m&&e.jsx(c,{onClose:()=>p(!1),onSave:h,children:d})]})},r=({rate:t,onToggle:s,onDelete:a})=>e.jsxs("div",{className:"p-6 rounded-2xl border-2 shadow-lg transition-all "+(t.isActive?"bg-gradient-to-br from-green-50 to-blue-50 border-green-300":"bg-gradient-to-br from-gray-50 to-gray-100 border-gray-300"),children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-2xl",children:(e=>{switch(e){case"AGE_BASED":return"👶";case"PERIOD_BASED":return"📅";case"PERFORMANCE_BASED":return"🏆";default:return"⚙️"}})(t.type)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800",children:t.name}),e.jsx("p",{className:"text-sm text-gray-600",children:(e=>{switch(e){case"AGE_BASED":return"年齢ベース";case"PERIOD_BASED":return"期間ベース";case"PERFORMANCE_BASED":return"実績ベース";default:return e}})(t.type)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>s(t.id),className:"px-4 py-2 rounded-full text-sm font-medium transition-all "+(t.isActive?"bg-green-500 text-white hover:bg-green-600":"bg-gray-300 text-gray-700 hover:bg-gray-400"),children:t.isActive?"有効":"無効"}),e.jsx("button",{onClick:()=>a(t.id),className:"p-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-full transition-colors",title:"削除",children:e.jsx(l,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"p-3 bg-white rounded-lg border border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"適用条件"}),e.jsx("p",{className:"font-medium text-gray-800",children:(e=>{switch(e.type){case"AGE_BASED":if(void 0!==e.conditions.minAge){const t=void 0!==e.conditions.maxAge?`${e.conditions.maxAge}歳`:"以上";return`${e.conditions.minAge}歳${void 0!==e.conditions.maxAge?`～${t}`:"以上"}`}return"年齢条件なし";case"PERIOD_BASED":if(e.conditions.startDate&&e.conditions.endDate){return`${new Date(e.conditions.startDate).toLocaleDateString("ja-JP")} ～ ${new Date(e.conditions.endDate).toLocaleDateString("ja-JP")}`}return"期間設定なし";case"PERFORMANCE_BASED":return e.conditions.completionCount?`${e.conditions.completionCount}回以上完了`:"実績条件なし";default:return"条件不明"}})(t)})]}),e.jsxs("div",{className:"p-3 bg-white rounded-lg border border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"ポイント倍率"}),e.jsxs("p",{className:"font-bold text-blue-600",children:[t.multiplier,"x"]})]}),t.bonusPoints&&e.jsxs("div",{className:"p-3 bg-white rounded-lg border border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"ボーナス"}),e.jsxs("p",{className:"font-bold text-green-600",children:["+",t.bonusPoints,"pt"]})]})]}),e.jsx("p",{className:"text-sm text-gray-700 mb-3",children:t.description}),t.conditions.taskCategory&&e.jsxs("div",{className:"inline-block px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-xs font-medium",children:["対象: ",t.conditions.taskCategory]})]}),o=({children:s,previewFunction:i,getActiveRules:l})=>{const[n,r]=t.useState(10),[o,d]=t.useState("家事");return e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-blue-700 mb-4",children:"👀 ポイント計算プレビュー"}),e.jsx("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-blue-700 mb-2",children:"基本ポイント"}),e.jsx("input",{type:"number",value:n,onChange:e=>r(parseInt(e.target.value)||10),className:"input-field",min:"1",max:"100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-blue-700 mb-2",children:"カテゴリ"}),e.jsx("select",{value:o,onChange:e=>d(e.target.value),className:"input-field",children:["家事","勉強","運動","その他"].map(t=>e.jsx("option",{value:t,children:t},t))})]})]})}),e.jsxs("div",{className:"space-y-4",children:[s.map(t=>{const{finalPoints:s,appliedRules:r}=i(t.id,n,o),d=l(t.id);return e.jsxs("div",{className:"p-4 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-lg border border-yellow-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-orange-800",children:t.name}),e.jsx("p",{className:"text-sm text-orange-600",children:t.birthDate?`${a(t.birthDate)}歳`:`${t.age||0}歳`})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold text-orange-700",children:[s,"pt"]}),e.jsxs("p",{className:"text-xs text-orange-600",children:["基本 ",n,"pt → 最終 ",s,"pt"]})]})]}),r.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-xs text-orange-600 mb-2",children:"適用されたレート:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.map((t,s)=>e.jsx("span",{className:"px-2 py-1 bg-orange-200 text-orange-800 rounded-full text-xs",children:t},s))})]}),0===d.length&&e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"このお子様に適用されるレート設定はありません"})]},t.id)}),0===s.length&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"お子様が登録されていません"})})]})]})},d=e=>"AGE_BASED"===e.type?{minAge:e.minAge?parseInt(e.minAge):void 0,maxAge:e.maxAge?parseInt(e.maxAge):void 0}:"PERIOD_BASED"===e.type?{startDate:e.startDate?new Date(e.startDate):void 0,endDate:e.endDate?new Date(e.endDate):void 0,taskCategory:e.taskCategory||void 0}:"PERFORMANCE_BASED"===e.type?{completionCount:e.completionCount?parseInt(e.completionCount):void 0,taskCategory:e.taskCategory||void 0}:{},c=({onClose:a,onSave:l})=>{const[n,r]=t.useState({name:"",type:"AGE_BASED",description:"",multiplier:1,bonusPoints:0,minAge:"",maxAge:"",startDate:"",endDate:"",taskCategory:"",completionCount:""});return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 rounded-3xl p-8 w-full max-w-2xl border-4 border-purple-300 shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-2xl font-bold text-purple-800 mb-6 text-center",children:"⚙️ 新しいレート設定を作成"}),e.jsxs("form",{onSubmit:e=>{e.preventDefault();const t=s.getRateRules(),i={id:s.generateId(),name:n.name,type:n.type,description:n.description,multiplier:n.multiplier,bonusPoints:n.bonusPoints>0?n.bonusPoints:void 0,conditions:d(n),isActive:!0,createdAt:new Date};t.push(i),s.saveRateRules(t),l(),a()},className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"📝 設定名"}),e.jsx("input",{type:"text",value:n.name,onChange:e=>r({...n,name:e.target.value}),className:"input-field",placeholder:"例: 小学生ボーナス",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"⚙️ タイプ"}),e.jsxs("select",{value:n.type,onChange:e=>r({...n,type:e.target.value}),className:"input-field",children:[e.jsx("option",{value:"AGE_BASED",children:"👶 年齢ベース"}),e.jsx("option",{value:"PERIOD_BASED",children:"📅 期間ベース"}),e.jsx("option",{value:"PERFORMANCE_BASED",children:"🏆 実績ベース"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"📋 説明"}),e.jsx("textarea",{value:n.description,onChange:e=>r({...n,description:e.target.value}),className:"input-field",rows:3,placeholder:"このレート設定の目的や適用条件を説明してください",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"✨ ポイント倍率"}),e.jsx("input",{type:"number",step:"0.1",min:"0.1",max:"10",value:n.multiplier,onChange:e=>r({...n,multiplier:parseFloat(e.target.value)||1}),className:"input-field",required:!0}),e.jsx("p",{className:"text-xs text-purple-600 mt-1",children:"基本ポイントにかける倍率 (例: 1.5 = 1.5倍)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"🎁 ボーナスポイント"}),e.jsx("input",{type:"number",min:"0",value:n.bonusPoints,onChange:e=>r({...n,bonusPoints:parseInt(e.target.value)||0}),className:"input-field"}),e.jsx("p",{className:"text-xs text-purple-600 mt-1",children:"倍率適用後に追加するボーナス"})]})]}),e.jsxs("div",{className:"p-4 bg-white rounded-lg border border-purple-200",children:[e.jsx("h4",{className:"font-bold text-purple-700 mb-4",children:"🎯 適用条件"}),"AGE_BASED"===n.type&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-purple-700 mb-2",children:"最小年齢"}),e.jsx("input",{type:"number",min:"0",max:"18",value:n.minAge,onChange:e=>r({...n,minAge:e.target.value}),className:"input-field",placeholder:"例: 6"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-purple-700 mb-2",children:"最大年齢（任意）"}),e.jsx("input",{type:"number",min:"0",max:"18",value:n.maxAge,onChange:e=>r({...n,maxAge:e.target.value}),className:"input-field",placeholder:"例: 12"})]})]}),"PERIOD_BASED"===n.type&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-purple-700 mb-2",children:"開始日"}),e.jsx("input",{type:"date",value:n.startDate,onChange:e=>r({...n,startDate:e.target.value}),className:"input-field",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-purple-700 mb-2",children:"終了日"}),e.jsx("input",{type:"date",value:n.endDate,onChange:e=>r({...n,endDate:e.target.value}),className:"input-field",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-purple-700 mb-2",children:"対象カテゴリ（任意）"}),e.jsxs("select",{value:n.taskCategory,onChange:e=>r({...n,taskCategory:e.target.value}),className:"input-field",children:[e.jsx("option",{value:"",children:"すべてのカテゴリ"}),e.jsx("option",{value:"家事",children:"家事"}),e.jsx("option",{value:"勉強",children:"勉強"}),e.jsx("option",{value:"運動",children:"運動"}),e.jsx("option",{value:"その他",children:"その他"})]})]})]}),"PERFORMANCE_BASED"===n.type&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-purple-700 mb-2",children:"必要完了回数"}),e.jsx("input",{type:"number",min:"1",value:n.completionCount,onChange:e=>r({...n,completionCount:e.target.value}),className:"input-field",placeholder:"例: 10"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-purple-700 mb-2",children:"対象カテゴリ（任意）"}),e.jsxs("select",{value:n.taskCategory,onChange:e=>r({...n,taskCategory:e.target.value}),className:"input-field",children:[e.jsx("option",{value:"",children:"すべてのカテゴリ"}),e.jsx("option",{value:"家事",children:"家事"}),e.jsx("option",{value:"勉強",children:"勉強"}),e.jsx("option",{value:"運動",children:"運動"}),e.jsx("option",{value:"その他",children:"その他"})]})]})]})]}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{type:"button",onClick:a,className:"btn-secondary text-lg px-8",children:"🔙 キャンセル"}),e.jsxs("button",{type:"submit",className:"btn-primary text-lg flex items-center gap-3 px-8",children:[e.jsx(i,{className:"w-6 h-6"}),"⚙️ 作成"]})]})]})]})})};export{n as default};
