import{u as B,j as e}from"./index-55d7bea8.js";import{r as o}from"./vendor-ce4ffebd.js";import{s as m}from"./storage-8020bd0d.js";import{c as E}from"./dateUtils-280973c0.js";import{W as A,j as D,t as Y,u as P,v as k,H as I}from"./icons-ce793056.js";import"./routing-89dfa7f7.js";import"./supabase-e6e84841.js";const W=({children:i})=>{B();const[n,f]=o.useState(""),[r,h]=o.useState(100),[a]=o.useState({pointsPerYen:10,minimumExchange:100}),[x,p]=o.useState("exchange"),[b,$]=o.useState({});o.useEffect(()=>{i.length>0&&!n&&f(i[0].id)},[i,n]),o.useEffect(()=>{v()},[i]);const v=()=>{const t={};i.forEach(s=>{const l=m.getPointTransactions().filter(d=>d.userId===s.id),g=l.filter(d=>d.type==="EARNED").reduce((d,N)=>d+N.amount,0),j=l.filter(d=>d.type==="EXCHANGED").reduce((d,N)=>d+N.amount,0),S=g-j,T=Math.floor(j/a.pointsPerYen);t[s.id]={totalEarned:g,totalSpent:j,currentBalance:S,totalExchanged:T}}),$(t)},C=()=>{if(!n||r<a.minimumExchange)return;const t=b[n];if(!t||t.currentBalance<r){alert("残高が不足しています。");return}const s=Math.floor(r/a.pointsPerYen);if(confirm(`${r}ポイントを${s}円に交換しますか？`)){const l=m.getPointTransactions(),g={id:m.generateId(),userId:n,type:"EXCHANGED",amount:r,description:`ポイント交換: ${r}pt → ${s}円`,createdAt:new Date};l.push(g),m.savePointTransactions(l),v(),h(a.minimumExchange),alert(`交換完了！${s}円をお渡ししてください。`)}},y=t=>m.getPointTransactions().filter(s=>s.userId===t&&s.type==="EXCHANGED").sort((s,l)=>new Date(l.createdAt).getTime()-new Date(s.createdAt).getTime()),c=b[n],w=Math.floor(r/a.pointsPerYen),u=r>=a.minimumExchange&&c&&c.currentBalance>=r;return i.length===0?e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(A,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-bold text-gray-700 mb-2",children:"まだお子様が登録されていません"}),e.jsx("p",{className:"text-gray-500",children:"ポイント交換を利用するには、まずお子様を登録してください。"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-purple-800",children:"💰 ポイント交換システム"}),e.jsxs("div",{className:"flex items-center gap-3 bg-gradient-to-r from-green-100 to-blue-100 px-4 py-2 rounded-full border-2 border-green-300",children:[e.jsx(D,{className:"w-6 h-6 text-green-600"}),e.jsxs("span",{className:"font-bold text-green-800",children:[a.pointsPerYen,"ポイント = 1円"]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"👧 お子様を選択"}),e.jsx("select",{value:n,onChange:t=>f(t.target.value),className:"input-field max-w-md",children:i.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.birthDate?`${E(t.birthDate)}歳`:`${t.age||0}歳`,")"]},t.id))})]}),c&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"p-4 bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl border-2 border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(D,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-600 text-sm font-medium",children:"獲得総ポイント"}),e.jsx("p",{className:"text-2xl font-bold text-blue-800",children:c.totalEarned})]})]})}),e.jsx("div",{className:"p-4 bg-gradient-to-br from-green-50 to-green-100 rounded-2xl border-2 border-green-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-green-600 text-sm font-medium",children:"現在の残高"}),e.jsx("p",{className:"text-2xl font-bold text-green-800",children:c.currentBalance})]})]})}),e.jsx("div",{className:"p-4 bg-gradient-to-br from-red-50 to-red-100 rounded-2xl border-2 border-red-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Y,{className:"w-8 h-8 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-600 text-sm font-medium",children:"使用ポイント"}),e.jsx("p",{className:"text-2xl font-bold text-red-800",children:c.totalSpent})]})]})}),e.jsx("div",{className:"p-4 bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-2xl border-2 border-yellow-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{className:"w-8 h-8 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-yellow-600 text-sm font-medium",children:"交換総金額"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-800",children:["¥",c.totalExchanged]})]})]})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx("button",{onClick:()=>p("exchange"),className:`px-6 py-3 rounded-full font-bold transition-all ${x==="exchange"?"bg-gradient-to-r from-green-500 to-blue-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"💱 ポイント交換"}),e.jsx("button",{onClick:()=>p("history"),className:`px-6 py-3 rounded-full font-bold transition-all ${x==="history"?"bg-gradient-to-r from-green-500 to-blue-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"📜 交換履歴"}),e.jsx("button",{onClick:()=>p("balance"),className:`px-6 py-3 rounded-full font-bold transition-all ${x==="balance"?"bg-gradient-to-r from-green-500 to-blue-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"💰 全体残高"})]}),x==="exchange"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-green-700 mb-6",children:"💱 ポイント交換"}),e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-lg font-bold text-green-700 mb-3",children:"交換するポイント数"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:r,onChange:t=>h(parseInt(t.target.value)||0),className:"input-field text-center text-2xl pr-16",min:a.minimumExchange,step:a.pointsPerYen,placeholder:"100"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-green-600 font-bold",children:"pt"})]}),e.jsxs("p",{className:"text-sm text-green-600 mt-2 text-center",children:["最小交換: ",a.minimumExchange,"ポイント"]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-3xl font-bold text-green-600",children:[r,"pt"]}),e.jsx("div",{className:"text-sm text-green-700",children:"ポイント"})]}),e.jsx(k,{className:"w-8 h-8 text-gray-400"}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-3xl font-bold text-blue-600",children:["¥",w]}),e.jsx("div",{className:"text-sm text-blue-700",children:"円"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-yellow-50 rounded-lg border border-yellow-200",children:e.jsxs("p",{className:"text-yellow-800 text-sm",children:[e.jsx("strong",{children:"注意:"})," 交換したポイントは元に戻せません。"]})}),e.jsx("button",{onClick:C,disabled:!u,className:`w-full py-4 px-6 rounded-2xl font-bold text-lg transition-all ${u?"bg-gradient-to-r from-green-500 to-blue-500 text-white hover:shadow-lg":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:u?`💰 ${w}円に交換する`:r<a.minimumExchange?`最小${a.minimumExchange}ポイント必要`:"残高が不足しています"})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-3 text-center",children:"クイック交換"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[100,500,1e3].map(t=>{const s=Math.floor(t/a.pointsPerYen),l=c&&c.currentBalance>=t;return e.jsxs("button",{onClick:()=>h(t),disabled:!l,className:`p-3 rounded-lg text-sm font-medium transition-all ${l?"bg-blue-100 text-blue-700 hover:bg-blue-200":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:[t,"pt",e.jsx("br",{}),"¥",s]},t)})})]})]})]}),x==="history"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-blue-700 mb-6",children:"📜 交換履歴"}),e.jsxs("div",{className:"space-y-3",children:[y(n).map(t=>{const s=Math.floor(t.amount/a.pointsPerYen);return e.jsx("div",{className:"p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{className:"w-6 h-6 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gray-800",children:t.description}),e.jsxs("p",{className:"text-sm text-gray-600",children:[new Date(t.createdAt).toLocaleDateString("ja-JP")," ",new Date(t.createdAt).toLocaleTimeString("ja-JP")]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-red-600",children:["-",t.amount,"pt"]}),e.jsxs("p",{className:"text-sm font-bold text-green-600",children:["+¥",s]})]})]})},t.id)}),y(n).length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(I,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"まだ交換履歴がありません"})]})]})]}),x==="balance"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-purple-700 mb-6",children:"💰 全体残高"}),e.jsx("div",{className:"space-y-4",children:i.map(t=>{const s=b[t.id];return s?e.jsxs("div",{className:"p-6 bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl border-2 border-purple-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-xl font-bold text-purple-800",children:t.name}),e.jsx("p",{className:"text-purple-600",children:t.birthDate?`${E(t.birthDate)}歳`:`${t.age||0}歳`})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold text-purple-700",children:[s.currentBalance,"pt"]}),e.jsx("p",{className:"text-sm text-purple-600",children:"現在の残高"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-3 bg-white rounded-lg border border-purple-200",children:[e.jsx("p",{className:"text-xs text-purple-600 mb-1",children:"獲得総数"}),e.jsxs("p",{className:"font-bold text-purple-800",children:[s.totalEarned,"pt"]})]}),e.jsxs("div",{className:"p-3 bg-white rounded-lg border border-purple-200",children:[e.jsx("p",{className:"text-xs text-purple-600 mb-1",children:"使用総数"}),e.jsxs("p",{className:"font-bold text-red-600",children:[s.totalSpent,"pt"]})]}),e.jsxs("div",{className:"p-3 bg-white rounded-lg border border-purple-200",children:[e.jsx("p",{className:"text-xs text-purple-600 mb-1",children:"交換総額"}),e.jsxs("p",{className:"font-bold text-green-600",children:["¥",s.totalExchanged]})]})]})]},t.id):null})})]})]})]})};export{W as default};
