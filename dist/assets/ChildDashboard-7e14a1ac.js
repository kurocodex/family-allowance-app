import{_ as $}from"./supabase-e6e84841.js";import{u as H,j as e}from"./index-55d7bea8.js";import{b as L,r as i}from"./vendor-ce4ffebd.js";import{d as b}from"./database-94fba64c.js";import{g as I,o as w,h as q,i as z,p as B,l as A,C as P}from"./icons-ce793056.js";import"./routing-89dfa7f7.js";const J=L.lazy(()=>$(()=>import("./EventManagement-3dbf4a99.js"),["assets/EventManagement-3dbf4a99.js","assets/index-55d7bea8.js","assets/vendor-ce4ffebd.js","assets/routing-89dfa7f7.js","assets/supabase-e6e84841.js","assets/icons-ce793056.js","assets/index-1beb27b5.css","assets/storage-8020bd0d.js","assets/dateUtils-280973c0.js"])),ee=()=>{const{user:s}=H(),[d,h]=i.useState([]),[o,x]=i.useState([]),[g,r]=i.useState(0),[u,l]=i.useState(null),[a,m]=i.useState("tasks"),[j,T]=i.useState(!0),[C,N]=i.useState(null);i.useEffect(()=>{s!=null&&s.familyId&&f()},[s==null?void 0:s.familyId]);const f=async()=>{if(s!=null&&s.familyId)try{T(!0),N(null);const[t,n,p]=await Promise.all([b.getTasks(s.familyId),b.getTaskCompletions(s.familyId),b.getPointTransactions(s.familyId)]);h(t),x(n.filter(c=>c.childId===s.id));const S=p.filter(c=>c.userId===s.id),O=S.filter(c=>c.type==="EARNED").reduce((c,v)=>c+v.amount,0),G=S.filter(c=>c.type==="EXCHANGED").reduce((c,v)=>c+v.amount,0),V=O-G;r(V)}catch(t){console.error("データ読み込みエラー:",t),N("データベースの初期設定が必要です。Supabaseでdatabase-schema.sqlを実行してください。")}finally{T(!1)}},M=async(t,n)=>{if(s!=null&&s.familyId)try{await b.createTaskCompletion({taskId:t,childId:s.id,status:"PENDING",submittedAt:new Date,comments:n},s.familyId),await f(),l(null)}catch(p){console.error("タスク提出エラー:",p),N("タスクの提出に失敗しました")}},y=t=>{const n=o.find(p=>p.taskId===t);return(n==null?void 0:n.status)||null},R=t=>{switch(t){case"EASY":return"text-green-600 bg-green-100";case"MEDIUM":return"text-yellow-600 bg-yellow-100";case"HARD":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},_=t=>{switch(t){case"EASY":return"かんたん";case"MEDIUM":return"ふつう";case"HARD":return"むずかしい";default:return t}},D=d.filter(t=>{const n=y(t.id);return(!t.assignedTo||t.assignedTo===(s==null?void 0:s.id))&&(!n||n==="REJECTED")}),k=d.filter(t=>{const n=y(t.id);return(!t.assignedTo||t.assignedTo===(s==null?void 0:s.id))&&n==="PENDING"}),E=d.filter(t=>{const n=y(t.id);return(!t.assignedTo||t.assignedTo===(s==null?void 0:s.id))&&n==="APPROVED"});return j?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-purple-500 border-t-transparent mx-auto mb-4"}),e.jsx("p",{className:"text-purple-600 text-lg font-medium",children:"データを読み込み中..."})]})}):C?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-red-600 text-lg mb-4",children:C}),e.jsx("button",{onClick:f,className:"btn-primary",children:"再読み込み"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("h2",{className:"text-3xl font-bold text-purple-800 mb-4",children:["🌟 こんにちは、",s==null?void 0:s.name,"さん！"]}),e.jsxs("div",{className:"inline-flex items-center gap-3 bg-gradient-to-r from-yellow-200 to-orange-200 text-orange-800 px-6 py-4 rounded-full shadow-lg border-2 border-yellow-300",children:[e.jsx(I,{className:"w-8 h-8 animate-pulse"}),e.jsxs("span",{className:"font-bold text-2xl",children:[g," ✨ポイント"]})]}),e.jsx("p",{className:"text-purple-500 text-sm mt-1",children:"💰 あなたの残高ポイントです"}),e.jsx("p",{className:"text-purple-600 mt-3 text-lg",children:"🎮 クエストをクリアしてポイントをゲットしよう！"})]}),e.jsxs("div",{className:"flex justify-center gap-4 mb-6",children:[e.jsxs("button",{onClick:()=>m("tasks"),className:`px-6 py-3 rounded-full font-bold transition-all flex items-center gap-2 ${a==="tasks"?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx(w,{className:"w-5 h-5"}),"🎯 クエスト"]}),e.jsxs("button",{onClick:()=>m("events"),className:`px-6 py-3 rounded-full font-bold transition-all flex items-center gap-2 ${a==="events"?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx(q,{className:"w-5 h-5"}),"🎉 イベント"]}),e.jsxs("button",{onClick:()=>m("stats"),className:`px-6 py-3 rounded-full font-bold transition-all flex items-center gap-2 ${a==="stats"?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx(z,{className:"w-5 h-5"}),"📊 せいせき"]})]}),a==="events"?e.jsx(i.Suspense,{fallback:e.jsx("div",{className:"text-center py-8",children:"イベントを読み込み中..."}),children:e.jsx(J,{})}):a==="stats"?e.jsx(Y,{user:s,tasks:d,completions:o,totalPoints:g}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card-cute",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(w,{className:"w-8 h-8 text-yellow-500 animate-spin"}),e.jsx("h3",{className:"text-xl font-bold text-purple-700",children:"🎯 クエスト一覧"})]}),e.jsxs("div",{className:"space-y-4",children:[D.map(t=>e.jsxs("div",{className:"quest-card",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("h4",{className:"font-bold text-orange-800",children:t.title}),e.jsxs("span",{className:"font-bold text-purple-600 text-lg bg-white px-3 py-1 rounded-full border-2 border-purple-300",children:[t.points,"pt 💎"]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:`text-xs px-3 py-1 rounded-full font-medium ${R(t.difficulty)}`,children:_(t.difficulty)}),e.jsx("span",{className:"text-xs text-orange-700 bg-orange-200 px-2 py-1 rounded-full",children:t.category})]}),e.jsx("p",{className:"text-sm text-orange-800 mb-4 font-medium",children:t.description}),e.jsxs("button",{onClick:()=>l(t),className:"w-full btn-primary text-sm flex items-center justify-center gap-2",children:[e.jsx(B,{className:"w-4 h-4"}),"🚀 チャレンジ！"]})]},t.id)),D.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-purple-600 text-lg",children:"🎉 すべてのクエストクリア！"}),e.jsx("p",{className:"text-purple-500 text-sm mt-2",children:"新しいクエストを待とう！"})]})]})]}),e.jsxs("div",{className:"card-cute",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(A,{className:"w-8 h-8 text-blue-500 animate-pulse"}),e.jsx("h3",{className:"text-xl font-bold text-blue-700",children:"⏰ 確認まち"})]}),e.jsxs("div",{className:"space-y-3",children:[k.map(t=>e.jsxs("div",{className:"pending-card",children:[e.jsx("h4",{className:"font-bold text-blue-800",children:t.title}),e.jsx("p",{className:"text-sm text-blue-600 mb-3",children:t.category}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-sm text-blue-700 font-medium",children:"👀 パパママが確認中..."})]})]},t.id)),k.length===0&&e.jsx("div",{className:"text-center py-6",children:e.jsx("p",{className:"text-blue-600",children:"📝 確認まちのクエストはありません"})})]})]}),e.jsxs("div",{className:"card-cute",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(P,{className:"w-8 h-8 text-green-500 animate-bounce"}),e.jsx("h3",{className:"text-xl font-bold text-green-700",children:"🎉 クリア済み"})]}),e.jsxs("div",{className:"space-y-3",children:[E.slice(0,5).map(t=>e.jsxs("div",{className:"completed-card",children:[e.jsx("h4",{className:"font-bold text-green-800",children:t.title}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm text-green-600 font-medium",children:t.category}),e.jsxs("span",{className:"text-lg font-bold text-green-600 bg-white px-3 py-1 rounded-full border-2 border-green-300",children:["+",t.points,"pt ✨"]})]})]},t.id)),E.length===0&&e.jsxs("div",{className:"text-center py-6",children:[e.jsx("p",{className:"text-green-600",children:"🏆 まだクリアしたクエストはありません"}),e.jsx("p",{className:"text-green-500 text-sm mt-2",children:"がんばってクエストにチャレンジしよう！"})]})]})]})]}),u&&e.jsx(U,{task:u,onClose:()=>l(null),onSubmit:M})]})},U=({task:s,onClose:d,onSubmit:h})=>{const[o,x]=i.useState(""),g=r=>{r.preventDefault(),h(s.id,o)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 rounded-3xl p-8 w-full max-w-md border-4 border-purple-300 shadow-2xl",children:[e.jsx("h3",{className:"text-2xl font-bold text-purple-800 mb-6 text-center",children:"🎯 クエスト報告"}),e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-yellow-100 to-orange-100 rounded-2xl border-2 border-yellow-300",children:[e.jsx("h4",{className:"font-bold text-orange-800 text-lg",children:s.title}),e.jsx("p",{className:"text-sm text-orange-700 mt-2 font-medium",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsx("span",{className:"text-sm text-orange-600 bg-orange-200 px-3 py-1 rounded-full font-medium",children:s.category}),e.jsxs("span",{className:"font-bold text-purple-600 text-xl bg-white px-4 py-2 rounded-full border-2 border-purple-300",children:[s.points,"pt 💎"]})]})]}),e.jsxs("form",{onSubmit:g,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-3",children:"📝 どんなふうにやったか教えてね！"}),e.jsx("textarea",{value:o,onChange:r=>x(r.target.value),className:"input-field text-lg",rows:4,placeholder:"がんばったことや、きづいたことを書いてね✨"})]}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{type:"button",onClick:d,className:"btn-secondary text-lg px-8",children:"🔙 やめる"}),e.jsxs("button",{type:"submit",className:"btn-primary text-lg flex items-center gap-3 px-8",children:[e.jsx(P,{className:"w-6 h-6"}),"🚀 ほうこく"]})]})]})]})})},Y=({user:s,tasks:d,completions:h,totalPoints:o})=>{const x=h.filter(l=>l.status==="APPROVED"),g=h.filter(l=>l.status==="PENDING"),r={};x.forEach(l=>{const a=d.find(m=>m.id===l.taskId);a&&(r[a.category]=(r[a.category]||0)+1)});const u=x.sort((l,a)=>new Date(a.submittedAt).getTime()-new Date(l.submittedAt).getTime()).slice(0,5);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"card-cute bg-gradient-to-br from-blue-100 to-blue-200",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-2",children:"🏆"}),e.jsx("h3",{className:"text-xl font-bold text-blue-800 mb-1",children:"クリア数"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:x.length}),e.jsx("p",{className:"text-sm text-blue-700",children:"がんばったね！"})]})}),e.jsx("div",{className:"card-cute bg-gradient-to-br from-yellow-100 to-yellow-200",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-2",children:"💰"}),e.jsx("h3",{className:"text-xl font-bold text-yellow-800 mb-1",children:"残高"}),e.jsxs("p",{className:"text-3xl font-bold text-yellow-900",children:[o,"pt"]}),e.jsx("p",{className:"text-sm text-yellow-700",children:"お金に変えられるよ！"})]})}),e.jsx("div",{className:"card-cute bg-gradient-to-br from-purple-100 to-purple-200",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-2",children:"⏰"}),e.jsx("h3",{className:"text-xl font-bold text-purple-800 mb-1",children:"確認まち"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:g.length}),e.jsx("p",{className:"text-sm text-purple-700",children:"まってるよ！"})]})})]}),e.jsxs("div",{className:"card-cute",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(I,{className:"w-8 h-8 text-green-500 animate-bounce"}),e.jsx("h3",{className:"text-xl font-bold text-green-700",children:"🌟 がんばったこと"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[Object.entries(r).map(([l,a])=>{const j={家事:"🏠",勉強:"📚",運動:"🏃‍♀️",その他:"⭐"}[l]||"🌟";return e.jsxs("div",{className:"text-center p-4 bg-gradient-to-br from-green-50 to-green-100 rounded-2xl border-2 border-green-200",children:[e.jsx("div",{className:"text-3xl mb-2",children:j}),e.jsx("h4",{className:"font-bold text-green-800 mb-1",children:l}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:a}),e.jsx("p",{className:"text-xs text-green-700",children:"回できた！"})]},l)}),Object.keys(r).length===0&&e.jsxs("div",{className:"col-span-full text-center py-8",children:[e.jsx("p",{className:"text-gray-500",children:"まだクリアしたクエストがないよ"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"がんばってチャレンジしよう！"})]})]})]}),e.jsxs("div",{className:"card-cute",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(w,{className:"w-8 h-8 text-orange-500 animate-pulse"}),e.jsx("h3",{className:"text-xl font-bold text-orange-700",children:"🎉 さいきんのがんばり"})]}),e.jsxs("div",{className:"space-y-3",children:[u.map(l=>{const a=d.find(m=>m.id===l.taskId);return a?e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gradient-to-r from-orange-50 to-yellow-50 rounded-2xl border-2 border-orange-200",children:[e.jsx("div",{className:"text-2xl",children:"🏅"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-orange-800",children:a.title}),e.jsx("p",{className:"text-sm text-orange-600",children:a.category})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-lg text-orange-700",children:["+",a.points,"pt"]}),e.jsx("p",{className:"text-xs text-orange-600",children:new Date(l.submittedAt).toLocaleDateString("ja-JP")})]})]},l.id):null}),u.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-orange-500",children:"まだクリアしたクエストがないよ"}),e.jsx("p",{className:"text-orange-400 text-sm",children:"クエストにチャレンジしてみよう！"})]})]})]}),e.jsx("div",{className:"card-cute bg-gradient-to-br from-pink-100 to-purple-100 border-2 border-pink-300",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"🎈"}),e.jsxs("h3",{className:"text-xl font-bold text-pink-800 mb-4",children:[s==null?void 0:s.name,"さん、すごいね！"]}),e.jsxs("div",{className:"space-y-2",children:[x.length>=10&&e.jsx("p",{className:"text-pink-700 font-medium",children:"🌟 クエストマスター！ 10個以上クリアしたよ！"}),o>=100&&e.jsx("p",{className:"text-purple-700 font-medium",children:"💎 ポイントコレクター！ 100ポイント以上ゲット！"}),Object.keys(r).length>=3&&e.jsx("p",{className:"text-blue-700 font-medium",children:"🌈 オールラウンダー！ いろんなことができるね！"}),x.length===0&&e.jsx("p",{className:"text-pink-700 font-medium",children:"✨ がんばってクエストにチャレンジしてみよう！"})]})]})})]})};export{ee as default};
