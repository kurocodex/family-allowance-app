import{_ as e}from"./supabase-c91fe37d.js";import{u as s,j as t}from"./index-71bbfe5a.js";import{r as l,b as a}from"./vendor-18e24f2a.js";import{d as r}from"./database-c6017a67.js";import{h as n,p as c,i,j as d,q as x,m as o,C as m}from"./icons-61d3c260.js";import"./routing-3469486c.js";const p=a.lazy(()=>e(()=>import("./EventManagement-c095f90b.js"),["assets/EventManagement-c095f90b.js","assets/index-71bbfe5a.js","assets/vendor-18e24f2a.js","assets/routing-3469486c.js","assets/supabase-c91fe37d.js","assets/icons-61d3c260.js","assets/index-38644cba.css","assets/storage-afc0bc2e.js","assets/dateUtils-d91f8443.js"])),h=()=>{const{user:e}=s(),{tasks:a,myCompletions:h,myPoints:j,loading:b,error:N,refreshData:f}=function(e){const[s,t]=l.useState([]),[a,n]=l.useState([]),[c,i]=l.useState(0),[d,x]=l.useState(!0),[o,m]=l.useState(null),p=async()=>{if(null==e?void 0:e.familyId)try{x(!0),m(null);const[s,l,a]=await Promise.all([r.getTasks(e.familyId),r.getTaskCompletions(e.familyId),r.getPointTransactions(e.familyId)]);t(s),n(l.filter(s=>s.childId===e.id));const c=a.filter(s=>s.userId===e.id),d=c.filter(e=>"EARNED"===e.type).reduce((e,s)=>e+s.amount,0),o=c.filter(e=>"EXCHANGED"===e.type).reduce((e,s)=>e+s.amount,0);i(d-o)}catch(s){m("データの読み込みに失敗しました。しばらく待ってから再試行してください。")}finally{x(!1)}else x(!1)};return l.useEffect(()=>{p()},[null==e?void 0:e.familyId]),{tasks:s,myCompletions:a,myPoints:c,loading:d,error:o,refreshData:p}}(e),[y,v]=l.useState(null),[w,k]=l.useState("tasks"),D=e=>{const s=h.find(s=>s.taskId===e);return(null==s?void 0:s.status)||null},E=e=>{switch(e){case"EASY":return"text-green-600 bg-green-100";case"MEDIUM":return"text-yellow-600 bg-yellow-100";case"HARD":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},I=e=>{switch(e){case"EASY":return"かんたん";case"MEDIUM":return"ふつう";case"HARD":return"むずかしい";default:return e}},C=a.filter(s=>{const t=D(s.id);return(!s.assignedTo||s.assignedTo===(null==e?void 0:e.id))&&(!t||"REJECTED"===t)}),P=a.filter(s=>{const t=D(s.id);return(!s.assignedTo||s.assignedTo===(null==e?void 0:e.id))&&"PENDING"===t}),S=a.filter(s=>{const t=D(s.id);return(!s.assignedTo||s.assignedTo===(null==e?void 0:e.id))&&"APPROVED"===t});return b?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-purple-500 border-t-transparent mx-auto mb-4"}),t.jsx("p",{className:"text-purple-600 text-lg font-medium",children:"データを読み込み中..."})]})}):N?t.jsxs("div",{className:"text-center py-8",children:[t.jsx("p",{className:"text-red-600 text-lg mb-4",children:N}),t.jsx("button",{onClick:f,className:"btn-primary",children:"再読み込み"})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"text-center",children:[t.jsxs("h2",{className:"text-3xl font-bold text-purple-800 mb-4",children:["🌟 こんにちは、",null==e?void 0:e.name,"さん！"]}),t.jsxs("div",{className:"inline-flex items-center gap-3 bg-gradient-to-r from-yellow-200 to-orange-200 text-orange-800 px-6 py-4 rounded-full shadow-lg border-2 border-yellow-300",children:[t.jsx(n,{className:"w-8 h-8 animate-pulse"}),t.jsxs("span",{className:"font-bold text-2xl",children:[j," ✨ポイント"]})]}),t.jsx("p",{className:"text-purple-500 text-sm mt-1",children:"💰 あなたの残高ポイントです"}),t.jsx("p",{className:"text-purple-600 mt-3 text-lg",children:"🎮 クエストをクリアしてポイントをゲットしよう！"})]}),t.jsxs("div",{className:"flex justify-center gap-4 mb-6",children:[t.jsxs("button",{onClick:()=>k("tasks"),className:"px-6 py-3 rounded-full font-bold transition-all flex items-center gap-2 "+("tasks"===w?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:[t.jsx(c,{className:"w-5 h-5"}),"🎯 クエスト"]}),t.jsxs("button",{onClick:()=>k("events"),className:"px-6 py-3 rounded-full font-bold transition-all flex items-center gap-2 "+("events"===w?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:[t.jsx(i,{className:"w-5 h-5"}),"🎉 イベント"]}),t.jsxs("button",{onClick:()=>k("stats"),className:"px-6 py-3 rounded-full font-bold transition-all flex items-center gap-2 "+("stats"===w?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:[t.jsx(d,{className:"w-5 h-5"}),"📊 せいせき"]})]}),"events"===w?t.jsx(l.Suspense,{fallback:t.jsx("div",{className:"text-center py-8",children:"イベントを読み込み中..."}),children:t.jsx(p,{children:[]})}):"stats"===w?t.jsx(g,{user:e,tasks:a,completions:h,totalPoints:j}):t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"card-cute",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx(c,{className:"w-8 h-8 text-yellow-500 animate-spin"}),t.jsx("h3",{className:"text-xl font-bold text-purple-700",children:"🎯 クエスト一覧"})]}),t.jsxs("div",{className:"space-y-4",children:[C.map(e=>t.jsxs("div",{className:"quest-card",children:[t.jsxs("div",{className:"flex items-start justify-between mb-3",children:[t.jsx("h4",{className:"font-bold text-orange-800",children:e.title}),t.jsxs("span",{className:"font-bold text-purple-600 text-lg bg-white px-3 py-1 rounded-full border-2 border-purple-300",children:[e.points,"pt 💎"]})]}),t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx("span",{className:`text-xs px-3 py-1 rounded-full font-medium ${E(e.difficulty)}`,children:I(e.difficulty)}),t.jsx("span",{className:"text-xs text-orange-700 bg-orange-200 px-2 py-1 rounded-full",children:e.category})]}),t.jsx("p",{className:"text-sm text-orange-800 mb-4 font-medium",children:e.description}),t.jsxs("button",{onClick:()=>v(e),className:"w-full btn-primary text-sm flex items-center justify-center gap-2",children:[t.jsx(x,{className:"w-4 h-4"}),"🚀 チャレンジ！"]})]},e.id)),0===C.length&&t.jsxs("div",{className:"text-center py-8",children:[t.jsx("p",{className:"text-purple-600 text-lg",children:"🎉 すべてのクエストクリア！"}),t.jsx("p",{className:"text-purple-500 text-sm mt-2",children:"新しいクエストを待とう！"})]})]})]}),t.jsxs("div",{className:"card-cute",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx(o,{className:"w-8 h-8 text-blue-500 animate-pulse"}),t.jsx("h3",{className:"text-xl font-bold text-blue-700",children:"⏰ 確認まち"})]}),t.jsxs("div",{className:"space-y-3",children:[P.map(e=>t.jsxs("div",{className:"pending-card",children:[t.jsx("h4",{className:"font-bold text-blue-800",children:e.title}),t.jsx("p",{className:"text-sm text-blue-600 mb-3",children:e.category}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(o,{className:"w-5 h-5 text-blue-600"}),t.jsx("span",{className:"text-sm text-blue-700 font-medium",children:"👀 パパママが確認中..."})]})]},e.id)),0===P.length&&t.jsx("div",{className:"text-center py-6",children:t.jsx("p",{className:"text-blue-600",children:"📝 確認まちのクエストはありません"})})]})]}),t.jsxs("div",{className:"card-cute",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx(m,{className:"w-8 h-8 text-green-500 animate-bounce"}),t.jsx("h3",{className:"text-xl font-bold text-green-700",children:"🎉 クリア済み"})]}),t.jsxs("div",{className:"space-y-3",children:[S.slice(0,5).map(e=>t.jsxs("div",{className:"completed-card",children:[t.jsx("h4",{className:"font-bold text-green-800",children:e.title}),t.jsxs("div",{className:"flex items-center justify-between mt-2",children:[t.jsx("span",{className:"text-sm text-green-600 font-medium",children:e.category}),t.jsxs("span",{className:"text-lg font-bold text-green-600 bg-white px-3 py-1 rounded-full border-2 border-green-300",children:["+",e.points,"pt ✨"]})]})]},e.id)),0===S.length&&t.jsxs("div",{className:"text-center py-6",children:[t.jsx("p",{className:"text-green-600",children:"🏆 まだクリアしたクエストはありません"}),t.jsx("p",{className:"text-green-500 text-sm mt-2",children:"がんばってクエストにチャレンジしよう！"})]})]})]})]}),y&&t.jsx(u,{task:y,onClose:()=>v(null),onSubmit:async(s,t)=>{if(null==e?void 0:e.familyId)try{await r.createTaskCompletion({taskId:s,childId:e.id,status:"PENDING",submittedAt:new Date,comments:t},e.familyId),await f(),v(null)}catch(l){}}})]})},u=({task:e,onClose:s,onSubmit:a})=>{const[r,n]=l.useState("");return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:t.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 rounded-3xl p-8 w-full max-w-md border-4 border-purple-300 shadow-2xl",children:[t.jsx("h3",{className:"text-2xl font-bold text-purple-800 mb-6 text-center",children:"🎯 クエスト報告"}),t.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-yellow-100 to-orange-100 rounded-2xl border-2 border-yellow-300",children:[t.jsx("h4",{className:"font-bold text-orange-800 text-lg",children:e.title}),t.jsx("p",{className:"text-sm text-orange-700 mt-2 font-medium",children:e.description}),t.jsxs("div",{className:"flex items-center justify-between mt-3",children:[t.jsx("span",{className:"text-sm text-orange-600 bg-orange-200 px-3 py-1 rounded-full font-medium",children:e.category}),t.jsxs("span",{className:"font-bold text-purple-600 text-xl bg-white px-4 py-2 rounded-full border-2 border-purple-300",children:[e.points,"pt 💎"]})]})]}),t.jsxs("form",{onSubmit:s=>{s.preventDefault(),a(e.id,r)},className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-3",children:"📝 どんなふうにやったか教えてね！"}),t.jsx("textarea",{value:r,onChange:e=>n(e.target.value),className:"input-field text-lg",rows:4,placeholder:"がんばったことや、きづいたことを書いてね✨"})]}),t.jsxs("div",{className:"flex justify-center gap-4",children:[t.jsx("button",{type:"button",onClick:s,className:"btn-secondary text-lg px-8",children:"🔙 やめる"}),t.jsxs("button",{type:"submit",className:"btn-primary text-lg flex items-center gap-3 px-8",children:[t.jsx(m,{className:"w-6 h-6"}),"🚀 ほうこく"]})]})]})]})})},g=({user:e,tasks:s,completions:l,totalPoints:a})=>{const r=l.filter(e=>"APPROVED"===e.status),i=l.filter(e=>"PENDING"===e.status),d={};r.forEach(e=>{const t=s.find(s=>s.id===e.taskId);t&&(d[t.category]=(d[t.category]||0)+1)});const x=r.sort((e,s)=>new Date(s.submittedAt).getTime()-new Date(e.submittedAt).getTime()).slice(0,5);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsx("div",{className:"card-cute bg-gradient-to-br from-blue-100 to-blue-200",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-4xl mb-2",children:"🏆"}),t.jsx("h3",{className:"text-xl font-bold text-blue-800 mb-1",children:"クリア数"}),t.jsx("p",{className:"text-3xl font-bold text-blue-900",children:r.length}),t.jsx("p",{className:"text-sm text-blue-700",children:"がんばったね！"})]})}),t.jsx("div",{className:"card-cute bg-gradient-to-br from-yellow-100 to-yellow-200",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-4xl mb-2",children:"💰"}),t.jsx("h3",{className:"text-xl font-bold text-yellow-800 mb-1",children:"残高"}),t.jsxs("p",{className:"text-3xl font-bold text-yellow-900",children:[a,"pt"]}),t.jsx("p",{className:"text-sm text-yellow-700",children:"お金に変えられるよ！"})]})}),t.jsx("div",{className:"card-cute bg-gradient-to-br from-purple-100 to-purple-200",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-4xl mb-2",children:"⏰"}),t.jsx("h3",{className:"text-xl font-bold text-purple-800 mb-1",children:"確認まち"}),t.jsx("p",{className:"text-3xl font-bold text-purple-900",children:i.length}),t.jsx("p",{className:"text-sm text-purple-700",children:"まってるよ！"})]})})]}),t.jsxs("div",{className:"card-cute",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[t.jsx(n,{className:"w-8 h-8 text-green-500 animate-bounce"}),t.jsx("h3",{className:"text-xl font-bold text-green-700",children:"🌟 がんばったこと"})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[Object.entries(d).map(([e,s])=>{const l={"家事":"🏠","勉強":"📚","運動":"🏃‍♀️","その他":"⭐"}[e]||"🌟";return t.jsxs("div",{className:"text-center p-4 bg-gradient-to-br from-green-50 to-green-100 rounded-2xl border-2 border-green-200",children:[t.jsx("div",{className:"text-3xl mb-2",children:l}),t.jsx("h4",{className:"font-bold text-green-800 mb-1",children:e}),t.jsx("p",{className:"text-2xl font-bold text-green-600",children:s}),t.jsx("p",{className:"text-xs text-green-700",children:"回できた！"})]},e)}),0===Object.keys(d).length&&t.jsxs("div",{className:"col-span-full text-center py-8",children:[t.jsx("p",{className:"text-gray-500",children:"まだクリアしたクエストがないよ"}),t.jsx("p",{className:"text-gray-400 text-sm",children:"がんばってチャレンジしよう！"})]})]})]}),t.jsxs("div",{className:"card-cute",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[t.jsx(c,{className:"w-8 h-8 text-orange-500 animate-pulse"}),t.jsx("h3",{className:"text-xl font-bold text-orange-700",children:"🎉 さいきんのがんばり"})]}),t.jsxs("div",{className:"space-y-3",children:[x.map(e=>{const l=s.find(s=>s.id===e.taskId);return l?t.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gradient-to-r from-orange-50 to-yellow-50 rounded-2xl border-2 border-orange-200",children:[t.jsx("div",{className:"text-2xl",children:"🏅"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-bold text-orange-800",children:l.title}),t.jsx("p",{className:"text-sm text-orange-600",children:l.category})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("p",{className:"font-bold text-lg text-orange-700",children:["+",l.points,"pt"]}),t.jsx("p",{className:"text-xs text-orange-600",children:new Date(e.submittedAt).toLocaleDateString("ja-JP")})]})]},e.id):null}),0===x.length&&t.jsxs("div",{className:"text-center py-8",children:[t.jsx("p",{className:"text-orange-500",children:"まだクリアしたクエストがないよ"}),t.jsx("p",{className:"text-orange-400 text-sm",children:"クエストにチャレンジしてみよう！"})]})]})]}),t.jsx("div",{className:"card-cute bg-gradient-to-br from-pink-100 to-purple-100 border-2 border-pink-300",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-4xl mb-4",children:"🎈"}),t.jsxs("h3",{className:"text-xl font-bold text-pink-800 mb-4",children:[null==e?void 0:e.name,"さん、すごいね！"]}),t.jsxs("div",{className:"space-y-2",children:[r.length>=10&&t.jsx("p",{className:"text-pink-700 font-medium",children:"🌟 クエストマスター！ 10個以上クリアしたよ！"}),a>=100&&t.jsx("p",{className:"text-purple-700 font-medium",children:"💎 ポイントコレクター！ 100ポイント以上ゲット！"}),Object.keys(d).length>=3&&t.jsx("p",{className:"text-blue-700 font-medium",children:"🌈 オールラウンダー！ いろんなことができるね！"}),0===r.length&&t.jsx("p",{className:"text-pink-700 font-medium",children:"✨ がんばってクエストにチャレンジしてみよう！"})]})]})})]})};export{h as default};
