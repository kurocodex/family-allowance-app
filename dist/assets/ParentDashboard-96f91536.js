import{_ as N}from"./supabase-e6e84841.js";import{u as W,j as e}from"./index-b8b8b179.js";import{b as v,r}from"./vendor-ce4ffebd.js";import{d as p}from"./database-a6f39047.js";import{c as V}from"./dateUtils-280973c0.js";import{P as Z,d as z,C as ee,B as te,S as se,e as ae,f as O,g as le,h as ne,X as re,T as ie}from"./icons-09cb8d8e.js";import"./routing-89dfa7f7.js";const ce=v.lazy(()=>N(()=>import("./EventManagement-39441206.js"),["assets/EventManagement-39441206.js","assets/index-b8b8b179.js","assets/vendor-ce4ffebd.js","assets/routing-89dfa7f7.js","assets/supabase-e6e84841.js","assets/icons-09cb8d8e.js","assets/index-b7aeed09.css","assets/storage-8020bd0d.js","assets/dateUtils-280973c0.js"])),de=v.lazy(()=>N(()=>import("./Statistics-8118a996.js"),["assets/Statistics-8118a996.js","assets/index-b8b8b179.js","assets/vendor-ce4ffebd.js","assets/routing-89dfa7f7.js","assets/supabase-e6e84841.js","assets/icons-09cb8d8e.js","assets/index-b7aeed09.css","assets/storage-8020bd0d.js","assets/dateUtils-280973c0.js"])),oe=v.lazy(()=>N(()=>import("./RateManagement-67f969c2.js"),["assets/RateManagement-67f969c2.js","assets/index-b8b8b179.js","assets/vendor-ce4ffebd.js","assets/routing-89dfa7f7.js","assets/supabase-e6e84841.js","assets/icons-09cb8d8e.js","assets/index-b7aeed09.css","assets/storage-8020bd0d.js","assets/dateUtils-280973c0.js"])),xe=v.lazy(()=>N(()=>import("./PointExchange-81f5802d.js"),["assets/PointExchange-81f5802d.js","assets/index-b8b8b179.js","assets/vendor-ce4ffebd.js","assets/routing-89dfa7f7.js","assets/supabase-e6e84841.js","assets/icons-09cb8d8e.js","assets/index-b7aeed09.css","assets/storage-8020bd0d.js","assets/dateUtils-280973c0.js"])),me=v.lazy(()=>N(()=>import("./FamilyManagement-9709491b.js"),["assets/FamilyManagement-9709491b.js","assets/index-b8b8b179.js","assets/vendor-ce4ffebd.js","assets/routing-89dfa7f7.js","assets/supabase-e6e84841.js","assets/icons-09cb8d8e.js","assets/index-b7aeed09.css"])),ve=()=>{const{user:a}=W(),[g,u]=r.useState([]),[h,i]=r.useState([]),[c,k]=r.useState([]),[n,T]=r.useState({}),[M,_]=r.useState(!1),[m,w]=r.useState(""),[o,f]=r.useState("tasks"),[B,S]=r.useState(!0),[P,C]=r.useState(null);r.useEffect(()=>{a!=null&&a.familyId&&j()},[a==null?void 0:a.familyId]);const j=async()=>{if(a!=null&&a.familyId)try{S(!0),C(null);const[t,s,l,d]=await Promise.all([p.getTasks(a.familyId),p.getTaskCompletions(a.familyId),p.getUsers(a.familyId),p.getPointTransactions(a.familyId)]);u(t),i(s.filter(b=>b.status==="PENDING"));const y=l.filter(b=>b.role==="CHILD");k(y);const R={};y.forEach(b=>{const L=d.filter(x=>x.userId===b.id),K=L.filter(x=>x.type==="EARNED").reduce((x,I)=>x+I.amount,0),Q=L.filter(x=>x.type==="EXCHANGED").reduce((x,I)=>x+I.amount,0);R[b.id]=K-Q}),T(R)}catch(t){console.error("データ読み込みエラー:",t),C("データベースの初期設定が必要です。Supabaseでdatabase-schema.sqlを実行してください。")}finally{S(!1)}},A=async(t,s)=>{if(a!=null&&a.familyId)try{const l=h.find(d=>d.id===t);if(!l)return;if(await p.updateTaskCompletion(t,{status:s?"APPROVED":"REJECTED",approvedAt:new Date}),s){const d=g.find(y=>y.id===l.taskId);d&&await p.createPointTransaction({userId:l.childId,type:"EARNED",amount:d.points,description:`タスク完了: ${d.title}`,createdAt:new Date},a.familyId)}await j()}catch(l){console.error("承認処理エラー:",l),C("承認処理に失敗しました")}},F=t=>{const s=c.find(l=>l.id===t);return(s==null?void 0:s.name)||"不明"},q=t=>{const s=g.find(l=>l.id===t);return(s==null?void 0:s.title)||"不明なタスク"},G=t=>!h.some(l=>l.taskId===t),X=async t=>{if(a!=null&&a.familyId)if(G(t)){if(confirm("このタスクを削除してもよろしいですか？"))try{await p.deleteTask(t),await j()}catch(s){console.error("タスク削除エラー:",s),C("タスクの削除に失敗しました")}}else alert("子供が実行済みのタスクは削除できません。")},H=t=>g.filter(s=>s.assignedTo===t),U=()=>g.filter(t=>!t.assignedTo),$=t=>h.filter(l=>l.taskId===t),J=t=>{const s=[],l=[];return t.forEach(d=>{$(d.id).length===0?s.push(d):l.push(d)}),{notExecuted:s,executed:l}};r.useEffect(()=>{c.length>0&&!m&&w("all")},[c,m]);const Y=(()=>m==="all"?g:m==="general"?U():H(m))(),{notExecuted:E,executed:D}=J(Y);return B?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-purple-500 border-t-transparent mx-auto mb-4"}),e.jsx("p",{className:"text-purple-600 text-lg font-medium",children:"データを読み込み中..."})]})}):P?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-red-600 text-lg mb-4",children:P}),e.jsx("button",{onClick:j,className:"btn-primary",children:"再読み込み"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-purple-800",children:"👨‍👩‍👧‍👦 保護者ダッシュボード"}),o==="tasks"&&e.jsxs("button",{onClick:()=>_(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5"}),"✨ 新しいクエスト"]})]}),e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsxs("button",{onClick:()=>f("tasks"),className:`px-6 py-3 rounded-full font-bold transition-all flex items-center gap-2 ${o==="tasks"?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx(z,{className:"w-5 h-5"}),"🎯 クエスト管理"]}),e.jsxs("button",{onClick:()=>f("events"),className:`px-6 py-3 rounded-full font-bold transition-all flex items-center gap-2 ${o==="events"?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx(ee,{className:"w-5 h-5"}),"🎉 イベント管理"]}),e.jsxs("button",{onClick:()=>f("statistics"),className:`px-6 py-3 rounded-full font-bold transition-all flex items-center gap-2 ${o==="statistics"?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx(te,{className:"w-5 h-5"}),"📊 統計・レポート"]}),e.jsxs("button",{onClick:()=>f("rates"),className:`px-6 py-3 rounded-full font-bold transition-all flex items-center gap-2 ${o==="rates"?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx(se,{className:"w-5 h-5"}),"⚙️ レート設定"]}),e.jsxs("button",{onClick:()=>f("exchange"),className:`px-6 py-3 rounded-full font-bold transition-all flex items-center gap-2 ${o==="exchange"?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx(ae,{className:"w-5 h-5"}),"💰 ポイント交換"]}),e.jsxs("button",{onClick:()=>f("family"),className:`px-6 py-3 rounded-full font-bold transition-all flex items-center gap-2 ${o==="family"?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx(O,{className:"w-5 h-5"}),"👨‍👩‍👧‍👦 家族管理"]})]}),o==="events"?e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"text-center py-8",children:"イベント管理を読み込み中..."}),children:e.jsx(ce,{})}):o==="statistics"?e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"text-center py-8",children:"統計データを読み込み中..."}),children:e.jsx(de,{})}):o==="rates"?e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"text-center py-8",children:"レート設定を読み込み中..."}),children:e.jsx(oe,{})}):o==="exchange"?e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"text-center py-8",children:"ポイント交換を読み込み中..."}),children:e.jsx(xe,{})}):o==="family"?e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"text-center py-8",children:"家族管理を読み込み中..."}),children:e.jsx(me,{})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(O,{className:"w-8 h-8 text-purple-500"}),e.jsx("h3",{className:"text-xl font-bold text-purple-700",children:"👧 お子様の状況"})]}),e.jsx("div",{className:"space-y-3",children:c.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-pink-50 to-purple-50 rounded-2xl border-2 border-pink-200",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-purple-800",children:t.name}),e.jsx("p",{className:"text-sm text-purple-600",children:t.birthDate?`${V(t.birthDate)}歳`:`${t.age||0}歳`})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-2xl text-purple-600",children:[n[t.id]||0,"pt"]}),e.jsx("p",{className:"text-xs text-purple-500",children:"保有ポイント"})]})]},t.id))})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(le,{className:"w-8 h-8 text-yellow-500 animate-pulse"}),e.jsx("h3",{className:"text-xl font-bold text-yellow-700",children:"⏰ 承認待ち"})]}),e.jsxs("div",{className:"space-y-3",children:[h.slice(0,4).map(t=>e.jsxs("div",{className:"p-4 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-2xl border-2 border-yellow-300",children:[e.jsx("p",{className:"font-bold text-orange-800 mb-1",children:q(t.taskId)}),e.jsxs("p",{className:"text-sm text-orange-600 mb-3",children:[F(t.childId),"さん"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>A(t.id,!0),className:"flex-1 bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-3 rounded-full flex items-center justify-center gap-2 transition-all",children:[e.jsx(ne,{className:"w-4 h-4"}),"✅ 承認"]}),e.jsxs("button",{onClick:()=>A(t.id,!1),className:"flex-1 bg-red-500 hover:bg-red-600 text-white font-medium py-2 px-3 rounded-full flex items-center justify-center gap-2 transition-all",children:[e.jsx(re,{className:"w-4 h-4"}),"❌ 却下"]})]})]},t.id)),h.length===0&&e.jsx("div",{className:"text-center py-6",children:e.jsx("p",{className:"text-yellow-600",children:"📝 承認待ちのクエストはありません"})})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(z,{className:"w-8 h-8 text-green-500"}),e.jsx("h3",{className:"text-xl font-bold text-green-700",children:"🎯 クエスト管理"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-6",children:[e.jsx("button",{onClick:()=>w("all"),className:`px-4 py-2 rounded-full font-medium transition-all ${m==="all"?"bg-purple-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"👨‍👩‍👧‍👦 全体表示"}),e.jsx("button",{onClick:()=>w("general"),className:`px-4 py-2 rounded-full font-medium transition-all ${m==="general"?"bg-purple-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"👥 全員対象"}),c.map(t=>e.jsxs("button",{onClick:()=>w(t.id),className:`px-4 py-2 rounded-full font-medium transition-all ${m===t.id?"bg-purple-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[t.name,"さん"]},t.id))]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-bold text-blue-700 mb-4 flex items-center gap-2",children:["🎯 実行前クエスト (",E.length,"件)"]}),e.jsxs("div",{className:"space-y-3",children:[E.map(t=>{const s=t.assignedTo?c.find(l=>l.id===t.assignedTo):null;return e.jsxs("div",{className:"p-4 bg-gradient-to-r from-blue-50 to-cyan-50 rounded-2xl border-2 border-blue-200 hover:shadow-lg transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h5",{className:"font-bold text-blue-800",children:t.title}),e.jsxs("span",{className:"text-lg font-bold text-purple-600 bg-white px-3 py-1 rounded-full border-2 border-purple-300",children:[t.points,"pt"]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs px-3 py-1 bg-blue-200 text-blue-700 rounded-full",children:t.category}),e.jsx("span",{className:"text-xs px-3 py-1 bg-purple-200 text-purple-700 rounded-full",children:s?s.name:"全員"})]}),e.jsx("p",{className:"text-sm text-blue-700 mb-3",children:t.description}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>X(t.id),className:"p-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-full transition-colors",title:"クエストを削除",children:e.jsx(ie,{className:"w-4 h-4"})})})]},t.id)}),E.length===0&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-blue-600",children:"🎉 実行前のクエストはありません"})})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-bold text-green-700 mb-4 flex items-center gap-2",children:["✅ 実行済みクエスト (",D.length,"件)"]}),e.jsxs("div",{className:"space-y-3",children:[D.map(t=>{const s=t.assignedTo?c.find(d=>d.id===t.assignedTo):null,l=$(t.id);return e.jsxs("div",{className:"p-4 bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl border-2 border-green-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h5",{className:"font-bold text-green-800",children:t.title}),e.jsxs("span",{className:"text-lg font-bold text-purple-600 bg-white px-3 py-1 rounded-full border-2 border-purple-300",children:[t.points,"pt"]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs px-3 py-1 bg-green-200 text-green-700 rounded-full",children:t.category}),e.jsx("span",{className:"text-xs px-3 py-1 bg-purple-200 text-purple-700 rounded-full",children:s?s.name:"全員"}),e.jsxs("span",{className:"text-xs px-3 py-1 bg-emerald-200 text-emerald-700 rounded-full",children:[l.length,"回実行"]})]}),e.jsx("p",{className:"text-sm text-green-700",children:t.description})]},t.id)}),D.length===0&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-green-600",children:"📝 実行済みのクエストはありません"})})]})]})]})]}),M&&e.jsx(pe,{onClose:()=>_(!1),onSave:j,user:a,children:c})]})]})},pe=({onClose:a,onSave:g,user:u,children:h})=>{const[i,c]=r.useState({title:"",description:"",points:10,category:"家事",difficulty:"EASY",isRecurring:!1,assignedTo:""}),k=async n=>{if(n.preventDefault(),!!(u!=null&&u.familyId))try{await p.createTask({...i,assignedTo:i.assignedTo||void 0,createdBy:u.id},u.familyId),g(),a()}catch(T){console.error("タスク作成エラー:",T),alert("タスクの作成に失敗しました")}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"新しいタスクを作成"}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"タスク名"}),e.jsx("input",{type:"text",value:i.title,onChange:n=>c({...i,title:n.target.value}),className:"input-field",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"説明"}),e.jsx("textarea",{value:i.description,onChange:n=>c({...i,description:n.target.value}),className:"input-field",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"対象のお子様"}),e.jsxs("select",{value:i.assignedTo,onChange:n=>c({...i,assignedTo:n.target.value}),className:"input-field",children:[e.jsx("option",{value:"",children:"全員"}),h.map(n=>e.jsxs("option",{value:n.id,children:[n.name," (",n.birthDate?`${V(n.birthDate)}歳`:`${n.age||0}歳`,")"]},n.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ポイント"}),e.jsx("input",{type:"number",value:i.points,onChange:n=>c({...i,points:parseInt(n.target.value)}),className:"input-field",min:"1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"カテゴリ"}),e.jsxs("select",{value:i.category,onChange:n=>c({...i,category:n.target.value}),className:"input-field",children:[e.jsx("option",{value:"家事",children:"家事"}),e.jsx("option",{value:"勉強",children:"勉強"}),e.jsx("option",{value:"運動",children:"運動"}),e.jsx("option",{value:"その他",children:"その他"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:a,className:"btn-secondary",children:"キャンセル"}),e.jsx("button",{type:"submit",className:"btn-primary",children:"作成"})]})]})]})})};export{ve as default};
