var e=Object.defineProperty,s=(s,t,a)=>(((s,t,a)=>{t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a})(s,"symbol"!=typeof t?t+"":t,a),a);import{r as t,a,b as r}from"./vendor-18e24f2a-1750549093763.js";import{B as l}from"./routing-b3bac0e0-1750549093763.js";import{c as i,_ as n}from"./supabase-195fc627-1750549093763.js";import{A as o,U as c,M as d,L as m,a as x,b as u,B as p,X as h,T as f,G as b,C as g,S as w,E as j,c as N,d as v,e as y,f as k,R as _,g as P,D as C}from"./icons-6c88ec70-1750549093763.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)}).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();var E={exports:{}},S={},I=t,R=Symbol.for("react.element"),A=Symbol.for("react.fragment"),D=Object.prototype.hasOwnProperty,T=I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,O={key:!0,ref:!0,__self:!0,__source:!0};function L(e,s,t){var a,r={},l=null,i=null;for(a in void 0!==t&&(l=""+t),void 0!==s.key&&(l=""+s.key),void 0!==s.ref&&(i=s.ref),s)D.call(s,a)&&!O.hasOwnProperty(a)&&(r[a]=s[a]);if(e&&e.defaultProps)for(a in s=e.defaultProps)void 0===r[a]&&(r[a]=s[a]);return{$$typeof:R,type:e,key:l,ref:i,props:r,_owner:T.current}}S.Fragment=A,S.jsx=L,S.jsxs=L,E.exports=S;var q=E.exports,U={},z=a;U.createRoot=z.createRoot,U.hydrateRoot=z.hydrateRoot;const $=i("https://adtsbzzizbwjiqrkqofp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFkdHNienppemJ3amlxcmtxb2ZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA0ODAyNzYsImV4cCI6MjA2NjA1NjI3Nn0.Fzqt6WBr9vq17jV8hDGm5Nw2chIC2Yern7ePfQ5Sq-4",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),F=t.createContext(void 0),M=({children:e})=>{const[s,a]=t.useState(null),[r,l]=t.useState(null),[i,n]=t.useState(!0);t.useEffect(()=>{o();const{data:{subscription:e}}=$.auth.onAuthStateChange(async(e,t)=>{if(null==t?void 0:t.user){if(l(t.user),"USER_UPDATED"===e&&t.user.email&&(null==s?void 0:s.email)!==t.user.email)try{const{error:e}=await $.from("users").update({email:t.user.email}).eq("id",t.user.id)}catch(r){}await c(t.user.id)}else l(null),a(null);n(!1)});return()=>{e.unsubscribe()}},[]);const o=async()=>{try{const e=new Promise((e,s)=>setTimeout(()=>s(new Error("Session timeout")),3e4)),s=$.auth.getSession(),{data:{session:t},error:a}=await Promise.race([s,e]);if(a)return void n(!1);(null==t?void 0:t.user)&&(l(t.user),await c(t.user.id))}catch(e){e instanceof Error&&e.message}finally{n(!1)}},c=async e=>{var s;try{const{data:t,error:r}=await $.from("users").select("\n          id,\n          name,\n          role,\n          family_id,\n          birth_date,\n          age,\n          created_at,\n          families!inner(id, name)\n        ").eq("id",e).single();if(r)return;if(t){const{data:e}=await $.auth.getUser(),r={id:t.id,name:t.name,email:(null==(s=null==e?void 0:e.user)?void 0:s.email)||"",role:t.role,familyId:t.family_id,birthDate:t.birth_date?new Date(t.birth_date):void 0,age:t.age,createdAt:new Date(t.created_at)};a(r)}}catch(t){}};return q.jsx(F.Provider,{value:{user:s,supabaseUser:r,login:async(e,s)=>{try{const{error:t}=await $.auth.signInWithPassword({email:e,password:s});if(t)throw t}catch(t){throw t}},logout:async()=>{try{const{error:e}=await $.auth.signOut();if(e)throw e}catch(e){throw e}},register:async(e,s,t,a)=>{try{const{data:r,error:l}=await $.auth.signUp({email:e,password:s});if(l)throw l;if(r.user){let e;if("PARENT"===a){const{data:s,error:a}=await $.from("families").insert({name:`${t}さんの家族`}).select().single();if(a)throw a;e=s.id}else{const{data:s,error:t}=await $.from("families").select("id").limit(1).single();if(t)throw t;e=s.id}const{error:s}=await $.from("users").insert({id:r.user.id,family_id:e,name:t,role:a});if(s)throw s}}catch(r){throw r}},updateUser:e=>{s&&a({...s,...e})},loading:i},children:e})},J=()=>{const e=t.useContext(F);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e},B=t.createContext(void 0),V=({children:e})=>{const{user:s}=J(),[a,r]=t.useState([]),l=e=>{const s={...e,id:Math.random().toString(36).substr(2,9),createdAt:new Date,read:!1};var t,a,l;r(e=>[s,...e]),t=e.title,a=e.message,"Notification"in window&&"granted"===Notification.permission&&new Notification(t,{body:a,icon:l||"/pwa-192x192.png",badge:"/pwa-64x64.png"})},i=a.filter(e=>!e.read).length;t.useEffect(()=>{if(!(null==s?void 0:s.familyId))return;const e=$.channel("task_completions").on("postgres_changes",{event:"INSERT",schema:"public",table:"task_completions",filter:`family_id=eq.${s.familyId}`},e=>{"PARENT"===s.role&&e.new.child_id!==s.id&&l({title:"🎯 タスク完了報告",message:"お子様がタスクを完了しました！承認をお待ちしています。",type:"task_completed",data:e.new})}).subscribe(),t=$.channel("task_approvals").on("postgres_changes",{event:"UPDATE",schema:"public",table:"task_completions",filter:`child_id=eq.${s.id}`},e=>{if("CHILD"===s.role){const s=e.new.status;"APPROVED"===s?l({title:"✅ タスク承認",message:"タスクが承認されました！ポイントを獲得しました。",type:"task_approved",data:e.new}):"REJECTED"===s&&l({title:"❌ タスク却下",message:"タスクが却下されました。もう一度挑戦してみましょう。",type:"task_rejected",data:e.new})}}).subscribe(),a=$.channel("new_tasks").on("postgres_changes",{event:"INSERT",schema:"public",table:"tasks",filter:`family_id=eq.${s.familyId}`},e=>{"CHILD"===s.role&&(e.new.assigned_to&&e.new.assigned_to!==s.id||l({title:"🆕 新しいクエスト",message:`新しいクエスト「${e.new.title}」が追加されました！`,type:"new_task",data:e.new}))}).subscribe(),r=$.channel("point_transactions").on("postgres_changes",{event:"INSERT",schema:"public",table:"point_transactions",filter:`user_id=eq.${s.id}`},e=>{"CHILD"===s.role&&"EARNED"===e.new.type&&l({title:"💎 ポイント獲得",message:`${e.new.amount}ポイントを獲得しました！`,type:"points_awarded",data:e.new})}).subscribe();return()=>{e.unsubscribe(),t.unsubscribe(),a.unsubscribe(),r.unsubscribe()}},[null==s?void 0:s.familyId,null==s?void 0:s.id,null==s?void 0:s.role]);const n={notifications:a,unreadCount:i,markAsRead:e=>{r(s=>s.map(s=>s.id===e?{...s,read:!0}:s))},markAllAsRead:()=>{r(e=>e.map(e=>({...e,read:!0})))},addNotification:l,clearNotifications:()=>{r([])}};return q.jsx(B.Provider,{value:n,children:e})},W=()=>{const[e,s]=t.useState(!0),[a,r]=t.useState({email:"",password:"",name:"",role:"PARENT"}),[l,i]=t.useState(""),[n,p]=t.useState(!1),{login:h,register:f}=J();return q.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-400 via-pink-500 to-red-500 flex items-center justify-center p-4",children:q.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl p-8 w-full max-w-md",children:[q.jsxs("div",{className:"text-center mb-8",children:[q.jsx("div",{className:"text-6xl mb-4",children:"🏠"}),q.jsx("h1",{className:"text-3xl font-bold text-purple-800 mb-2",children:"おこづかいクエスト"}),q.jsx("p",{className:"text-purple-600",children:e?"ログインしてください":"新しいアカウントを作成"})]}),l&&q.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-3",children:[q.jsx(o,{className:"w-5 h-5 text-red-500"}),q.jsx("p",{className:"text-red-700 text-sm",children:l})]}),q.jsxs("form",{onSubmit:async t=>{t.preventDefault(),i(""),p(!0);try{e?await h(a.email,a.password):(await f(a.email,a.password,a.name,a.role),alert("アカウントが作成されました！ログインしてください。"),s(!0))}catch(r){i(r.message||"エラーが発生しました")}finally{p(!1)}},className:"space-y-6",children:[!e&&q.jsxs(q.Fragment,{children:[q.jsxs("div",{children:[q.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"お名前"}),q.jsxs("div",{className:"relative",children:[q.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),q.jsx("input",{type:"text",value:a.name,onChange:e=>r({...a,name:e.target.value}),className:"input-field pl-10",placeholder:"山田太郎",required:!0})]})]}),q.jsxs("div",{children:[q.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"役割"}),q.jsxs("select",{value:a.role,onChange:e=>r({...a,role:e.target.value}),className:"input-field",required:!0,children:[q.jsx("option",{value:"PARENT",children:"👨‍👩‍👧‍👦 保護者"}),q.jsx("option",{value:"CHILD",children:"🧒 子供"})]})]})]}),q.jsxs("div",{children:[q.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"メールアドレス"}),q.jsxs("div",{className:"relative",children:[q.jsx(d,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),q.jsx("input",{type:"email",value:a.email,onChange:e=>r({...a,email:e.target.value}),className:"input-field pl-10",placeholder:"example@email.com",required:!0})]})]}),q.jsxs("div",{children:[q.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"パスワード"}),q.jsxs("div",{className:"relative",children:[q.jsx(m,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),q.jsx("input",{type:"password",value:a.password,onChange:e=>r({...a,password:e.target.value}),className:"input-field pl-10",placeholder:"••••••••",minLength:6,required:!0})]}),!e&&q.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"6文字以上で入力してください"})]}),q.jsx("button",{type:"submit",disabled:n,className:"w-full py-3 px-4 rounded-2xl font-bold text-lg transition-all flex items-center justify-center gap-3 "+(n?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:shadow-lg"),children:n?"処理中...":e?q.jsxs(q.Fragment,{children:[q.jsx(x,{className:"w-5 h-5"}),"ログイン"]}):q.jsxs(q.Fragment,{children:[q.jsx(u,{className:"w-5 h-5"}),"アカウント作成"]})})]}),q.jsx("div",{className:"mt-6 text-center",children:q.jsx("button",{onClick:()=>{s(!e),r({email:"",password:"",name:"",role:"PARENT"}),i("")},className:"text-purple-600 hover:text-purple-800 text-sm font-medium",children:e?"アカウントをお持ちでない方はこちら":"すでにアカウントをお持ちの方はこちら"})})]})})},H=()=>{const{notifications:e,unreadCount:s,markAsRead:a,markAllAsRead:r,clearNotifications:l}=(()=>{const e=t.useContext(B);if(!e)throw new Error("useNotifications must be used within NotificationProvider");return e})(),[i,n]=t.useState(!1),c=e=>{switch(e){case"task_completed":return q.jsx(f,{className:"w-5 h-5 text-blue-500"});case"task_approved":return q.jsx(g,{className:"w-5 h-5 text-green-500"});case"task_rejected":return q.jsx(o,{className:"w-5 h-5 text-red-500"});case"points_awarded":return q.jsx(b,{className:"w-5 h-5 text-purple-500"});case"new_task":return q.jsx(f,{className:"w-5 h-5 text-orange-500"});default:return q.jsx(p,{className:"w-5 h-5 text-gray-500"})}},d=e=>{const s=(new Date).getTime()-e.getTime(),t=Math.floor(s/6e4),a=Math.floor(s/36e5),r=Math.floor(s/864e5);return t<1?"たった今":t<60?`${t}分前`:a<24?`${a}時間前`:`${r}日前`};return q.jsxs("div",{className:"relative",children:[q.jsxs("button",{onClick:()=>n(!i),className:"relative p-2 text-gray-600 hover:text-purple-600 transition-colors",children:[q.jsx(p,{className:"w-6 h-6"}),s>0&&q.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold",children:s>9?"9+":s})]}),i&&q.jsxs(q.Fragment,{children:[q.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>n(!1)}),q.jsxs("div",{className:"absolute right-0 top-full mt-2 w-80 bg-white rounded-2xl shadow-2xl border border-gray-200 z-50 max-h-96 overflow-hidden",children:[q.jsx("div",{className:"p-4 border-b border-gray-100 bg-gradient-to-r from-purple-50 to-pink-50",children:q.jsxs("div",{className:"flex items-center justify-between",children:[q.jsxs("h3",{className:"font-bold text-gray-800 flex items-center gap-2",children:[q.jsx(p,{className:"w-5 h-5 text-purple-600"}),"通知"]}),q.jsxs("div",{className:"flex items-center gap-2",children:[s>0&&q.jsx("button",{onClick:r,className:"text-sm text-purple-600 hover:text-purple-800 font-medium",children:"すべて既読"}),q.jsx("button",{onClick:()=>n(!1),className:"p-1 text-gray-400 hover:text-gray-600",children:q.jsx(h,{className:"w-4 h-4"})})]})]})}),q.jsx("div",{className:"max-h-64 overflow-y-auto",children:0===e.length?q.jsxs("div",{className:"p-8 text-center text-gray-500",children:[q.jsx(p,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),q.jsx("p",{children:"通知はありません"})]}):e.map(e=>q.jsx("div",{onClick:()=>a(e.id),className:"p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 transition-colors "+(e.read?"":"bg-blue-50 border-l-4 border-l-blue-500"),children:q.jsxs("div",{className:"flex items-start gap-3",children:[c(e.type),q.jsxs("div",{className:"flex-1 min-w-0",children:[q.jsx("h4",{className:"font-medium text-sm "+(e.read?"text-gray-700":"text-gray-900"),children:e.title}),q.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.message}),q.jsx("p",{className:"text-xs text-gray-400 mt-2",children:d(e.createdAt)})]}),!e.read&&q.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2"})]})},e.id))}),e.length>0&&q.jsx("div",{className:"p-3 border-t border-gray-100 bg-gray-50",children:q.jsx("button",{onClick:l,className:"w-full text-sm text-gray-600 hover:text-gray-800 font-medium",children:"すべての通知を削除"})})]})]})]})},Y=({onClose:e})=>{const{user:s,updateUser:a}=J(),[r,l]=t.useState(!1),[i,n]=t.useState(null),[x,u]=t.useState(null),[p,f]=t.useState(!1),[b,v]=t.useState(!1),[y,k]=t.useState(!1),[_,P]=t.useState({email:(null==s?void 0:s.email)||"",name:(null==s?void 0:s.name)||"",currentPassword:"",newPassword:"",confirmPassword:""});return q.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:q.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 rounded-3xl p-6 lg:p-8 w-full max-w-2xl border-4 border-purple-300 shadow-2xl max-h-[90vh] overflow-y-auto",children:[q.jsxs("div",{className:"flex items-center justify-between mb-6",children:[q.jsxs("h2",{className:"text-2xl lg:text-3xl font-bold text-purple-800 flex items-center gap-3",children:[q.jsx(c,{className:"w-8 h-8"}),"⚙️ アカウント設定"]}),q.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors",children:q.jsx(h,{className:"w-6 h-6"})})]}),i&&q.jsxs("div",{className:"mb-6 p-4 bg-green-50 border-2 border-green-200 rounded-2xl flex items-center gap-3",children:[q.jsx(g,{className:"w-6 h-6 text-green-600"}),q.jsx("p",{className:"text-green-800 font-medium",children:i})]}),x&&q.jsxs("div",{className:"mb-6 p-4 bg-red-50 border-2 border-red-200 rounded-2xl flex items-center gap-3",children:[q.jsx(o,{className:"w-6 h-6 text-red-600"}),q.jsx("p",{className:"text-red-800 font-medium",children:x})]}),q.jsxs("div",{className:"space-y-8",children:[q.jsxs("div",{className:"space-y-4",children:[q.jsxs("h3",{className:"text-xl font-bold text-purple-700 flex items-center gap-2",children:[q.jsx(c,{className:"w-6 h-6"}),"基本情報"]}),q.jsxs("div",{className:"space-y-4",children:[q.jsxs("div",{children:[q.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-2",children:"📝 お名前"}),q.jsxs("div",{className:"flex gap-3",children:[q.jsx("input",{type:"text",value:_.name,onChange:e=>P({..._,name:e.target.value}),className:"flex-1 input-field",placeholder:"お名前を入力"}),q.jsxs("button",{onClick:async()=>{if(_.name&&_.name!==(null==s?void 0:s.name)){l(!0),u(null),n(null);try{const{error:e}=await $.from("users").update({name:_.name}).eq("id",null==s?void 0:s.id);if(e)throw e;n("名前が正常に更新されました"),a&&a({...s,name:_.name})}catch(e){u(e.message||"名前の更新に失敗しました")}finally{l(!1)}}else u("新しい名前を入力してください")},disabled:r||!_.name||_.name===(null==s?void 0:s.name),className:"btn-primary px-4 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[q.jsx(w,{className:"w-4 h-4"}),"更新"]})]})]}),q.jsxs("div",{children:[q.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-2",children:"📧 メールアドレス"}),q.jsxs("div",{className:"flex gap-3",children:[q.jsxs("div",{className:"flex-1 relative",children:[q.jsx(d,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-purple-500"}),q.jsx("input",{type:"email",value:_.email,onChange:e=>P({..._,email:e.target.value}),className:"input-field pl-11",placeholder:"新しいメールアドレス"})]}),q.jsxs("button",{onClick:async()=>{if(_.email&&_.email!==(null==s?void 0:s.email)){l(!0),u(null),n(null);try{const{error:e}=await $.auth.updateUser({email:_.email});if(e)throw e;n(`新しいメールアドレス（${_.email}）に確認メールを送信しました。メール内のリンクをクリックして変更を完了してください。現在のメールアドレスは変更されていません。`),P({..._,email:(null==s?void 0:s.email)||""})}catch(e){u(e.message||"メールアドレスの更新に失敗しました")}finally{l(!1)}}else u("新しいメールアドレスを入力してください")},disabled:r||!_.email||_.email===(null==s?void 0:s.email),className:"btn-primary px-4 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[q.jsx(w,{className:"w-4 h-4"}),"更新"]})]}),q.jsx("p",{className:"text-xs text-purple-600 mt-2",children:"※ メールアドレス変更後は確認メールで認証が必要です"})]})]})]}),q.jsxs("div",{className:"space-y-4",children:[q.jsxs("h3",{className:"text-xl font-bold text-purple-700 flex items-center gap-2",children:[q.jsx(m,{className:"w-6 h-6"}),"パスワード変更"]}),q.jsxs("div",{className:"space-y-4",children:[q.jsxs("div",{children:[q.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-2",children:"🔒 現在のパスワード"}),q.jsxs("div",{className:"relative",children:[q.jsx(m,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-purple-500"}),q.jsx("input",{type:p?"text":"password",value:_.currentPassword,onChange:e=>P({..._,currentPassword:e.target.value}),className:"input-field pl-11 pr-11",placeholder:"現在のパスワード"}),q.jsx("button",{type:"button",onClick:()=>f(!p),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-purple-500 hover:text-purple-700",children:p?q.jsx(j,{className:"w-5 h-5"}):q.jsx(N,{className:"w-5 h-5"})})]})]}),q.jsxs("div",{children:[q.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-2",children:"🆕 新しいパスワード"}),q.jsxs("div",{className:"relative",children:[q.jsx(m,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-purple-500"}),q.jsx("input",{type:b?"text":"password",value:_.newPassword,onChange:e=>P({..._,newPassword:e.target.value}),className:"input-field pl-11 pr-11",placeholder:"新しいパスワード（6文字以上）"}),q.jsx("button",{type:"button",onClick:()=>v(!b),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-purple-500 hover:text-purple-700",children:b?q.jsx(j,{className:"w-5 h-5"}):q.jsx(N,{className:"w-5 h-5"})})]})]}),q.jsxs("div",{children:[q.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-2",children:"✅ パスワード確認"}),q.jsxs("div",{className:"relative",children:[q.jsx(m,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-purple-500"}),q.jsx("input",{type:y?"text":"password",value:_.confirmPassword,onChange:e=>P({..._,confirmPassword:e.target.value}),className:"input-field pl-11 pr-11",placeholder:"新しいパスワードを再入力"}),q.jsx("button",{type:"button",onClick:()=>k(!y),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-purple-500 hover:text-purple-700",children:y?q.jsx(j,{className:"w-5 h-5"}):q.jsx(N,{className:"w-5 h-5"})})]})]}),q.jsxs("button",{onClick:async()=>{if(_.currentPassword&&_.newPassword&&_.confirmPassword)if(_.newPassword===_.confirmPassword)if(_.newPassword.length<6)u("新しいパスワードは6文字以上で入力してください");else{l(!0),u(null),n(null);try{const{error:e}=await $.auth.signInWithPassword({email:(null==s?void 0:s.email)||"",password:_.currentPassword});if(e)throw new Error("現在のパスワードが正しくありません");const{error:t}=await $.auth.updateUser({password:_.newPassword});if(t)throw t;n("パスワードが正常に更新されました"),P({..._,currentPassword:"",newPassword:"",confirmPassword:""})}catch(e){u(e.message||"パスワードの更新に失敗しました")}finally{l(!1)}}else u("新しいパスワードが一致しません");else u("すべてのパスワードフィールドを入力してください")},disabled:r||!_.currentPassword||!_.newPassword||!_.confirmPassword,className:"w-full btn-primary py-3 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[q.jsx(m,{className:"w-5 h-5"}),r?"更新中...":"🔐 パスワードを更新"]})]})]})]}),q.jsx("div",{className:"mt-8 pt-6 border-t border-purple-200 flex justify-center gap-4",children:q.jsx("button",{onClick:e,className:"btn-secondary px-8 py-3",children:"🔙 閉じる"})})]})})},Z=r.lazy(()=>n(()=>import("./ParentDashboard-572ee0ca-1750549093763.js"),["assets/ParentDashboard-572ee0ca-1750549093763.js","assets/supabase-195fc627-1750549093763.js","assets/vendor-18e24f2a-1750549093763.js","assets/database-9012b52f-1750549093763.js","assets/dateUtils-d91f8443-1750549093763.js","assets/icons-6c88ec70-1750549093763.js","assets/routing-b3bac0e0-1750549093763.js"])),G=r.lazy(()=>n(()=>import("./ChildDashboard-e5d5b7ae-1750549093763.js"),["assets/ChildDashboard-e5d5b7ae-1750549093763.js","assets/supabase-195fc627-1750549093763.js","assets/vendor-18e24f2a-1750549093763.js","assets/database-9012b52f-1750549093763.js","assets/icons-6c88ec70-1750549093763.js","assets/routing-b3bac0e0-1750549093763.js"])),X=()=>{const{user:e,logout:s}=J(),[a,r]=t.useState(!1);return e?q.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50",children:[q.jsx("header",{className:"bg-white shadow-sm border-b",children:q.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:q.jsxs("div",{className:"flex justify-between items-center h-16",children:[q.jsxs("div",{className:"flex items-center gap-3",children:[q.jsx("div",{className:"w-8 h-8 bg-primary-500 rounded-full flex items-center justify-center",children:q.jsx(c,{className:"w-4 h-4 text-white"})}),q.jsxs("div",{children:[q.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"🏰 おこづかいクエスト"}),q.jsxs("p",{className:"text-sm text-gray-600",children:[e.name,"さん (","PARENT"===e.role?"保護者":"お子様",")"]})]})]}),q.jsxs("div",{className:"flex items-center gap-2",children:[q.jsx(H,{}),q.jsxs("button",{onClick:()=>r(!0),className:"flex items-center gap-2 px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors",title:"アカウント設定",children:[q.jsx(v,{className:"w-4 h-4"}),q.jsx("span",{className:"hidden md:inline",children:"設定"})]}),q.jsxs("button",{onClick:s,className:"flex items-center gap-2 px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors",children:[q.jsx(y,{className:"w-4 h-4"}),q.jsx("span",{className:"hidden md:inline",children:"ログアウト"})]})]})]})})}),q.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:q.jsx(t.Suspense,{fallback:q.jsx("div",{className:"flex items-center justify-center h-64",children:q.jsxs("div",{className:"text-center",children:[q.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-purple-500 border-t-transparent mx-auto mb-4"}),q.jsx("p",{className:"text-purple-600 text-lg font-medium",children:"ダッシュボードを読み込み中..."})]})}),children:"PARENT"===e.role?q.jsx(Z,{}):q.jsx(G,{})})}),a&&q.jsx(Y,{onClose:()=>r(!1)})]}):null};class Q extends t.Component{constructor(e){super(e),s(this,"handleReload",()=>{window.location.reload()}),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,s){this.setState({error:e,errorInfo:s})}render(){return this.state.hasError?q.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-pink-50 flex items-center justify-center p-4",children:q.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl p-8 w-full max-w-md text-center",children:[q.jsx("div",{className:"text-red-500 mb-4",children:q.jsx(k,{className:"w-16 h-16 mx-auto"})}),q.jsx("h1",{className:"text-2xl font-bold text-red-800 mb-4",children:"エラーが発生しました"}),q.jsx("p",{className:"text-gray-600 mb-6",children:"アプリの読み込み中に問題が発生しました。 ページを再読み込みして再試行してください。"}),q.jsxs("button",{onClick:this.handleReload,className:"w-full bg-gradient-to-r from-red-500 to-pink-500 text-white font-bold py-3 px-6 rounded-2xl hover:shadow-lg transition-all flex items-center justify-center gap-2",children:[q.jsx(_,{className:"w-5 h-5"}),"ページを再読み込み"]}),!1]})}):this.props.children}}const K=()=>{const[e,s]=t.useState(null),[a,r]=t.useState(!1),[l,i]=t.useState(!1);t.useEffect(()=>{if(window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone||localStorage.getItem("pwa-prompt-dismissed"))return;const e=e=>{e.preventDefault(),s(e),r(!0)};window.addEventListener("beforeinstallprompt",e);const t=/iPad|iPhone|iPod/.test(navigator.userAgent),a=window.navigator.standalone;return!t||a||localStorage.getItem("pwa-prompt-dismissed")||setTimeout(()=>r(!0),5e3),()=>{window.removeEventListener("beforeinstallprompt",e)}},[]);const n=()=>{r(!1),i(!0),localStorage.setItem("pwa-prompt-dismissed","true")},o=/iPad|iPhone|iPod/.test(navigator.userAgent);return!a||l?null:q.jsx("div",{className:"fixed bottom-4 left-4 right-4 z-50 md:left-auto md:right-4 md:max-w-sm",children:q.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-2xl shadow-2xl p-4",children:q.jsxs("div",{className:"flex items-start gap-3",children:[q.jsx("div",{className:"bg-white bg-opacity-20 rounded-full p-2",children:q.jsx(P,{className:"w-6 h-6"})}),q.jsxs("div",{className:"flex-1",children:[q.jsx("h3",{className:"font-bold text-lg mb-1",children:"アプリをインストール"}),q.jsx("p",{className:"text-sm opacity-90 mb-3",children:o?"このアプリをホーム画面に追加して、より便利にご利用ください。":"アプリをインストールして、オフラインでも使用できるようにしましょう。"}),o?q.jsx("div",{className:"text-xs opacity-80 mb-3",children:q.jsx("p",{children:"📱 Safari で「共有」→「ホーム画面に追加」をタップ"})}):null,q.jsxs("div",{className:"flex gap-2",children:[!o&&q.jsxs("button",{onClick:async()=>{if(e){e.prompt();const{outcome:t}=await e.userChoice;s(null),r(!1)}},className:"flex-1 bg-white text-purple-600 font-bold py-2 px-4 rounded-lg flex items-center justify-center gap-2 hover:bg-gray-100 transition-colors",children:[q.jsx(C,{className:"w-4 h-4"}),"インストール"]}),q.jsx("button",{onClick:n,className:"bg-white bg-opacity-20 hover:bg-opacity-30 text-white font-medium py-2 px-4 rounded-lg transition-colors",children:"後で"})]})]}),q.jsx("button",{onClick:n,className:"text-white text-opacity-70 hover:text-opacity-100 transition-colors",children:q.jsx(h,{className:"w-5 h-5"})})]})})})},ee=()=>{const{user:e,loading:s}=J();return t.useEffect(()=>{(async()=>{if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.register("/sw.js");return e.addEventListener("updatefound",()=>{}),e}catch(e){}})(),e&&(async()=>{if("Notification"in window)return"granted"===await Notification.requestPermission()})()},[e]),s?q.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-400 via-pink-500 to-red-500",children:q.jsxs("div",{className:"text-center",children:[q.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-white border-t-transparent mx-auto mb-4"}),q.jsx("p",{className:"text-white text-lg font-medium",children:"読み込み中..."})]})}):q.jsxs(q.Fragment,{children:[e?q.jsx(V,{children:q.jsx(X,{})}):q.jsx(W,{}),q.jsx(K,{})]})},se=()=>q.jsx(Q,{children:q.jsx(M,{children:q.jsx(ee,{})})});U.createRoot(document.getElementById("root")).render(q.jsx(r.StrictMode,{children:q.jsx(l,{children:q.jsx(se,{})})}));export{q as j,$ as s,J as u};
