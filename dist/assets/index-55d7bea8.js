import{r as c,a as H,b as L}from"./vendor-ce4ffebd.js";import{B as Y}from"./routing-89dfa7f7.js";import{c as G,_ as F}from"./supabase-e6e84841.js";import{A as O,U as C,M as z,L as P,a as X,b as Z,B as E,X as T,T as U,G as K,C as M,S as q,E as A,c as D,d as Q,e as ee,f as te,D as se}from"./icons-ce793056.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function i(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(n){if(n.ep)return;n.ep=!0;const o=i(n);fetch(n.href,o)}})();var W={exports:{}},I={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var re=c,ae=Symbol.for("react.element"),le=Symbol.for("react.fragment"),ne=Object.prototype.hasOwnProperty,ie=re.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,oe={key:!0,ref:!0,__self:!0,__source:!0};function J(r,t,i){var l,n={},o=null,d=null;i!==void 0&&(o=""+i),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(d=t.ref);for(l in t)ne.call(t,l)&&!oe.hasOwnProperty(l)&&(n[l]=t[l]);if(r&&r.defaultProps)for(l in t=r.defaultProps,t)n[l]===void 0&&(n[l]=t[l]);return{$$typeof:ae,type:r,key:o,ref:d,props:n,_owner:ie.current}}I.Fragment=le;I.jsx=J;I.jsxs=J;W.exports=I;var e=W.exports,R={},$=H;R.createRoot=$.createRoot,R.hydrateRoot=$.hydrateRoot;const ce="https://adtsbzzizbwjiqrkqofp.supabase.co",de="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFkdHNienppemJ3amlxcmtxb2ZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA0ODAyNzYsImV4cCI6MjA2NjA1NjI3Nn0.Fzqt6WBr9vq17jV8hDGm5Nw2chIC2Yern7ePfQ5Sq-4",w=G(ce,de,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),B=c.createContext(void 0),me=({children:r})=>{const[t,i]=c.useState(null),[l,n]=c.useState(null),[o,d]=c.useState(!0);c.useEffect(()=>{j();const{data:{subscription:a}}=w.auth.onAuthStateChange(async(f,s)=>{var g;if(console.log("Auth state changed:",f,(g=s==null?void 0:s.user)==null?void 0:g.id),s!=null&&s.user){if(n(s.user),f==="USER_UPDATED"&&s.user.email&&(t==null?void 0:t.email)!==s.user.email){console.log("Email confirmed, updating database:",s.user.email);try{const{error:b}=await w.from("users").update({email:s.user.email}).eq("id",s.user.id);b?console.error("Error updating email in database:",b):console.log("Email updated in database successfully")}catch(b){console.error("Error updating email in database:",b)}}await p(s.user.id)}else n(null),i(null);d(!1)});return()=>{a.unsubscribe()}},[]);const j=async()=>{try{const{data:{session:a},error:f}=await w.auth.getSession();if(f){console.error("Error getting session:",f),d(!1);return}a!=null&&a.user&&(n(a.user),await p(a.user.id))}catch(a){console.error("Error in getInitialSession:",a)}finally{d(!1)}},p=async a=>{var f;try{const{data:s,error:g}=await w.from("users").select(`
          id,
          name,
          role,
          family_id,
          birth_date,
          age,
          created_at,
          families!inner(id, name)
        `).eq("id",a).single();if(g){console.error("Error fetching user profile:",g);return}if(s){const{data:b}=await w.auth.getUser(),y={id:s.id,name:s.name,email:((f=b==null?void 0:b.user)==null?void 0:f.email)||"",role:s.role,familyId:s.family_id,birthDate:s.birth_date?new Date(s.birth_date):void 0,age:s.age,createdAt:new Date(s.created_at)};i(y)}}catch(s){console.error("Error in fetchUserProfile:",s)}},u=async(a,f,s,g)=>{try{const{data:b,error:y}=await w.auth.signUp({email:a,password:f});if(y)throw y;if(b.user){let S;if(g==="PARENT"){const{data:v,error:k}=await w.from("families").insert({name:`${s}さんの家族`}).select().single();if(k)throw k;S=v.id}else{const{data:v,error:k}=await w.from("families").select("id").limit(1).single();if(k)throw k;S=v.id}const{error:m}=await w.from("users").insert({id:b.user.id,family_id:S,name:s,role:g});if(m)throw m;console.log("User registered successfully")}}catch(b){throw console.error("Registration error:",b),b}},N=async(a,f)=>{try{const{error:s}=await w.auth.signInWithPassword({email:a,password:f});if(s)throw s}catch(s){throw console.error("Login error:",s),s}},x=async()=>{try{const{error:a}=await w.auth.signOut();if(a)throw a}catch(a){throw console.error("Logout error:",a),a}},h=a=>{t&&i({...t,...a})};return e.jsx(B.Provider,{value:{user:t,supabaseUser:l,login:N,logout:x,register:u,updateUser:h,loading:o},children:r})},_=()=>{const r=c.useContext(B);if(r===void 0)throw new Error("useAuth must be used within an AuthProvider");return r},ue=async()=>{if("serviceWorker"in navigator)try{const r=await navigator.serviceWorker.register("/sw.js");return console.log("Service Worker registered successfully:",r),r.addEventListener("updatefound",()=>{console.log("Service Worker update found")}),r}catch(r){console.error("Service Worker registration failed:",r)}},xe=async()=>"Notification"in window?await Notification.requestPermission()==="granted":!1,pe=()=>window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0,he=(r,t,i)=>{"Notification"in window&&Notification.permission==="granted"&&new Notification(r,{body:t,icon:i||"/pwa-192x192.png",badge:"/pwa-64x64.png"})},V=c.createContext(void 0),fe=()=>{const r=c.useContext(V);if(!r)throw new Error("useNotifications must be used within NotificationProvider");return r},ge=({children:r})=>{const{user:t}=_(),[i,l]=c.useState([]),n=()=>Math.random().toString(36).substr(2,9),o=x=>{const h={...x,id:n(),createdAt:new Date,read:!1};l(a=>[h,...a]),he(x.title,x.message)},d=x=>{l(h=>h.map(a=>a.id===x?{...a,read:!0}:a))},j=()=>{l(x=>x.map(h=>({...h,read:!0})))},p=()=>{l([])},u=i.filter(x=>!x.read).length;c.useEffect(()=>{if(!(t!=null&&t.familyId))return;const x=w.channel("task_completions").on("postgres_changes",{event:"INSERT",schema:"public",table:"task_completions",filter:`family_id=eq.${t.familyId}`},s=>{t.role==="PARENT"&&s.new.child_id!==t.id&&o({title:"🎯 タスク完了報告",message:"お子様がタスクを完了しました！承認をお待ちしています。",type:"task_completed",data:s.new})}).subscribe(),h=w.channel("task_approvals").on("postgres_changes",{event:"UPDATE",schema:"public",table:"task_completions",filter:`child_id=eq.${t.id}`},s=>{if(t.role==="CHILD"){const g=s.new.status;g==="APPROVED"?o({title:"✅ タスク承認",message:"タスクが承認されました！ポイントを獲得しました。",type:"task_approved",data:s.new}):g==="REJECTED"&&o({title:"❌ タスク却下",message:"タスクが却下されました。もう一度挑戦してみましょう。",type:"task_rejected",data:s.new})}}).subscribe(),a=w.channel("new_tasks").on("postgres_changes",{event:"INSERT",schema:"public",table:"tasks",filter:`family_id=eq.${t.familyId}`},s=>{t.role==="CHILD"&&(!s.new.assigned_to||s.new.assigned_to===t.id)&&o({title:"🆕 新しいクエスト",message:`新しいクエスト「${s.new.title}」が追加されました！`,type:"new_task",data:s.new})}).subscribe(),f=w.channel("point_transactions").on("postgres_changes",{event:"INSERT",schema:"public",table:"point_transactions",filter:`user_id=eq.${t.id}`},s=>{t.role==="CHILD"&&s.new.type==="EARNED"&&o({title:"💎 ポイント獲得",message:`${s.new.amount}ポイントを獲得しました！`,type:"points_awarded",data:s.new})}).subscribe();return()=>{x.unsubscribe(),h.unsubscribe(),a.unsubscribe(),f.unsubscribe()}},[t==null?void 0:t.familyId,t==null?void 0:t.id,t==null?void 0:t.role]);const N={notifications:i,unreadCount:u,markAsRead:d,markAllAsRead:j,addNotification:o,clearNotifications:p};return e.jsx(V.Provider,{value:N,children:r})},we=()=>{const[r,t]=c.useState(!0),[i,l]=c.useState({email:"",password:"",name:"",role:"PARENT"}),[n,o]=c.useState(""),[d,j]=c.useState(!1),{login:p,register:u}=_(),N=async a=>{a.preventDefault(),o(""),j(!0);try{r?await p(i.email,i.password):(await u(i.email,i.password,i.name,i.role),alert("アカウントが作成されました！ログインしてください。"),t(!0))}catch(f){o(f.message||"エラーが発生しました")}finally{j(!1)}},x=()=>{l({email:"",password:"",name:"",role:"PARENT"}),o("")},h=()=>{t(!r),x()};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-400 via-pink-500 to-red-500 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl p-8 w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🏠"}),e.jsx("h1",{className:"text-3xl font-bold text-purple-800 mb-2",children:"おこづかいクエスト"}),e.jsx("p",{className:"text-purple-600",children:r?"ログインしてください":"新しいアカウントを作成"})]}),n&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-3",children:[e.jsx(O,{className:"w-5 h-5 text-red-500"}),e.jsx("p",{className:"text-red-700 text-sm",children:n})]}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[!r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"お名前"}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",value:i.name,onChange:a=>l({...i,name:a.target.value}),className:"input-field pl-10",placeholder:"山田太郎",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"役割"}),e.jsxs("select",{value:i.role,onChange:a=>l({...i,role:a.target.value}),className:"input-field",required:!0,children:[e.jsx("option",{value:"PARENT",children:"👨‍👩‍👧‍👦 保護者"}),e.jsx("option",{value:"CHILD",children:"🧒 子供"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"メールアドレス"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"email",value:i.email,onChange:a=>l({...i,email:a.target.value}),className:"input-field pl-10",placeholder:"example@email.com",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"パスワード"}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"password",value:i.password,onChange:a=>l({...i,password:a.target.value}),className:"input-field pl-10",placeholder:"••••••••",minLength:6,required:!0})]}),!r&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"6文字以上で入力してください"})]}),e.jsx("button",{type:"submit",disabled:d,className:`w-full py-3 px-4 rounded-2xl font-bold text-lg transition-all flex items-center justify-center gap-3 ${d?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:shadow-lg"}`,children:d?"処理中...":r?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-5 h-5"}),"ログイン"]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-5 h-5"}),"アカウント作成"]})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:h,className:"text-purple-600 hover:text-purple-800 text-sm font-medium",children:r?"アカウントをお持ちでない方はこちら":"すでにアカウントをお持ちの方はこちら"})})]})})},be=()=>{const{notifications:r,unreadCount:t,markAsRead:i,markAllAsRead:l,clearNotifications:n}=fe(),[o,d]=c.useState(!1),j=u=>{switch(u){case"task_completed":return e.jsx(U,{className:"w-5 h-5 text-blue-500"});case"task_approved":return e.jsx(M,{className:"w-5 h-5 text-green-500"});case"task_rejected":return e.jsx(O,{className:"w-5 h-5 text-red-500"});case"points_awarded":return e.jsx(K,{className:"w-5 h-5 text-purple-500"});case"new_task":return e.jsx(U,{className:"w-5 h-5 text-orange-500"});default:return e.jsx(E,{className:"w-5 h-5 text-gray-500"})}},p=u=>{const x=new Date().getTime()-u.getTime(),h=Math.floor(x/6e4),a=Math.floor(x/36e5),f=Math.floor(x/864e5);return h<1?"たった今":h<60?`${h}分前`:a<24?`${a}時間前`:`${f}日前`};return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>d(!o),className:"relative p-2 text-gray-600 hover:text-purple-600 transition-colors",children:[e.jsx(E,{className:"w-6 h-6"}),t>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold",children:t>9?"9+":t})]}),o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>d(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-80 bg-white rounded-2xl shadow-2xl border border-gray-200 z-50 max-h-96 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-100 bg-gradient-to-r from-purple-50 to-pink-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-purple-600"}),"通知"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t>0&&e.jsx("button",{onClick:l,className:"text-sm text-purple-600 hover:text-purple-800 font-medium",children:"すべて既読"}),e.jsx("button",{onClick:()=>d(!1),className:"p-1 text-gray-400 hover:text-gray-600",children:e.jsx(T,{className:"w-4 h-4"})})]})]})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:r.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(E,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{children:"通知はありません"})]}):r.map(u=>e.jsx("div",{onClick:()=>i(u.id),className:`p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 transition-colors ${u.read?"":"bg-blue-50 border-l-4 border-l-blue-500"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[j(u.type),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:`font-medium text-sm ${u.read?"text-gray-700":"text-gray-900"}`,children:u.title}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:u.message}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:p(u.createdAt)})]}),!u.read&&e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2"})]})},u.id))}),r.length>0&&e.jsx("div",{className:"p-3 border-t border-gray-100 bg-gray-50",children:e.jsx("button",{onClick:n,className:"w-full text-sm text-gray-600 hover:text-gray-800 font-medium",children:"すべての通知を削除"})})]})]})]})},je=({onClose:r})=>{const{user:t,updateUser:i}=_(),[l,n]=c.useState(!1),[o,d]=c.useState(null),[j,p]=c.useState(null),[u,N]=c.useState(!1),[x,h]=c.useState(!1),[a,f]=c.useState(!1),[s,g]=c.useState({email:(t==null?void 0:t.email)||"",name:(t==null?void 0:t.name)||"",currentPassword:"",newPassword:"",confirmPassword:""}),b=async()=>{if(!s.email||s.email===(t==null?void 0:t.email)){p("新しいメールアドレスを入力してください");return}n(!0),p(null),d(null);try{const{error:m}=await w.auth.updateUser({email:s.email});if(m)throw m;d(`新しいメールアドレス（${s.email}）に確認メールを送信しました。メール内のリンクをクリックして変更を完了してください。現在のメールアドレスは変更されていません。`),g({...s,email:(t==null?void 0:t.email)||""})}catch(m){console.error("メールアドレス更新エラー:",m),p(m.message||"メールアドレスの更新に失敗しました")}finally{n(!1)}},y=async()=>{if(!s.currentPassword||!s.newPassword||!s.confirmPassword){p("すべてのパスワードフィールドを入力してください");return}if(s.newPassword!==s.confirmPassword){p("新しいパスワードが一致しません");return}if(s.newPassword.length<6){p("新しいパスワードは6文字以上で入力してください");return}n(!0),p(null),d(null);try{const{error:m}=await w.auth.signInWithPassword({email:(t==null?void 0:t.email)||"",password:s.currentPassword});if(m)throw new Error("現在のパスワードが正しくありません");const{error:v}=await w.auth.updateUser({password:s.newPassword});if(v)throw v;d("パスワードが正常に更新されました"),g({...s,currentPassword:"",newPassword:"",confirmPassword:""})}catch(m){console.error("パスワード更新エラー:",m),p(m.message||"パスワードの更新に失敗しました")}finally{n(!1)}},S=async()=>{if(!s.name||s.name===(t==null?void 0:t.name)){p("新しい名前を入力してください");return}n(!0),p(null),d(null);try{const{error:m}=await w.from("users").update({name:s.name}).eq("id",t==null?void 0:t.id);if(m)throw m;d("名前が正常に更新されました"),i&&i({...t,name:s.name})}catch(m){console.error("名前更新エラー:",m),p(m.message||"名前の更新に失敗しました")}finally{n(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 rounded-3xl p-6 lg:p-8 w-full max-w-2xl border-4 border-purple-300 shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-2xl lg:text-3xl font-bold text-purple-800 flex items-center gap-3",children:[e.jsx(C,{className:"w-8 h-8"}),"⚙️ アカウント設定"]}),e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(T,{className:"w-6 h-6"})})]}),o&&e.jsxs("div",{className:"mb-6 p-4 bg-green-50 border-2 border-green-200 rounded-2xl flex items-center gap-3",children:[e.jsx(M,{className:"w-6 h-6 text-green-600"}),e.jsx("p",{className:"text-green-800 font-medium",children:o})]}),j&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border-2 border-red-200 rounded-2xl flex items-center gap-3",children:[e.jsx(O,{className:"w-6 h-6 text-red-600"}),e.jsx("p",{className:"text-red-800 font-medium",children:j})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-xl font-bold text-purple-700 flex items-center gap-2",children:[e.jsx(C,{className:"w-6 h-6"}),"基本情報"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-2",children:"📝 お名前"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"text",value:s.name,onChange:m=>g({...s,name:m.target.value}),className:"flex-1 input-field",placeholder:"お名前を入力"}),e.jsxs("button",{onClick:S,disabled:l||!s.name||s.name===(t==null?void 0:t.name),className:"btn-primary px-4 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(q,{className:"w-4 h-4"}),"更新"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-2",children:"📧 メールアドレス"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-purple-500"}),e.jsx("input",{type:"email",value:s.email,onChange:m=>g({...s,email:m.target.value}),className:"input-field pl-11",placeholder:"新しいメールアドレス"})]}),e.jsxs("button",{onClick:b,disabled:l||!s.email||s.email===(t==null?void 0:t.email),className:"btn-primary px-4 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(q,{className:"w-4 h-4"}),"更新"]})]}),e.jsx("p",{className:"text-xs text-purple-600 mt-2",children:"※ メールアドレス変更後は確認メールで認証が必要です"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-xl font-bold text-purple-700 flex items-center gap-2",children:[e.jsx(P,{className:"w-6 h-6"}),"パスワード変更"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-2",children:"🔒 現在のパスワード"}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-purple-500"}),e.jsx("input",{type:u?"text":"password",value:s.currentPassword,onChange:m=>g({...s,currentPassword:m.target.value}),className:"input-field pl-11 pr-11",placeholder:"現在のパスワード"}),e.jsx("button",{type:"button",onClick:()=>N(!u),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-purple-500 hover:text-purple-700",children:u?e.jsx(A,{className:"w-5 h-5"}):e.jsx(D,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-2",children:"🆕 新しいパスワード"}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-purple-500"}),e.jsx("input",{type:x?"text":"password",value:s.newPassword,onChange:m=>g({...s,newPassword:m.target.value}),className:"input-field pl-11 pr-11",placeholder:"新しいパスワード（6文字以上）"}),e.jsx("button",{type:"button",onClick:()=>h(!x),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-purple-500 hover:text-purple-700",children:x?e.jsx(A,{className:"w-5 h-5"}):e.jsx(D,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-2",children:"✅ パスワード確認"}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-purple-500"}),e.jsx("input",{type:a?"text":"password",value:s.confirmPassword,onChange:m=>g({...s,confirmPassword:m.target.value}),className:"input-field pl-11 pr-11",placeholder:"新しいパスワードを再入力"}),e.jsx("button",{type:"button",onClick:()=>f(!a),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-purple-500 hover:text-purple-700",children:a?e.jsx(A,{className:"w-5 h-5"}):e.jsx(D,{className:"w-5 h-5"})})]})]}),e.jsxs("button",{onClick:y,disabled:l||!s.currentPassword||!s.newPassword||!s.confirmPassword,className:"w-full btn-primary py-3 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(P,{className:"w-5 h-5"}),l?"更新中...":"🔐 パスワードを更新"]})]})]})]}),e.jsx("div",{className:"mt-8 pt-6 border-t border-purple-200 flex justify-center gap-4",children:e.jsx("button",{onClick:r,className:"btn-secondary px-8 py-3",children:"🔙 閉じる"})})]})})},Ne=L.lazy(()=>F(()=>import("./ParentDashboard-ea4d329e.js"),["assets/ParentDashboard-ea4d329e.js","assets/supabase-e6e84841.js","assets/vendor-ce4ffebd.js","assets/database-94fba64c.js","assets/dateUtils-280973c0.js","assets/icons-ce793056.js","assets/routing-89dfa7f7.js"])),ye=L.lazy(()=>F(()=>import("./ChildDashboard-7e14a1ac.js"),["assets/ChildDashboard-7e14a1ac.js","assets/supabase-e6e84841.js","assets/vendor-ce4ffebd.js","assets/database-94fba64c.js","assets/icons-ce793056.js","assets/routing-89dfa7f7.js"])),ve=()=>{const{user:r,logout:t}=_(),[i,l]=c.useState(!1);return r?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50",children:[e.jsx("header",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-primary-500 rounded-full flex items-center justify-center",children:e.jsx(C,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"🏰 おこづかいクエスト"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[r.name,"さん (",r.role==="PARENT"?"保護者":"お子様",")"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{}),e.jsxs("button",{onClick:()=>l(!0),className:"flex items-center gap-2 px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors",title:"アカウント設定",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden md:inline",children:"設定"})]}),e.jsxs("button",{onClick:t,className:"flex items-center gap-2 px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden md:inline",children:"ログアウト"})]})]})]})})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-purple-500 border-t-transparent mx-auto mb-4"}),e.jsx("p",{className:"text-purple-600 text-lg font-medium",children:"ダッシュボードを読み込み中..."})]})}),children:r.role==="PARENT"?e.jsx(Ne,{}):e.jsx(ye,{})})}),i&&e.jsx(je,{onClose:()=>l(!1)})]}):null},Pe=()=>{const[r,t]=c.useState(null),[i,l]=c.useState(!1),[n,o]=c.useState(!1);c.useEffect(()=>{if(pe()||localStorage.getItem("pwa-prompt-dismissed"))return;const u=h=>{h.preventDefault(),t(h),l(!0)};window.addEventListener("beforeinstallprompt",u);const N=/iPad|iPhone|iPod/.test(navigator.userAgent),x=window.navigator.standalone;return N&&!x&&!localStorage.getItem("pwa-prompt-dismissed")&&setTimeout(()=>l(!0),5e3),()=>{window.removeEventListener("beforeinstallprompt",u)}},[]);const d=async()=>{if(r){r.prompt();const{outcome:u}=await r.userChoice;u==="accepted"&&console.log("PWA installed"),t(null),l(!1)}},j=()=>{l(!1),o(!0),localStorage.setItem("pwa-prompt-dismissed","true")},p=/iPad|iPhone|iPod/.test(navigator.userAgent);return!i||n?null:e.jsx("div",{className:"fixed bottom-4 left-4 right-4 z-50 md:left-auto md:right-4 md:max-w-sm",children:e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-2xl shadow-2xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-white bg-opacity-20 rounded-full p-2",children:e.jsx(te,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg mb-1",children:"アプリをインストール"}),e.jsx("p",{className:"text-sm opacity-90 mb-3",children:p?"このアプリをホーム画面に追加して、より便利にご利用ください。":"アプリをインストールして、オフラインでも使用できるようにしましょう。"}),p?e.jsx("div",{className:"text-xs opacity-80 mb-3",children:e.jsx("p",{children:"📱 Safari で「共有」→「ホーム画面に追加」をタップ"})}):null,e.jsxs("div",{className:"flex gap-2",children:[!p&&e.jsxs("button",{onClick:d,className:"flex-1 bg-white text-purple-600 font-bold py-2 px-4 rounded-lg flex items-center justify-center gap-2 hover:bg-gray-100 transition-colors",children:[e.jsx(se,{className:"w-4 h-4"}),"インストール"]}),e.jsx("button",{onClick:j,className:"bg-white bg-opacity-20 hover:bg-opacity-30 text-white font-medium py-2 px-4 rounded-lg transition-colors",children:"後で"})]})]}),e.jsx("button",{onClick:j,className:"text-white text-opacity-70 hover:text-opacity-100 transition-colors",children:e.jsx(T,{className:"w-5 h-5"})})]})})})},Se=()=>{const{user:r,loading:t}=_();return c.useEffect(()=>{ue(),r&&xe()},[r]),t?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-400 via-pink-500 to-red-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-white border-t-transparent mx-auto mb-4"}),e.jsx("p",{className:"text-white text-lg font-medium",children:"読み込み中..."})]})}):e.jsxs(e.Fragment,{children:[r?e.jsx(ge,{children:e.jsx(ve,{})}):e.jsx(we,{}),e.jsx(Pe,{})]})},ke=()=>e.jsx(me,{children:e.jsx(Se,{})});R.createRoot(document.getElementById("root")).render(e.jsx(L.StrictMode,{children:e.jsx(Y,{children:e.jsx(ke,{})})}));export{e as j,w as s,_ as u};
