import{u as v,j as e}from"./index-774b8088.js";import{r as j}from"./vendor-ce4ffebd.js";import{s as h}from"./storage-8020bd0d.js";import{c as D}from"./dateUtils-280973c0.js";import{P as N,k as S,C,i as T,h as y}from"./icons-09cb8d8e.js";import"./routing-89dfa7f7.js";import"./supabase-e6e84841.js";const M=({children:s})=>{const{user:d}=v(),[b,t]=j.useState([]),[n,o]=j.useState([]),[a,p]=j.useState(!1),[x,m]=j.useState("active");j.useEffect(()=>{l()},[]);const l=()=>{t(h.getEvents()),o(h.getEventResults())},i=b.filter(c=>c.dueDate?new Date(c.dueDate)>=new Date:!0),u=b.filter(c=>c.dueDate?new Date(c.dueDate)<new Date:!1),g=c=>n.filter(f=>f.eventId===c),r=c=>{const f=s.find(E=>E.id===c);return(f==null?void 0:f.name)||"ä¸æ˜"};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-purple-800",children:"ğŸ‰ ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†"}),(d==null?void 0:d.role)==="PARENT"&&e.jsxs("button",{onClick:()=>p(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(N,{className:"w-5 h-5"}),"âœ¨ æ–°ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆ"]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsxs("button",{onClick:()=>m("active"),className:`px-6 py-3 rounded-full font-bold transition-all ${x==="active"?"bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:["ğŸ”¥ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¤ãƒ™ãƒ³ãƒˆ (",i.length,")"]}),e.jsxs("button",{onClick:()=>m("completed"),className:`px-6 py-3 rounded-full font-bold transition-all ${x==="completed"?"bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:["âœ… å®Œäº†ã‚¤ãƒ™ãƒ³ãƒˆ (",u.length,")"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(x==="active"?i:u).map(c=>e.jsx(w,{event:c,results:g(c.id),children:s,getChildName:r,onUpdate:l},c.id)),(x==="active"?i:u).length===0&&e.jsx("div",{className:"col-span-full text-center py-12",children:e.jsx("p",{className:"text-purple-600 text-lg",children:x==="active"?"ğŸ¯ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¤ãƒ™ãƒ³ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“":"ğŸ“… å®Œäº†ã—ãŸã‚¤ãƒ™ãƒ³ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“"})})]})]}),a&&e.jsx(P,{onClose:()=>p(!1),onSave:l,children:s})]})},w=({event:s,results:d,children:b,getChildName:t,onUpdate:n})=>{const{user:o}=v(),[a,p]=j.useState(!1),x=s.assignedTo?b.find(r=>r.id===s.assignedTo):null,m=s.dueDate&&new Date(s.dueDate)<new Date,l=d.find(r=>r.childId===(o==null?void 0:o.id)),i=(o==null?void 0:o.role)==="CHILD"&&(!s.assignedTo||s.assignedTo===o.id)&&!l&&!m,u=r=>{switch(r){case"SCORE_BASED":return"ğŸ“Š";case"EVALUATION_BASED":return"â­";case"COMPLETION_BASED":return"âœ…";default:return"ğŸ¯"}},g=r=>{switch(r){case"SCORE_BASED":return"ç‚¹æ•°ãƒ™ãƒ¼ã‚¹";case"EVALUATION_BASED":return"è©•ä¾¡ãƒ™ãƒ¼ã‚¹";case"COMPLETION_BASED":return"å®Œäº†ãƒ™ãƒ¼ã‚¹";default:return r}};return e.jsxs("div",{className:`p-6 rounded-2xl border-2 shadow-lg transition-all hover:shadow-xl ${m?"bg-gradient-to-br from-gray-100 to-gray-200 border-gray-300":"bg-gradient-to-br from-yellow-100 to-orange-100 border-yellow-300"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-orange-800",children:s.title}),e.jsx("p",{className:"text-sm text-orange-600 font-medium",children:s.category})]}),e.jsx("div",{className:"text-2xl",children:u(s.eventType)})]}),e.jsx("p",{className:"text-sm text-orange-700 mb-4",children:s.description}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs px-3 py-1 bg-orange-200 text-orange-700 rounded-full",children:g(s.eventType)}),e.jsx("span",{className:"text-xs px-3 py-1 bg-purple-200 text-purple-700 rounded-full",children:x?x.name:"å…¨å“¡"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-orange-600",children:[e.jsx(S,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.pointsConfig.basePoints,"pt ï½ ",s.pointsConfig.maxPoints,"pt",s.pointsConfig.bonusPoints&&` (+${s.pointsConfig.bonusPoints}pt ãƒœãƒ¼ãƒŠã‚¹)`]})]}),s.dueDate&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-orange-600",children:[e.jsx(C,{className:"w-4 h-4"}),e.jsxs("span",{children:["æœŸé™: ",new Date(s.dueDate).toLocaleDateString("ja-JP")]}),m&&e.jsx("span",{className:"text-red-500 font-bold",children:"ï¼ˆæœŸé™åˆ‡ã‚Œï¼‰"})]})]}),d.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-bold text-sm text-orange-800 mb-2",children:"ğŸ“ çµæœ"}),e.jsx("div",{className:"space-y-2",children:d.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded-lg border border-orange-200",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-sm",children:t(r.childId)}),e.jsxs("div",{className:"text-xs text-gray-600",children:[r.resultType==="SCORE"&&`${r.score}ç‚¹`,r.resultType==="EVALUATION"&&r.evaluation,r.resultType==="COMPLETED"&&"å®Œäº†"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"font-bold text-purple-600",children:[r.earnedPoints,"pt"]}),r.bonusEarned&&e.jsx("span",{className:"text-xs text-green-600 block",children:"ãƒœãƒ¼ãƒŠã‚¹ç²å¾—ï¼"})]})]},r.id))})]}),i&&e.jsxs("button",{onClick:()=>p(!0),className:"w-full btn-primary text-sm flex items-center justify-center gap-2",children:[e.jsx(T,{className:"w-4 h-4"}),"ğŸš€ çµæœã‚’å ±å‘Š"]}),l&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(y,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{className:"text-green-600 font-medium",children:["çµæœå ±å‘Šæ¸ˆã¿ (",l.earnedPoints,"ptç²å¾—)"]})]}),a&&e.jsx(A,{event:s,onClose:()=>p(!1),onSave:n})]})},P=({onClose:s,onSave:d,children:b})=>{const[t,n]=j.useState({title:"",description:"",category:"ãƒ†ã‚¹ãƒˆ",eventType:"SCORE_BASED",assignedTo:"",basePoints:10,maxPoints:50,bonusPoints:10,targetScore:80,dueDate:""}),o=a=>{var m;a.preventDefault();const p=h.getEvents(),x={id:h.generateId(),title:t.title,description:t.description,category:t.category,eventType:t.eventType,pointsConfig:{basePoints:t.basePoints,maxPoints:t.maxPoints,bonusPoints:t.bonusPoints,targetScore:t.targetScore,scoreThresholds:t.eventType==="SCORE_BASED"?[{score:90,points:t.maxPoints},{score:80,points:Math.floor(t.maxPoints*.8)},{score:70,points:Math.floor(t.maxPoints*.6)},{score:60,points:Math.floor(t.maxPoints*.4)},{score:0,points:t.basePoints}]:void 0},assignedTo:t.assignedTo||void 0,createdBy:((m=h.getCurrentUser())==null?void 0:m.id)||"",dueDate:t.dueDate?new Date(t.dueDate):void 0,createdAt:new Date};p.push(x),h.saveEvents(p),d(),s()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 rounded-3xl p-8 w-full max-w-2xl border-4 border-purple-300 shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-2xl font-bold text-purple-800 mb-6 text-center",children:"ğŸ‰ æ–°ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½œæˆ"}),e.jsxs("form",{onSubmit:o,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"ğŸ“ ã‚¤ãƒ™ãƒ³ãƒˆå"}),e.jsx("input",{type:"text",value:t.title,onChange:a=>n({...t,title:a.target.value}),className:"input-field",placeholder:"ä¾‹: ç®—æ•°ã®ãƒ†ã‚¹ãƒˆ",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"ğŸ·ï¸ ã‚«ãƒ†ã‚´ãƒª"}),e.jsxs("select",{value:t.category,onChange:a=>n({...t,category:a.target.value}),className:"input-field",children:[e.jsx("option",{value:"ãƒ†ã‚¹ãƒˆ",children:"ãƒ†ã‚¹ãƒˆ"}),e.jsx("option",{value:"ç™ºè¡¨ä¼š",children:"ç™ºè¡¨ä¼š"}),e.jsx("option",{value:"ã‚³ãƒ³ã‚¯ãƒ¼ãƒ«",children:"ã‚³ãƒ³ã‚¯ãƒ¼ãƒ«"}),e.jsx("option",{value:"ç¿’ã„äº‹",children:"ç¿’ã„äº‹"}),e.jsx("option",{value:"ãã®ä»–",children:"ãã®ä»–"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"ğŸ“‹ èª¬æ˜"}),e.jsx("textarea",{value:t.description,onChange:a=>n({...t,description:a.target.value}),className:"input-field",rows:3,placeholder:"ã‚¤ãƒ™ãƒ³ãƒˆã®è©³ç´°ã‚’èª¬æ˜ã—ã¦ãã ã•ã„"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"âš™ï¸ ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—"}),e.jsxs("select",{value:t.eventType,onChange:a=>n({...t,eventType:a.target.value}),className:"input-field",children:[e.jsx("option",{value:"SCORE_BASED",children:"ğŸ“Š ç‚¹æ•°ãƒ™ãƒ¼ã‚¹ï¼ˆãƒ†ã‚¹ãƒˆç­‰ï¼‰"}),e.jsx("option",{value:"EVALUATION_BASED",children:"â­ è©•ä¾¡ãƒ™ãƒ¼ã‚¹ï¼ˆç™ºè¡¨ä¼šç­‰ï¼‰"}),e.jsx("option",{value:"COMPLETION_BASED",children:"âœ… å®Œäº†ãƒ™ãƒ¼ã‚¹"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"ğŸ‘§ å¯¾è±¡"}),e.jsxs("select",{value:t.assignedTo,onChange:a=>n({...t,assignedTo:a.target.value}),className:"input-field",children:[e.jsx("option",{value:"",children:"å…¨å“¡"}),b.map(a=>e.jsxs("option",{value:a.id,children:[a.name," (",a.birthDate?`${D(a.birthDate)}æ­³`:`${a.age||0}æ­³`,")"]},a.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-2",children:"ğŸ’ åŸºæœ¬ãƒã‚¤ãƒ³ãƒˆ"}),e.jsx("input",{type:"number",value:t.basePoints,onChange:a=>n({...t,basePoints:parseInt(a.target.value)}),className:"input-field",min:"1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-2",children:"âœ¨ æœ€å¤§ãƒã‚¤ãƒ³ãƒˆ"}),e.jsx("input",{type:"number",value:t.maxPoints,onChange:a=>n({...t,maxPoints:parseInt(a.target.value)}),className:"input-field",min:"1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-2",children:"ğŸ ãƒœãƒ¼ãƒŠã‚¹"}),e.jsx("input",{type:"number",value:t.bonusPoints,onChange:a=>n({...t,bonusPoints:parseInt(a.target.value)}),className:"input-field",min:"0"})]}),t.eventType==="SCORE_BASED"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-2",children:"ğŸ¯ ç›®æ¨™ç‚¹æ•°"}),e.jsx("input",{type:"number",value:t.targetScore,onChange:a=>n({...t,targetScore:parseInt(a.target.value)}),className:"input-field",min:"0",max:"100"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"ğŸ“… æœŸé™ï¼ˆä»»æ„ï¼‰"}),e.jsx("input",{type:"date",value:t.dueDate,onChange:a=>n({...t,dueDate:a.target.value}),className:"input-field"})]}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{type:"button",onClick:s,className:"btn-secondary text-lg px-8",children:"ğŸ”™ ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),e.jsxs("button",{type:"submit",className:"btn-primary text-lg flex items-center gap-3 px-8",children:[e.jsx(N,{className:"w-6 h-6"}),"ğŸ‰ ä½œæˆ"]})]})]})]})})},A=({event:s,onClose:d,onSave:b})=>{const{user:t}=v(),[n,o]=j.useState({score:0,evaluation:"",comments:""}),a=()=>{const{pointsConfig:l}=s;let i=l.basePoints,u=!1;if(s.eventType==="SCORE_BASED"&&l.scoreThresholds){for(const g of l.scoreThresholds)if(n.score>=g.score){i=g.points;break}l.targetScore&&n.score>=l.targetScore&&l.bonusPoints&&(i+=l.bonusPoints,u=!0)}else s.eventType==="COMPLETION_BASED"&&(i=l.maxPoints,l.bonusPoints&&(i+=l.bonusPoints,u=!0));return{earnedPoints:i,bonusEarned:u}},p=l=>{if(l.preventDefault(),!t)return;const{earnedPoints:i,bonusEarned:u}=a(),g=h.getEventResults(),r={id:h.generateId(),eventId:s.id,childId:t.id,resultType:s.eventType==="SCORE_BASED"?"SCORE":s.eventType==="EVALUATION_BASED"?"EVALUATION":"COMPLETED",score:s.eventType==="SCORE_BASED"?n.score:void 0,evaluation:s.eventType==="EVALUATION_BASED"?n.evaluation:void 0,earnedPoints:i,bonusEarned:u,submittedAt:new Date,status:"PENDING",comments:n.comments};g.push(r),h.saveEventResults(g),b(),d()},{earnedPoints:x,bonusEarned:m}=a();return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 rounded-3xl p-8 w-full max-w-md border-4 border-purple-300 shadow-2xl",children:[e.jsx("h3",{className:"text-2xl font-bold text-purple-800 mb-6 text-center",children:"ğŸ“ çµæœã‚’å ±å‘Š"}),e.jsxs("div",{className:"mb-6 p-4 bg-gradient-to-br from-yellow-100 to-orange-100 rounded-2xl border-2 border-yellow-300",children:[e.jsx("h4",{className:"font-bold text-orange-800",children:s.title}),e.jsx("p",{className:"text-sm text-orange-600 mt-1",children:s.description})]}),e.jsxs("form",{onSubmit:p,className:"space-y-6",children:[s.eventType==="SCORE_BASED"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"ğŸ“Š ç‚¹æ•°"}),e.jsx("input",{type:"number",value:n.score,onChange:l=>o({...n,score:parseInt(l.target.value)||0}),className:"input-field text-center text-2xl",min:"0",max:"100",placeholder:"ç‚¹æ•°ã‚’å…¥åŠ›",required:!0})]}),s.eventType==="EVALUATION_BASED"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"â­ è©•ä¾¡"}),e.jsxs("select",{value:n.evaluation,onChange:l=>o({...n,evaluation:l.target.value}),className:"input-field",required:!0,children:[e.jsx("option",{value:"",children:"è©•ä¾¡ã‚’é¸æŠ"}),e.jsx("option",{value:"ã¨ã¦ã‚‚ã‚ˆãã§ãã¾ã—ãŸ",children:"ã¨ã¦ã‚‚ã‚ˆãã§ãã¾ã—ãŸ"}),e.jsx("option",{value:"ã‚ˆãã§ãã¾ã—ãŸ",children:"ã‚ˆãã§ãã¾ã—ãŸ"}),e.jsx("option",{value:"ã§ãã¾ã—ãŸ",children:"ã§ãã¾ã—ãŸ"}),e.jsx("option",{value:"ãŒã‚“ã°ã‚Šã¾ã—ã‚‡ã†",children:"ãŒã‚“ã°ã‚Šã¾ã—ã‚‡ã†"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-bold text-purple-700 mb-2",children:"ğŸ’­ ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆä»»æ„ï¼‰"}),e.jsx("textarea",{value:n.comments,onChange:l=>o({...n,comments:l.target.value}),className:"input-field",rows:3,placeholder:"ãŒã‚“ã°ã£ãŸã“ã¨ã‚„æ„Ÿæƒ³ã‚’æ›¸ã„ã¦ã­"})]}),e.jsxs("div",{className:"p-4 bg-gradient-to-r from-green-100 to-emerald-100 rounded-2xl border-2 border-green-300",children:[e.jsx("h4",{className:"font-bold text-green-800 mb-2",children:"ğŸ‰ ç²å¾—äºˆå®šãƒã‚¤ãƒ³ãƒˆ"}),e.jsxs("div",{className:"text-3xl font-bold text-green-600 text-center",children:[x,"pt",m&&e.jsx("span",{className:"text-lg text-yellow-600 block",children:"+ ãƒœãƒ¼ãƒŠã‚¹ç²å¾—ï¼"})]})]}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{type:"button",onClick:d,className:"btn-secondary text-lg px-8",children:"ğŸ”™ ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),e.jsxs("button",{type:"submit",className:"btn-primary text-lg flex items-center gap-3 px-8",children:[e.jsx(y,{className:"w-6 h-6"}),"ğŸ“¤ é€ä¿¡"]})]})]})]})})};export{M as default};
