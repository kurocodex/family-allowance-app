import{s as t}from"./index-71bbfe5a.js";const e={async getUsers(e){try{const{data:a,error:r}=await t.from("users").select("*").eq("family_id",e);if(r){if("42P01"===r.code)return[];throw r}return(null==a?void 0:a.map(t=>({...t,createdAt:new Date(t.created_at),birthDate:t.birth_date?new Date(t.birth_date):void 0})))||[]}catch(a){return[]}},async createUser(e){var a;const{data:r,error:i}=await t.from("users").insert({family_id:e.familyId,name:e.name,role:e.role,birth_date:null==(a=e.birthDate)?void 0:a.toISOString(),age:e.age}).select().single();if(i)throw i;return{...r,createdAt:new Date(r.created_at),birthDate:r.birth_date?new Date(r.birth_date):void 0}},async getTasks(e){try{const{data:a,error:r}=await t.from("tasks").select("*").eq("family_id",e);if(r){if("42P01"===r.code)return[];throw r}return(null==a?void 0:a.map(t=>({...t,createdAt:new Date(t.created_at)})))||[]}catch(a){return[]}},async createTask(e,a){const{data:r,error:i}=await t.from("tasks").insert({family_id:a,title:e.title,description:e.description,points:e.points,category:e.category,difficulty:e.difficulty,is_recurring:e.isRecurring,created_by:e.createdBy,assigned_to:e.assignedTo}).select().single();if(i)throw i;return{...r,isRecurring:r.is_recurring,createdBy:r.created_by,assignedTo:r.assigned_to,createdAt:new Date(r.created_at)}},async updateTask(e,a){const{data:r,error:i}=await t.from("tasks").update({title:a.title,description:a.description,points:a.points,category:a.category,difficulty:a.difficulty,is_recurring:a.isRecurring,assigned_to:a.assignedTo}).eq("id",e).select().single();if(i)throw i;return{...r,isRecurring:r.is_recurring,createdBy:r.created_by,assignedTo:r.assigned_to,createdAt:new Date(r.created_at)}},async deleteTask(e){const{error:a}=await t.from("tasks").delete().eq("id",e);if(a)throw a},async getTaskCompletions(e){try{const{data:a,error:r}=await t.from("task_completions").select("*").eq("family_id",e);if(r){if("42P01"===r.code)return[];throw r}return(null==a?void 0:a.map(t=>({...t,taskId:t.task_id,childId:t.child_id,submittedAt:new Date(t.submitted_at),approvedAt:t.approved_at?new Date(t.approved_at):void 0,photoUrl:t.photo_url})))||[]}catch(a){return[]}},async createTaskCompletion(e,a){var r;const{data:i,error:n}=await t.from("task_completions").insert({family_id:a,task_id:e.taskId,child_id:e.childId,status:e.status,submitted_at:e.submittedAt.toISOString(),approved_at:null==(r=e.approvedAt)?void 0:r.toISOString(),photo_url:e.photoUrl,comments:e.comments}).select().single();if(n)throw n;return{...i,taskId:i.task_id,childId:i.child_id,submittedAt:new Date(i.submitted_at),approvedAt:i.approved_at?new Date(i.approved_at):void 0,photoUrl:i.photo_url}},async updateTaskCompletion(e,a){var r;const{data:i,error:n}=await t.from("task_completions").update({status:a.status,approved_at:null==(r=a.approvedAt)?void 0:r.toISOString(),comments:a.comments}).eq("id",e).select().single();if(n)throw n;return{...i,taskId:i.task_id,childId:i.child_id,submittedAt:new Date(i.submitted_at),approvedAt:i.approved_at?new Date(i.approved_at):void 0,photoUrl:i.photo_url}},async getPointTransactions(e){try{const{data:a,error:r}=await t.from("point_transactions").select("*").eq("family_id",e);if(r){if("42P01"===r.code)return[];throw r}return(null==a?void 0:a.map(t=>({...t,userId:t.user_id,createdAt:new Date(t.created_at)})))||[]}catch(a){return[]}},async createPointTransaction(e,a){const{data:r,error:i}=await t.from("point_transactions").insert({family_id:a,user_id:e.userId,type:e.type,amount:e.amount,description:e.description,created_at:e.createdAt.toISOString()}).select().single();if(i)throw i;return{...r,userId:r.user_id,createdAt:new Date(r.created_at)}},async getEvents(e){const{data:a,error:r}=await t.from("events").select("*").eq("family_id",e);if(r)throw r;return(null==a?void 0:a.map(t=>({...t,eventType:t.event_type,pointsConfig:t.points_config,assignedTo:t.assigned_to,createdBy:t.created_by,dueDate:t.due_date?new Date(t.due_date):void 0,createdAt:new Date(t.created_at)})))||[]},async createEvent(e,a){var r;const{data:i,error:n}=await t.from("events").insert({family_id:a,title:e.title,description:e.description,category:e.category,event_type:e.eventType,points_config:e.pointsConfig,assigned_to:e.assignedTo,created_by:e.createdBy,due_date:null==(r=e.dueDate)?void 0:r.toISOString()}).select().single();if(n)throw n;return{...i,eventType:i.event_type,pointsConfig:i.points_config,assignedTo:i.assigned_to,createdBy:i.created_by,dueDate:i.due_date?new Date(i.due_date):void 0,createdAt:new Date(i.created_at)}},async getEventResults(e){const{data:a,error:r}=await t.from("event_results").select("*").eq("family_id",e);if(r)throw r;return(null==a?void 0:a.map(t=>({...t,eventId:t.event_id,childId:t.child_id,resultType:t.result_type,earnedPoints:t.earned_points,bonusEarned:t.bonus_earned,submittedAt:new Date(t.submitted_at),approvedAt:t.approved_at?new Date(t.approved_at):void 0})))||[]},async createEventResult(e,a){var r;const{data:i,error:n}=await t.from("event_results").insert({family_id:a,event_id:e.eventId,child_id:e.childId,result_type:e.resultType,score:e.score,evaluation:e.evaluation,earned_points:e.earnedPoints,bonus_earned:e.bonusEarned,submitted_at:e.submittedAt.toISOString(),approved_at:null==(r=e.approvedAt)?void 0:r.toISOString(),status:e.status,comments:e.comments}).select().single();if(n)throw n;return{...i,eventId:i.event_id,childId:i.child_id,resultType:i.result_type,earnedPoints:i.earned_points,bonusEarned:i.bonus_earned,submittedAt:new Date(i.submitted_at),approvedAt:i.approved_at?new Date(i.approved_at):void 0}},async getRateRules(e){const{data:a,error:r}=await t.from("rate_rules").select("*").eq("family_id",e);if(r)throw r;return(null==a?void 0:a.map(t=>({...t,isActive:t.is_active,createdAt:new Date(t.created_at),conditions:{...t.conditions,startDate:t.conditions.startDate?new Date(t.conditions.startDate):void 0,endDate:t.conditions.endDate?new Date(t.conditions.endDate):void 0}})))||[]},async createRateRule(e,a){const{data:r,error:i}=await t.from("rate_rules").insert({family_id:a,name:e.name,type:e.type,conditions:e.conditions,multiplier:e.multiplier,bonus_points:e.bonusPoints,description:e.description,is_active:e.isActive}).select().single();if(i)throw i;return{...r,isActive:r.is_active,bonusPoints:r.bonus_points,createdAt:new Date(r.created_at),conditions:{...r.conditions,startDate:r.conditions.startDate?new Date(r.conditions.startDate):void 0,endDate:r.conditions.endDate?new Date(r.conditions.endDate):void 0}}},generateId:()=>crypto.randomUUID()};export{e as d};
