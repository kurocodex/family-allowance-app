import{u as e,j as s}from"./index-9d927b8a.js";import{r as t}from"./vendor-18e24f2a.js";import{s as l}from"./storage-afc0bc2e.js";import{c as a}from"./dateUtils-d91f8443.js";import{s as r,T as n,h as d,t as i,j as c,i as o}from"./icons-61d3c260.js";import"./routing-3469486c.js";import"./supabase-c91fe37d.js";const m=({children:m})=>{e();const[x,h]=t.useState(""),[g,j]=t.useState(null),[p,u]=t.useState("3months");t.useEffect(()=>{m.length>0&&!x&&h(m[0].id)},[m,x]),t.useEffect(()=>{x&&f(x)},[x,p]);const f=e=>{const s=l.getTasks(),t=l.getTaskCompletions().filter(s=>s.childId===e),a=l.getPointTransactions().filter(s=>s.userId===e),r=new Date,n="1month"===p?1:"3months"===p?3:"6months"===p?6:999,d=new Date(r.getFullYear(),r.getMonth()-n,r.getDate()),i="all"===p?t:t.filter(e=>new Date(e.submittedAt)>=d),c="all"===p?a:a.filter(e=>new Date(e.createdAt)>=d),o=i.filter(e=>"APPROVED"===e.status).length,m=i.filter(e=>"PENDING"===e.status).length,x=i.length,h=c.filter(e=>"EARNED"===e.type).reduce((e,s)=>e+s.amount,0),g=c.filter(e=>"EXCHANGED"===e.type).reduce((e,s)=>e+s.amount,0),u=h-g,f={};i.filter(e=>"APPROVED"===e.status).forEach(e=>{const t=s.find(s=>s.id===e.taskId);t&&(f[t.category]=(f[t.category]||0)+1)});const b=[];for(let l=n-1;l>=0;l--){const e=new Date(r.getFullYear(),r.getMonth()-l,1),s=new Date(r.getFullYear(),r.getMonth()-l+1,1),n=t.filter(t=>"APPROVED"===t.status&&new Date(t.submittedAt)>=e&&new Date(t.submittedAt)<s),d=a.filter(t=>"EARNED"===t.type&&new Date(t.createdAt)>=e&&new Date(t.createdAt)<s).reduce((e,s)=>e+s.amount,0);b.push({month:e.toLocaleDateString("ja-JP",{month:"short"}),completed:n.length,points:d})}const N={totalTasks:x,completedTasks:o,pendingTasks:m,totalPoints:u,earnedPoints:h,spentPoints:g,averagePointsPerTask:o>0?Math.round(h/o):0,categoryStats:f,monthlyProgress:b,completionRate:x>0?Math.round(o/x*100):0};j(N)};return 0===m.length?s.jsxs("div",{className:"card text-center py-12",children:[s.jsx(r,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-bold text-gray-700 mb-2",children:"まだお子様が登録されていません"}),s.jsx("p",{className:"text-gray-500",children:"統計を表示するには、まずお子様を登録してください。"})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:s.jsx("h2",{className:"text-3xl font-bold text-purple-800",children:"📊 統計・レポート"})}),s.jsx("div",{className:"card",children:s.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"👧 お子様を選択"}),s.jsx("select",{value:x,onChange:e=>h(e.target.value),className:"input-field",children:m.map(e=>s.jsxs("option",{value:e.id,children:[e.name," (",e.birthDate?`${a(e.birthDate)}歳`:`${e.age||0}歳`,")"]},e.id))})]}),s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"📅 期間"}),s.jsxs("select",{value:p,onChange:e=>u(e.target.value),className:"input-field",children:[s.jsx("option",{value:"1month",children:"過去1ヶ月"}),s.jsx("option",{value:"3months",children:"過去3ヶ月"}),s.jsx("option",{value:"6months",children:"過去6ヶ月"}),s.jsx("option",{value:"all",children:"全期間"})]})]})]})}),g&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsx("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(n,{className:"w-10 h-10 text-blue-600"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-blue-600 text-sm font-medium",children:"完了したクエスト"}),s.jsx("p",{className:"text-2xl font-bold text-blue-800",children:g.completedTasks})]})]})}),s.jsx("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(d,{className:"w-10 h-10 text-green-600"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-green-600 text-sm font-medium",children:"現在の残高"}),s.jsx("p",{className:"text-2xl font-bold text-green-800",children:g.totalPoints})]})]})}),s.jsx("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(i,{className:"w-10 h-10 text-purple-600"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-purple-600 text-sm font-medium",children:"達成率"}),s.jsxs("p",{className:"text-2xl font-bold text-purple-800",children:[g.completionRate,"%"]})]})]})}),s.jsx("div",{className:"card bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(c,{className:"w-10 h-10 text-orange-600"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-orange-600 text-sm font-medium",children:"平均ポイント/クエスト"}),s.jsx("p",{className:"text-2xl font-bold text-orange-800",children:g.averagePointsPerTask})]})]})})]}),s.jsxs("div",{className:"card",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx(o,{className:"w-8 h-8 text-blue-500"}),s.jsx("h3",{className:"text-xl font-bold text-blue-700",children:"📈 月次進捗"})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-bold text-gray-700 mb-4",children:"完了したクエスト数"}),s.jsx("div",{className:"space-y-3",children:g.monthlyProgress.map((e,t)=>{const l=Math.max(...g.monthlyProgress.map(e=>e.completed),1),a=e.completed/l*100;return s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"text-sm font-medium text-gray-600 w-12",children:e.month}),s.jsxs("div",{className:"flex-1 bg-gray-200 rounded-full h-6 relative",children:[s.jsx("div",{className:"bg-gradient-to-r from-blue-400 to-blue-600 h-6 rounded-full transition-all",style:{width:`${a}%`}}),s.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-xs font-bold text-white",children:e.completed})]})]},t)})})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-bold text-gray-700 mb-4",children:"獲得ポイント"}),s.jsx("div",{className:"space-y-3",children:g.monthlyProgress.map((e,t)=>{const l=Math.max(...g.monthlyProgress.map(e=>e.points),1),a=e.points/l*100;return s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"text-sm font-medium text-gray-600 w-12",children:e.month}),s.jsxs("div",{className:"flex-1 bg-gray-200 rounded-full h-6 relative",children:[s.jsx("div",{className:"bg-gradient-to-r from-green-400 to-green-600 h-6 rounded-full transition-all",style:{width:`${a}%`}}),s.jsxs("span",{className:"absolute inset-0 flex items-center justify-center text-xs font-bold text-white",children:[e.points,"pt"]})]})]},t)})})]})]})]}),s.jsxs("div",{className:"card",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx(r,{className:"w-8 h-8 text-purple-500"}),s.jsx("h3",{className:"text-xl font-bold text-purple-700",children:"📋 カテゴリ別実績"})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[Object.entries(g.categoryStats).map(([e,t])=>{const l=t/Math.max(...Object.values(g.categoryStats),1)*100,a={"家事":"from-pink-400 to-pink-600","勉強":"from-blue-400 to-blue-600","運動":"from-green-400 to-green-600","その他":"from-gray-400 to-gray-600"}[e]||"from-purple-400 to-purple-600";return s.jsx("div",{className:"p-4 bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl border border-gray-200",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h4",{className:"font-bold text-gray-800 mb-2",children:e}),s.jsxs("div",{className:"relative w-20 h-20 mx-auto mb-3",children:[s.jsx("div",{className:"w-full h-full bg-gray-200 rounded-full"}),s.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${a} rounded-full transition-all flex items-center justify-center`,style:{background:`conic-gradient(from 0deg, currentColor ${3.6*l}deg, transparent ${3.6*l}deg)`},children:s.jsx("div",{className:"bg-white rounded-full w-12 h-12 flex items-center justify-center",children:s.jsx("span",{className:"font-bold text-gray-800 text-sm",children:t})})})]}),s.jsx("p",{className:"text-xs text-gray-600",children:"完了数"})]})},e)}),0===Object.keys(g.categoryStats).length&&s.jsx("div",{className:"col-span-full text-center py-8",children:s.jsx("p",{className:"text-gray-500",children:"まだ完了したクエストがありません"})})]})]}),s.jsxs("div",{className:"card",children:[s.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-6",children:"📊 詳細データ"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-bold text-gray-700",children:"クエスト実績"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between items-center p-3 bg-blue-50 rounded-lg",children:[s.jsx("span",{className:"text-blue-700 font-medium",children:"完了したクエスト"}),s.jsxs("span",{className:"font-bold text-blue-800",children:[g.completedTasks,"個"]})]}),s.jsxs("div",{className:"flex justify-between items-center p-3 bg-yellow-50 rounded-lg",children:[s.jsx("span",{className:"text-yellow-700 font-medium",children:"確認待ちクエスト"}),s.jsxs("span",{className:"font-bold text-yellow-800",children:[g.pendingTasks,"個"]})]}),s.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[s.jsx("span",{className:"text-gray-700 font-medium",children:"合計クエスト"}),s.jsxs("span",{className:"font-bold text-gray-800",children:[g.totalTasks,"個"]})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-bold text-gray-700",children:"ポイント実績"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between items-center p-3 bg-blue-50 rounded-lg",children:[s.jsx("span",{className:"text-blue-700 font-medium",children:"獲得総ポイント"}),s.jsxs("span",{className:"font-bold text-blue-800",children:[g.earnedPoints,"pt"]})]}),s.jsxs("div",{className:"flex justify-between items-center p-3 bg-red-50 rounded-lg",children:[s.jsx("span",{className:"text-red-700 font-medium",children:"使用ポイント"}),s.jsxs("span",{className:"font-bold text-red-800",children:[g.spentPoints,"pt"]})]}),s.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-50 rounded-lg",children:[s.jsx("span",{className:"text-green-700 font-medium",children:"現在の残高"}),s.jsxs("span",{className:"font-bold text-green-800",children:[g.totalPoints,"pt"]})]})]})]})]})]})]})]})};export{m as default};
