import{r as m,a as k,b as E}from"./vendor-ce4ffebd.js";import{B as T}from"./routing-89dfa7f7.js";import{c as U,_ as R}from"./supabase-e6e84841.js";import{A as q,U as L,M as F,L as z,a as J,b as M,c as B}from"./icons-09cb8d8e.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function i(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(r){if(r.ep)return;r.ep=!0;const c=i(r);fetch(r.href,c)}})();var C={exports:{}},j={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var V=m,Y=Symbol.for("react.element"),$=Symbol.for("react.fragment"),Z=Object.prototype.hasOwnProperty,W=V.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,X={key:!0,ref:!0,__self:!0,__source:!0};function O(s,a,i){var o,r={},c=null,d=null;i!==void 0&&(c=""+i),a.key!==void 0&&(c=""+a.key),a.ref!==void 0&&(d=a.ref);for(o in a)Z.call(a,o)&&!X.hasOwnProperty(o)&&(r[o]=a[o]);if(s&&s.defaultProps)for(o in a=s.defaultProps,a)r[o]===void 0&&(r[o]=a[o]);return{$$typeof:Y,type:s,key:c,ref:d,props:r,_owner:W.current}}j.Fragment=$;j.jsx=O;j.jsxs=O;C.exports=j;var e=C.exports,_={},S=k;_.createRoot=S.createRoot,_.hydrateRoot=S.hydrateRoot;const G="https://adtsbzzizbwjiqrkqofp.supabase.co",H="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFkdHNienppemJ3amlxcmtxb2ZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA0ODAyNzYsImV4cCI6MjA2NjA1NjI3Nn0.Fzqt6WBr9vq17jV8hDGm5Nw2chIC2Yern7ePfQ5Sq-4",u=U(G,H,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),D=m.createContext(void 0),K=({children:s})=>{const[a,i]=m.useState(null),[o,r]=m.useState(null),[c,d]=m.useState(!0);m.useEffect(()=>{f();const{data:{subscription:l}}=u.auth.onAuthStateChange(async(t,n)=>{var x;console.log("Auth state changed:",t,(x=n==null?void 0:n.user)==null?void 0:x.id),n!=null&&n.user?(r(n.user),await g(n.user.id)):(r(null),i(null)),d(!1)});return()=>{l.unsubscribe()}},[]);const f=async()=>{try{const{data:{session:l},error:t}=await u.auth.getSession();if(t){console.error("Error getting session:",t),d(!1);return}l!=null&&l.user&&(r(l.user),await g(l.user.id))}catch(l){console.error("Error in getInitialSession:",l)}finally{d(!1)}},g=async l=>{try{const{data:t,error:n}=await u.from("users").select(`
          id,
          name,
          role,
          family_id,
          birth_date,
          age,
          created_at,
          families!inner(id, name)
        `).eq("id",l).single();if(n){console.error("Error fetching user profile:",n);return}if(t){const x={id:t.id,name:t.name,email:(o==null?void 0:o.email)||"",role:t.role,familyId:t.family_id,birthDate:t.birth_date?new Date(t.birth_date):void 0,age:t.age,createdAt:new Date(t.created_at)};i(x)}}catch(t){console.error("Error in fetchUserProfile:",t)}},b=async(l,t,n,x)=>{try{const{data:h,error:A}=await u.auth.signUp({email:l,password:t});if(A)throw A;if(h.user){let N;if(x==="PARENT"){const{data:w,error:p}=await u.from("families").insert({name:`${n}さんの家族`}).select().single();if(p)throw p;N=w.id}else{const{data:w,error:p}=await u.from("families").select("id").limit(1).single();if(p)throw p;N=w.id}const{error:P}=await u.from("users").insert({id:h.user.id,family_id:N,name:n,role:x});if(P)throw P;console.log("User registered successfully")}}catch(h){throw console.error("Registration error:",h),h}},y=async(l,t)=>{try{const{error:n}=await u.auth.signInWithPassword({email:l,password:t});if(n)throw n}catch(n){throw console.error("Login error:",n),n}},v=async()=>{try{const{error:l}=await u.auth.signOut();if(l)throw l}catch(l){throw console.error("Logout error:",l),l}};return e.jsx(D.Provider,{value:{user:a,supabaseUser:o,login:y,logout:v,register:b,loading:c},children:s})},I=()=>{const s=m.useContext(D);if(s===void 0)throw new Error("useAuth must be used within an AuthProvider");return s},Q=()=>{const[s,a]=m.useState(!0),[i,o]=m.useState({email:"",password:"",name:"",role:"PARENT"}),[r,c]=m.useState(""),[d,f]=m.useState(!1),{login:g,register:b}=I(),y=async t=>{t.preventDefault(),c(""),f(!0);try{s?await g(i.email,i.password):(await b(i.email,i.password,i.name,i.role),alert("アカウントが作成されました！ログインしてください。"),a(!0))}catch(n){c(n.message||"エラーが発生しました")}finally{f(!1)}},v=()=>{o({email:"",password:"",name:"",role:"PARENT"}),c("")},l=()=>{a(!s),v()};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-400 via-pink-500 to-red-500 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl p-8 w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🏠"}),e.jsx("h1",{className:"text-3xl font-bold text-purple-800 mb-2",children:"おこづかいクエスト"}),e.jsx("p",{className:"text-purple-600",children:s?"ログインしてください":"新しいアカウントを作成"})]}),r&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-3",children:[e.jsx(q,{className:"w-5 h-5 text-red-500"}),e.jsx("p",{className:"text-red-700 text-sm",children:r})]}),e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[!s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"お名前"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",value:i.name,onChange:t=>o({...i,name:t.target.value}),className:"input-field pl-10",placeholder:"山田太郎",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"役割"}),e.jsxs("select",{value:i.role,onChange:t=>o({...i,role:t.target.value}),className:"input-field",required:!0,children:[e.jsx("option",{value:"PARENT",children:"👨‍👩‍👧‍👦 保護者"}),e.jsx("option",{value:"CHILD",children:"🧒 子供"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"メールアドレス"}),e.jsxs("div",{className:"relative",children:[e.jsx(F,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"email",value:i.email,onChange:t=>o({...i,email:t.target.value}),className:"input-field pl-10",placeholder:"example@email.com",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"パスワード"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"password",value:i.password,onChange:t=>o({...i,password:t.target.value}),className:"input-field pl-10",placeholder:"••••••••",minLength:6,required:!0})]}),!s&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"6文字以上で入力してください"})]}),e.jsx("button",{type:"submit",disabled:d,className:`w-full py-3 px-4 rounded-2xl font-bold text-lg transition-all flex items-center justify-center gap-3 ${d?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:shadow-lg"}`,children:d?"処理中...":s?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-5 h-5"}),"ログイン"]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-5 h-5"}),"アカウント作成"]})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:l,className:"text-purple-600 hover:text-purple-800 text-sm font-medium",children:s?"アカウントをお持ちでない方はこちら":"すでにアカウントをお持ちの方はこちら"})}),s&&e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:[e.jsx("h3",{className:"font-bold text-blue-800 mb-2",children:"デモ用アカウント"}),e.jsx("p",{className:"text-xs text-blue-600 mb-2",children:"開発中のため、以下のアカウントでテストできます："}),e.jsxs("div",{className:"text-xs text-blue-700 space-y-1",children:[e.jsx("div",{children:"📧 test@example.com"}),e.jsx("div",{children:"🔑 password123"})]})]})]})})},ee=E.lazy(()=>R(()=>import("./ParentDashboard-ae7c24c2.js"),["assets/ParentDashboard-ae7c24c2.js","assets/supabase-e6e84841.js","assets/vendor-ce4ffebd.js","assets/database-9ca2e4b5.js","assets/dateUtils-280973c0.js","assets/icons-09cb8d8e.js","assets/routing-89dfa7f7.js"])),te=E.lazy(()=>R(()=>import("./ChildDashboard-73a954a0.js"),["assets/ChildDashboard-73a954a0.js","assets/supabase-e6e84841.js","assets/vendor-ce4ffebd.js","assets/database-9ca2e4b5.js","assets/icons-09cb8d8e.js","assets/routing-89dfa7f7.js"])),re=()=>{const{user:s,logout:a}=I();return s?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50",children:[e.jsx("header",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-primary-500 rounded-full flex items-center justify-center",children:e.jsx(L,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"🏰 おこづかいクエスト"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.name,"さん (",s.role==="PARENT"?"保護者":"お子様",")"]})]})]}),e.jsxs("button",{onClick:a,className:"flex items-center gap-2 px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors",children:[e.jsx(B,{className:"w-4 h-4"}),"ログアウト"]})]})})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsx(m.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-purple-500 border-t-transparent mx-auto mb-4"}),e.jsx("p",{className:"text-purple-600 text-lg font-medium",children:"ダッシュボードを読み込み中..."})]})}),children:s.role==="PARENT"?e.jsx(ee,{}):e.jsx(te,{})})})]}):null},se=()=>{const{user:s,loading:a}=I();return a?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-400 via-pink-500 to-red-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-white border-t-transparent mx-auto mb-4"}),e.jsx("p",{className:"text-white text-lg font-medium",children:"読み込み中..."})]})}):s?e.jsx(re,{}):e.jsx(Q,{})},ae=()=>e.jsx(K,{children:e.jsx(se,{})});_.createRoot(document.getElementById("root")).render(e.jsx(E.StrictMode,{children:e.jsx(T,{children:e.jsx(ae,{})})}));export{e as j,u as s,I as u};
