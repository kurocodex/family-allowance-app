import{_ as e}from"./supabase-c91fe37d.js";import{u as s,j as l}from"./index-9ea7fdb9.js";import{b as t,r as a}from"./vendor-18e24f2a.js";import{d as n}from"./database-aeda64df.js";import{c as i}from"./dateUtils-d91f8443.js";import{P as r,h as d,i as c,j as x,d as o,k as m,l as p,m as g,C as h,n as u,o as j}from"./icons-61d3c260.js";import"./routing-3469486c.js";const f=t.lazy(()=>e(()=>import("./EventManagement-e91c59b2.js"),["assets/EventManagement-e91c59b2.js","assets/index-9ea7fdb9.js","assets/vendor-18e24f2a.js","assets/routing-3469486c.js","assets/supabase-c91fe37d.js","assets/icons-61d3c260.js","assets/index-0190e708.css","assets/storage-afc0bc2e.js","assets/dateUtils-d91f8443.js"])),b=t.lazy(()=>e(()=>import("./Statistics-e5f73eab.js"),["assets/Statistics-e5f73eab.js","assets/index-9ea7fdb9.js","assets/vendor-18e24f2a.js","assets/routing-3469486c.js","assets/supabase-c91fe37d.js","assets/icons-61d3c260.js","assets/index-0190e708.css","assets/storage-afc0bc2e.js","assets/dateUtils-d91f8443.js"])),N=t.lazy(()=>e(()=>import("./RateManagement-f8e76fa4.js"),["assets/RateManagement-f8e76fa4.js","assets/index-9ea7fdb9.js","assets/vendor-18e24f2a.js","assets/routing-3469486c.js","assets/supabase-c91fe37d.js","assets/icons-61d3c260.js","assets/index-0190e708.css","assets/storage-afc0bc2e.js","assets/dateUtils-d91f8443.js"])),y=t.lazy(()=>e(()=>import("./PointExchange-9ec4b1f0.js"),["assets/PointExchange-9ec4b1f0.js","assets/index-9ea7fdb9.js","assets/vendor-18e24f2a.js","assets/routing-3469486c.js","assets/supabase-c91fe37d.js","assets/icons-61d3c260.js","assets/index-0190e708.css","assets/storage-afc0bc2e.js","assets/dateUtils-d91f8443.js"])),v=t.lazy(()=>e(()=>import("./FamilyManagement-50ef6a36.js"),["assets/FamilyManagement-50ef6a36.js","assets/index-9ea7fdb9.js","assets/vendor-18e24f2a.js","assets/routing-3469486c.js","assets/supabase-c91fe37d.js","assets/icons-61d3c260.js","assets/index-0190e708.css"])),w=()=>{const{user:e}=s(),[t,w]=a.useState([]),[C,E]=a.useState([]),[I,_]=a.useState([]),[T,S]=a.useState({}),[D,P]=a.useState(!1),[A,R]=a.useState(""),[z,L]=a.useState("tasks"),[O,V]=a.useState(!0),[$,q]=a.useState(null),M=e=>{L(e),"family"===z&&"family"!==e&&U()};a.useEffect(()=>{(null==e?void 0:e.familyId)&&U()},[null==e?void 0:e.familyId]);const U=async()=>{if(null==e?void 0:e.familyId)try{V(!0),q(null);const[s,l,t,a]=await Promise.all([n.getTasks(e.familyId),n.getTaskCompletions(e.familyId),n.getUsers(e.familyId),n.getPointTransactions(e.familyId)]);w(s),E(l.filter(e=>"PENDING"===e.status));const i=t.filter(e=>"CHILD"===e.role);_(i);const r={};i.forEach(e=>{const s=a.filter(s=>s.userId===e.id),l=s.filter(e=>"EARNED"===e.type).reduce((e,s)=>e+s.amount,0),t=s.filter(e=>"EXCHANGED"===e.type).reduce((e,s)=>e+s.amount,0);r[e.id]=l-t}),S(r)}catch(s){q("データベースの初期設定が必要です。Supabaseでdatabase-schema.sqlを実行してください。")}finally{V(!1)}},F=async(s,l)=>{if(null==e?void 0:e.familyId)try{const a=C.find(e=>e.id===s);if(!a)return;if(await n.updateTaskCompletion(s,{status:l?"APPROVED":"REJECTED",approvedAt:new Date}),l){const s=t.find(e=>e.id===a.taskId);s&&await n.createPointTransaction({userId:a.childId,type:"EARNED",amount:s.points,description:`タスク完了: ${s.title}`,createdAt:new Date},e.familyId)}await U()}catch(a){q("承認処理に失敗しました")}},G=e=>{const s=I.find(s=>s.id===e);return(null==s?void 0:s.name)||"不明"},H=e=>{const s=t.find(s=>s.id===e);return(null==s?void 0:s.title)||"不明なタスク"},B=async s=>{if(null==e?void 0:e.familyId)if((e=>!C.some(s=>s.taskId===e))(s)){if(confirm("このタスクを削除してもよろしいですか？"))try{await n.deleteTask(s),await U()}catch(l){q("タスクの削除に失敗しました")}}else alert("子供が実行済みのタスクは削除できません。")},J=e=>C.filter(s=>s.taskId===e);a.useEffect(()=>{I.length>0&&!A&&R("all")},[I,A]);const X="all"===A?t:"general"===A?t.filter(e=>!e.assignedTo):(Y=A,t.filter(e=>e.assignedTo===Y));var Y;const{notExecuted:K,executed:Q}=(e=>{const s=[],l=[];return e.forEach(e=>{0===J(e.id).length?s.push(e):l.push(e)}),{notExecuted:s,executed:l}})(X);return O?l.jsx("div",{className:"flex items-center justify-center h-64",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-purple-500 border-t-transparent mx-auto mb-4"}),l.jsx("p",{className:"text-purple-600 text-lg font-medium",children:"データを読み込み中..."})]})}):$?l.jsxs("div",{className:"text-center py-8",children:[l.jsx("p",{className:"text-red-600 text-lg mb-4",children:$}),l.jsx("button",{onClick:U,className:"btn-primary",children:"再読み込み"})]}):l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[l.jsx("h2",{className:"text-3xl font-bold text-purple-800",children:"👨‍👩‍👧‍👦 保護者ダッシュボード"}),"tasks"===z&&l.jsxs("button",{onClick:()=>P(!0),className:"btn-primary flex items-center gap-2",children:[l.jsx(r,{className:"w-5 h-5"}),"✨ 新しいクエスト"]})]}),l.jsxs("div",{className:"mb-6",children:[l.jsx("div",{className:"md:hidden",children:l.jsxs("select",{value:z,onChange:e=>M(e.target.value),className:"w-full p-4 bg-white border-2 border-purple-300 rounded-2xl font-bold text-purple-800 text-lg shadow-lg focus:ring-4 focus:ring-purple-200 focus:border-purple-500",children:[l.jsx("option",{value:"tasks",children:"🎯 クエスト管理"}),l.jsx("option",{value:"events",children:"🎉 イベント管理"}),l.jsx("option",{value:"statistics",children:"📊 統計・レポート"}),l.jsx("option",{value:"rates",children:"⚙️ レート設定"}),l.jsx("option",{value:"exchange",children:"💰 ポイント交換"}),l.jsx("option",{value:"family",children:"👨‍👩‍👧‍👦 家族管理"})]})}),l.jsxs("div",{className:"hidden md:flex gap-2 lg:gap-4 flex-wrap",children:[l.jsxs("button",{onClick:()=>M("tasks"),className:"px-4 lg:px-6 py-3 rounded-full font-bold transition-all flex items-center gap-2 text-sm lg:text-base "+("tasks"===z?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:[l.jsx(d,{className:"w-4 h-4 lg:w-5 lg:h-5"}),l.jsx("span",{className:"hidden lg:inline",children:"🎯 クエスト管理"}),l.jsx("span",{className:"lg:hidden",children:"🎯 クエスト"})]}),l.jsxs("button",{onClick:()=>M("events"),className:"px-4 lg:px-6 py-3 rounded-full font-bold transition-all flex items-center gap-2 text-sm lg:text-base "+("events"===z?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:[l.jsx(c,{className:"w-4 h-4 lg:w-5 lg:h-5"}),l.jsx("span",{className:"hidden lg:inline",children:"🎉 イベント管理"}),l.jsx("span",{className:"lg:hidden",children:"🎉 イベント"})]}),l.jsxs("button",{onClick:()=>M("statistics"),className:"px-4 lg:px-6 py-3 rounded-full font-bold transition-all flex items-center gap-2 text-sm lg:text-base "+("statistics"===z?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:[l.jsx(x,{className:"w-4 h-4 lg:w-5 lg:h-5"}),l.jsx("span",{className:"hidden lg:inline",children:"📊 統計・レポート"}),l.jsx("span",{className:"lg:hidden",children:"📊 統計"})]}),l.jsxs("button",{onClick:()=>M("rates"),className:"px-4 lg:px-6 py-3 rounded-full font-bold transition-all flex items-center gap-2 text-sm lg:text-base "+("rates"===z?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:[l.jsx(o,{className:"w-4 h-4 lg:w-5 lg:h-5"}),l.jsx("span",{className:"hidden lg:inline",children:"⚙️ レート設定"}),l.jsx("span",{className:"lg:hidden",children:"⚙️ レート"})]}),l.jsxs("button",{onClick:()=>M("exchange"),className:"px-4 lg:px-6 py-3 rounded-full font-bold transition-all flex items-center gap-2 text-sm lg:text-base "+("exchange"===z?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:[l.jsx(m,{className:"w-4 h-4 lg:w-5 lg:h-5"}),l.jsx("span",{className:"hidden lg:inline",children:"💰 ポイント交換"}),l.jsx("span",{className:"lg:hidden",children:"💰 ポイント"})]}),l.jsxs("button",{onClick:()=>M("family"),className:"px-4 lg:px-6 py-3 rounded-full font-bold transition-all flex items-center gap-2 text-sm lg:text-base "+("family"===z?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:[l.jsx(p,{className:"w-4 h-4 lg:w-5 lg:h-5"}),l.jsx("span",{className:"hidden lg:inline",children:"👨‍👩‍👧‍👦 家族管理"}),l.jsx("span",{className:"lg:hidden",children:"👨‍👩‍👧‍👦 家族"})]})]})]}),"events"===z?l.jsx(a.Suspense,{fallback:l.jsx("div",{className:"text-center py-8",children:"イベント管理を読み込み中..."}),children:l.jsx(f,{children:I})}):"statistics"===z?l.jsx(a.Suspense,{fallback:l.jsx("div",{className:"text-center py-8",children:"統計データを読み込み中..."}),children:l.jsx(b,{children:I})}):"rates"===z?l.jsx(a.Suspense,{fallback:l.jsx("div",{className:"text-center py-8",children:"レート設定を読み込み中..."}),children:l.jsx(N,{})}):"exchange"===z?l.jsx(a.Suspense,{fallback:l.jsx("div",{className:"text-center py-8",children:"ポイント交換を読み込み中..."}),children:l.jsx(y,{children:I})}):"family"===z?l.jsx(a.Suspense,{fallback:l.jsx("div",{className:"text-center py-8",children:"家族管理を読み込み中..."}),children:l.jsx(v,{onDataUpdate:U})}):l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"card",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[l.jsx(p,{className:"w-8 h-8 text-purple-500"}),l.jsx("h3",{className:"text-xl font-bold text-purple-700",children:"👧 お子様の状況"})]}),l.jsx("div",{className:"space-y-3",children:I.map(e=>l.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-pink-50 to-purple-50 rounded-2xl border-2 border-pink-200",children:[l.jsxs("div",{children:[l.jsx("p",{className:"font-bold text-purple-800",children:e.name}),l.jsx("p",{className:"text-sm text-purple-600",children:e.birthDate?`${i(e.birthDate)}歳`:`${e.age||0}歳`})]}),l.jsxs("div",{className:"text-right",children:[l.jsxs("p",{className:"font-bold text-2xl text-purple-600",children:[T[e.id]||0,"pt"]}),l.jsx("p",{className:"text-xs text-purple-500",children:"保有ポイント"})]})]},e.id))})]}),l.jsxs("div",{className:"card",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[l.jsx(g,{className:"w-8 h-8 text-yellow-500 animate-pulse"}),l.jsx("h3",{className:"text-xl font-bold text-yellow-700",children:"⏰ 承認待ち"})]}),l.jsxs("div",{className:"space-y-3",children:[C.slice(0,4).map(e=>l.jsxs("div",{className:"p-4 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-2xl border-2 border-yellow-300",children:[l.jsx("p",{className:"font-bold text-orange-800 mb-1",children:H(e.taskId)}),l.jsxs("p",{className:"text-sm text-orange-600 mb-3",children:[G(e.childId),"さん"]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsxs("button",{onClick:()=>F(e.id,!0),className:"flex-1 bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-3 rounded-full flex items-center justify-center gap-2 transition-all",children:[l.jsx(h,{className:"w-4 h-4"}),"✅ 承認"]}),l.jsxs("button",{onClick:()=>F(e.id,!1),className:"flex-1 bg-red-500 hover:bg-red-600 text-white font-medium py-2 px-3 rounded-full flex items-center justify-center gap-2 transition-all",children:[l.jsx(u,{className:"w-4 h-4"}),"❌ 却下"]})]})]},e.id)),0===C.length&&l.jsx("div",{className:"text-center py-6",children:l.jsx("p",{className:"text-yellow-600",children:"📝 承認待ちのクエストはありません"})})]})]})]}),l.jsxs("div",{className:"card",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[l.jsx(d,{className:"w-8 h-8 text-green-500"}),l.jsx("h3",{className:"text-xl font-bold text-green-700",children:"🎯 クエスト管理"})]}),l.jsxs("div",{className:"mb-6",children:[l.jsx("div",{className:"md:hidden",children:l.jsxs("select",{value:A,onChange:e=>R(e.target.value),className:"w-full p-3 bg-white border-2 border-purple-300 rounded-xl font-medium text-purple-800 shadow-md",children:[l.jsx("option",{value:"all",children:"👨‍👩‍👧‍👦 全体表示"}),l.jsx("option",{value:"general",children:"👥 全員対象"}),I.map(e=>l.jsxs("option",{value:e.id,children:[e.name,"さん"]},e.id))]})}),l.jsxs("div",{className:"hidden md:flex flex-wrap gap-2",children:[l.jsx("button",{onClick:()=>R("all"),className:"px-3 lg:px-4 py-2 rounded-full font-medium transition-all text-sm lg:text-base "+("all"===A?"bg-purple-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"👨‍👩‍👧‍👦 全体表示"}),l.jsx("button",{onClick:()=>R("general"),className:"px-3 lg:px-4 py-2 rounded-full font-medium transition-all text-sm lg:text-base "+("general"===A?"bg-purple-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"👥 全員対象"}),I.map(e=>l.jsxs("button",{onClick:()=>R(e.id),className:"px-3 lg:px-4 py-2 rounded-full font-medium transition-all text-sm lg:text-base "+(A===e.id?"bg-purple-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:[e.name,"さん"]},e.id))]})]}),l.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4 lg:gap-6",children:[l.jsxs("div",{children:[l.jsxs("h4",{className:"text-lg font-bold text-blue-700 mb-4 flex items-center gap-2",children:["🎯 実行前クエスト (",K.length,"件)"]}),l.jsxs("div",{className:"space-y-3",children:[K.map(e=>{const s=e.assignedTo?I.find(s=>s.id===e.assignedTo):null;return l.jsxs("div",{className:"p-3 lg:p-4 bg-gradient-to-r from-blue-50 to-cyan-50 rounded-2xl border-2 border-blue-200 hover:shadow-lg transition-all",children:[l.jsxs("div",{className:"flex items-start justify-between mb-2",children:[l.jsx("h5",{className:"font-bold text-blue-800 text-sm lg:text-base leading-tight",children:e.title}),l.jsxs("span",{className:"text-sm lg:text-lg font-bold text-purple-600 bg-white px-2 lg:px-3 py-1 rounded-full border-2 border-purple-300 whitespace-nowrap ml-2",children:[e.points,"pt"]})]}),l.jsxs("div",{className:"flex items-center gap-1 lg:gap-2 mb-2 flex-wrap",children:[l.jsx("span",{className:"text-xs px-2 lg:px-3 py-1 bg-blue-200 text-blue-700 rounded-full",children:e.category}),l.jsx("span",{className:"text-xs px-2 lg:px-3 py-1 bg-purple-200 text-purple-700 rounded-full",children:s?s.name:"全員"})]}),l.jsx("p",{className:"text-xs lg:text-sm text-blue-700 mb-3 leading-relaxed",children:e.description}),l.jsx("div",{className:"flex justify-end",children:l.jsx("button",{onClick:()=>B(e.id),className:"p-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-full transition-colors touch-manipulation",title:"クエストを削除",children:l.jsx(j,{className:"w-4 h-4"})})})]},e.id)}),0===K.length&&l.jsx("div",{className:"text-center py-8",children:l.jsx("p",{className:"text-blue-600",children:"🎉 実行前のクエストはありません"})})]})]}),l.jsxs("div",{children:[l.jsxs("h4",{className:"text-lg font-bold text-green-700 mb-4 flex items-center gap-2",children:["✅ 実行済みクエスト (",Q.length,"件)"]}),l.jsxs("div",{className:"space-y-3",children:[Q.map(e=>{const s=e.assignedTo?I.find(s=>s.id===e.assignedTo):null,t=J(e.id);return l.jsxs("div",{className:"p-3 lg:p-4 bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl border-2 border-green-200",children:[l.jsxs("div",{className:"flex items-start justify-between mb-2",children:[l.jsx("h5",{className:"font-bold text-green-800 text-sm lg:text-base leading-tight",children:e.title}),l.jsxs("span",{className:"text-sm lg:text-lg font-bold text-purple-600 bg-white px-2 lg:px-3 py-1 rounded-full border-2 border-purple-300 whitespace-nowrap ml-2",children:[e.points,"pt"]})]}),l.jsxs("div",{className:"flex items-center gap-1 lg:gap-2 mb-2 flex-wrap",children:[l.jsx("span",{className:"text-xs px-2 lg:px-3 py-1 bg-green-200 text-green-700 rounded-full",children:e.category}),l.jsx("span",{className:"text-xs px-2 lg:px-3 py-1 bg-purple-200 text-purple-700 rounded-full",children:s?s.name:"全員"}),l.jsxs("span",{className:"text-xs px-2 lg:px-3 py-1 bg-emerald-200 text-emerald-700 rounded-full",children:[t.length,"回実行"]})]}),l.jsx("p",{className:"text-xs lg:text-sm text-green-700 leading-relaxed",children:e.description})]},e.id)}),0===Q.length&&l.jsx("div",{className:"text-center py-8",children:l.jsx("p",{className:"text-green-600",children:"📝 実行済みのクエストはありません"})})]})]})]})]}),D&&l.jsx(k,{onClose:()=>P(!1),onSave:U,user:e,children:I})]})]})},k=({onClose:e,onSave:s,user:t,children:r})=>{const[d,c]=a.useState({title:"",description:"",points:10,category:"家事",difficulty:"EASY",isRecurring:!1,assignedTo:""});return l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:l.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[l.jsx("h3",{className:"text-lg font-semibold mb-4",children:"新しいタスクを作成"}),l.jsxs("form",{onSubmit:async l=>{if(l.preventDefault(),null==t?void 0:t.familyId)try{await n.createTask({...d,assignedTo:d.assignedTo||void 0,createdBy:t.id},t.familyId),s(),e()}catch(a){alert("タスクの作成に失敗しました")}},className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"タスク名"}),l.jsx("input",{type:"text",value:d.title,onChange:e=>c({...d,title:e.target.value}),className:"input-field",required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"説明"}),l.jsx("textarea",{value:d.description,onChange:e=>c({...d,description:e.target.value}),className:"input-field",rows:3})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"対象のお子様"}),l.jsxs("select",{value:d.assignedTo,onChange:e=>c({...d,assignedTo:e.target.value}),className:"input-field",children:[l.jsx("option",{value:"",children:"全員"}),r.map(e=>l.jsxs("option",{value:e.id,children:[e.name," (",e.birthDate?`${i(e.birthDate)}歳`:`${e.age||0}歳`,")"]},e.id))]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ポイント"}),l.jsx("input",{type:"number",value:d.points,onChange:e=>c({...d,points:parseInt(e.target.value)}),className:"input-field",min:"1",required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"カテゴリ"}),l.jsxs("select",{value:d.category,onChange:e=>c({...d,category:e.target.value}),className:"input-field",children:[l.jsx("option",{value:"家事",children:"家事"}),l.jsx("option",{value:"勉強",children:"勉強"}),l.jsx("option",{value:"運動",children:"運動"}),l.jsx("option",{value:"その他",children:"その他"})]})]})]}),l.jsxs("div",{className:"flex justify-end gap-3",children:[l.jsx("button",{type:"button",onClick:e,className:"btn-secondary",children:"キャンセル"}),l.jsx("button",{type:"submit",className:"btn-primary",children:"作成"})]})]})]})})};export{w as default};
