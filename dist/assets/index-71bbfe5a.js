import{r as e,a as t,b as s}from"./vendor-18e24f2a.js";import{B as n}from"./routing-3469486c.js";import{c as a,_ as r}from"./supabase-c91fe37d.js";import{A as i,U as o,M as l,L as c,a as d,b as m,B as u,X as p,T as h,G as x,C as f,S as w,E as g,c as b,d as v,e as y,f as j,R as N,g as k,D as E}from"./icons-61d3c260.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var C={exports:{}},S={},P=e,I=Symbol.for("react.element"),T=Symbol.for("react.fragment"),_=Object.prototype.hasOwnProperty,A=P.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,O={key:!0,ref:!0,__self:!0,__source:!0};function L(e,t,s){var n,a={},r=null,i=null;for(n in void 0!==s&&(r=""+s),void 0!==t.key&&(r=""+t.key),void 0!==t.ref&&(i=t.ref),t)_.call(t,n)&&!O.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===a[n]&&(a[n]=t[n]);return{$$typeof:I,type:e,key:r,ref:i,props:a,_owner:A.current}}S.Fragment=T,S.jsx=L,S.jsxs=L,C.exports=S;var R=C.exports,D=Object.defineProperty,U=(e,t,s)=>(((e,t,s)=>{t in e?D(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);if(window.Promise||(window.Promise=class{constructor(e){U(this,"state","pending"),U(this,"value"),U(this,"handlers",[]);try{e(this.resolve.bind(this),this.reject.bind(this))}catch(t){this.reject(t)}}resolve(e){"pending"===this.state&&(this.state="fulfilled",this.value=e,this.handlers.forEach(e=>this.handle(e)),this.handlers=[])}reject(e){"pending"===this.state&&(this.state="rejected",this.value=e,this.handlers.forEach(e=>this.handle(e)),this.handlers=[])}handle(e){if("pending"===this.state)this.handlers.push(e);else if("fulfilled"===this.state&&e.onFulfilled)try{const t=e.onFulfilled(this.value);e.resolve(t)}catch(t){e.reject(t)}else if("rejected"===this.state&&e.onRejected)try{const t=e.onRejected(this.value);e.resolve(t)}catch(t){e.reject(t)}}then(e,t){return new window.Promise((s,n)=>{this.handle({onFulfilled:e,onRejected:t,resolve:s,reject:n})})}catch(e){return this.then(void 0,e)}static resolve(e){return new window.Promise(t=>t(e))}static reject(e){return new window.Promise((t,s)=>s(e))}static all(e){return new window.Promise((t,s)=>{if(0===e.length)return void t([]);const n=[];let a=0;e.forEach((r,i)=>{window.Promise.resolve(r).then(s=>{n[i]=s,a++,a===e.length&&t(n)}).catch(s)})})}}),window.fetch||(window.fetch=function(e,t={}){return new Promise((s,n)=>{const a=new XMLHttpRequest;a.open(t.method||"GET",e),t.headers&&Object.keys(t.headers).forEach(e=>{a.setRequestHeader(e,t.headers[e])}),a.onload=function(){const e={status:a.status,statusText:a.statusText,ok:a.status>=200&&a.status<300,headers:new Map,text:()=>Promise.resolve(a.responseText),json:()=>Promise.resolve(JSON.parse(a.responseText)),blob:()=>Promise.resolve(new Blob([a.response])),arrayBuffer:()=>Promise.resolve(a.response)};s(e)},a.onerror=()=>n(new Error("Network Error")),a.ontimeout=()=>n(new Error("Request Timeout")),t.timeout&&(a.timeout=t.timeout),a.send(t.body)})}),Object.assign||(Object.assign=function(e,...t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");const s=Object(e);for(let n=0;n<t.length;n++){const e=t[n];if(null!=e)for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(s[t]=e[t])}return s}),Array.from||(Array.from=function(e,t,s){const n=Object(e),a=parseInt(n.length)||0,r=new Array(a);for(let i=0;i<a;i++){const e=n[i];r[i]=t?t.call(s,e,i):e}return r}),Array.prototype.includes||(Array.prototype.includes=function(e,t){const s=Object(this),n=parseInt(s.length)||0;if(0===n)return!1;const a=parseInt((null==t?void 0:t.toString())||"0")||0;let r=a>=0?a:Math.max(n+a,0);for(;r<n;){if(s[r]===e)return!0;r++}return!1}),String.prototype.includes||(String.prototype.includes=function(e,t){return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&-1!==this.indexOf(e,t)}),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e}),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){return(void 0===t||t>this.length)&&(t=this.length),this.substring(t-e.length,t)===e}),window.Map||(window.Map=class{constructor(){U(this,"keys",[]),U(this,"values",[])}set(e,t){const s=this.keys.indexOf(e);return-1!==s?this.values[s]=t:(this.keys.push(e),this.values.push(t)),this}get(e){const t=this.keys.indexOf(e);return-1!==t?this.values[t]:void 0}has(e){return-1!==this.keys.indexOf(e)}delete(e){const t=this.keys.indexOf(e);return-1!==t&&(this.keys.splice(t,1),this.values.splice(t,1),!0)}clear(){this.keys=[],this.values=[]}get size(){return this.keys.length}}),window.Set||(window.Set=class{constructor(){U(this,"values",[])}add(e){return this.has(e)||this.values.push(e),this}has(e){return-1!==this.values.indexOf(e)}delete(e){const t=this.values.indexOf(e);return-1!==t&&(this.values.splice(t,1),!0)}clear(){this.values=[]}get size(){return this.values.length}}),window.CustomEvent||(window.CustomEvent=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:null};const s=document.createEvent("CustomEvent");return s.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),s}),window.requestAnimationFrame||(window.requestAnimationFrame=function(e){return window.setTimeout(e,1e3/60)}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)}),window.console||(window.console={log:()=>{},error:()=>{},warn:()=>{},info:()=>{},debug:()=>{}}),!window.performance||!window.performance.now){const e=Date.now();window.performance||(window.performance={}),window.performance.now=function(){return Date.now()-e}}const z=()=>{const e={flexbox:!1,grid:!1,cssVariables:!1,webp:!1,avif:!1,touchEvents:!1,geolocation:!1,localStorage:!1,sessionStorage:!1,indexedDB:!1,webWorkers:!1,serviceWorker:!1,pushNotifications:!1,webRTC:!1,mediaDevices:!1,promises:!!window.Promise,fetch:!!window.fetch,es6Classes:!0,arrow:!0},t=document.createElement("div").style;try{t.display="flex",e.flexbox="flex"===t.display}catch(n){}try{t.display="grid",e.grid="grid"===t.display}catch(n){}try{t.setProperty("--test","test"),e.cssVariables="test"===t.getPropertyValue("--test")}catch(n){}e.touchEvents="ontouchstart"in window||navigator.maxTouchPoints>0,e.geolocation="geolocation"in navigator,e.localStorage="localStorage"in window&&null!==window.localStorage,e.sessionStorage="sessionStorage"in window&&null!==window.sessionStorage,e.indexedDB="indexedDB"in window,e.webWorkers="Worker"in window,e.serviceWorker="serviceWorker"in navigator,e.pushNotifications="PushManager"in window&&"Notification"in window,e.webRTC="RTCPeerConnection"in window,e.mediaDevices="mediaDevices"in navigator;const s=document.createElement("canvas");return s.getContext&&s.getContext("2d")&&(s.width=1,s.height=1,e.webp=0===s.toDataURL("image/webp").indexOf("data:image/webp"),e.avif=0===s.toDataURL("image/avif").indexOf("data:image/avif")),e};var q=Object.defineProperty,F=(e,t,s)=>(((e,t,s)=>{t in e?q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);new class{constructor(){F(this,"currentVersion"),F(this,"checkInterval",3e4),F(this,"isChecking",!1),this.currentVersion={}.VITE_APP_VERSION||"1.0.0",this.startVersionCheck()}async checkForUpdates(){if(this.isChecking)return!1;try{this.isChecking=!0;const e=await fetch("/version.json?"+Date.now(),{cache:"no-cache"});if(!e.ok)return!1;return(await e.json()).version!==this.currentVersion}catch(e){return!1}finally{this.isChecking=!1}}startVersionCheck(){const e=()=>{document.hidden||this.checkForUpdates().then(e=>{e&&this.notifyUpdate()})};document.addEventListener("visibilitychange",e),setInterval(e,this.checkInterval)}notifyUpdate(){this.showUpdateNotification()}showUpdateNotification(){if(document.querySelector(".app-update-notification"))return;const e=document.createElement("div");e.className="app-update-notification",e.style.cssText="\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n      padding: 16px 24px;\n      border-radius: 12px;\n      box-shadow: 0 8px 32px rgba(0,0,0,0.3);\n      z-index: 10000;\n      font-family: system-ui, -apple-system, sans-serif;\n      max-width: 320px;\n      animation: slideIn 0.3s ease-out;\n    ";const t=document.createElement("div"),s=document.createElement("div");s.style.cssText="display: flex; align-items: center; gap: 12px;";const n=document.createElement("div");n.style.cssText="font-size: 24px;",n.textContent="🎉";const a=document.createElement("div"),r=document.createElement("div");r.style.cssText="font-weight: 600; margin-bottom: 4px;",r.textContent="新しいバージョンが利用可能です";const i=document.createElement("div");i.style.cssText="font-size: 14px; opacity: 0.9;",i.textContent="より良い体験のためにアップデートしませんか？",a.appendChild(r),a.appendChild(i),s.appendChild(n),s.appendChild(a);const o=document.createElement("div");o.style.cssText="margin-top: 12px; display: flex; gap: 8px;";const l=document.createElement("button");l.style.cssText="\n      background: white;\n      color: #667eea;\n      border: none;\n      padding: 8px 16px;\n      border-radius: 6px;\n      font-weight: 600;\n      cursor: pointer;\n      font-size: 14px;\n    ",l.textContent="アップデート",l.addEventListener("click",async()=>{await this.handleAppUpdate()});const c=document.createElement("button");if(c.style.cssText="\n      background: transparent;\n      color: white;\n      border: 1px solid rgba(255,255,255,0.3);\n      padding: 8px 16px;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 14px;\n    ",c.textContent="後で",c.addEventListener("click",()=>{e.remove()}),o.appendChild(l),o.appendChild(c),t.appendChild(s),t.appendChild(o),e.appendChild(t),!document.querySelector("#update-notification-styles")){const e=document.createElement("style");e.id="update-notification-styles",e.textContent="\n        @keyframes slideIn {\n          from { transform: translateX(100%); opacity: 0; }\n          to { transform: translateX(0); opacity: 1; }\n        }\n      ",document.head.appendChild(e)}document.body.appendChild(e),setTimeout(()=>{e.parentNode&&(e.style.animation="slideIn 0.3s ease-out reverse",setTimeout(()=>e.remove(),300))},1e4)}async clearCaches(){if("caches"in window){const e=await caches.keys();await Promise.all(e.map(e=>caches.delete(e)))}}async handleAppUpdate(){try{const e=document.querySelector(".app-update-notification");if(e){const t=e.querySelector("button");t&&(t.textContent="更新中...",t.disabled=!0)}if("serviceWorker"in navigator){const e=await navigator.serviceWorker.getRegistrations();for(const t of e)t.waiting&&t.waiting.postMessage({type:"SKIP_WAITING"}),await t.update()}await this.clearCaches();const t=[];for(let s=0;s<localStorage.length;s++){const e=localStorage.key(s);!e||e.includes("user")||e.includes("auth")||e.includes("settings")||t.push(e)}t.forEach(e=>localStorage.removeItem(e)),window.location.href=window.location.origin+window.location.pathname+"?updated="+Date.now()}catch(e){window.location.reload(!0)}}};var M={},W=t;M.createRoot=W.createRoot,M.hydrateRoot=W.hydrateRoot;const $=a("https://adtsbzzizbwjiqrkqofp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFkdHNienppemJ3amlxcmtxb2ZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA0ODAyNzYsImV4cCI6MjA2NjA1NjI3Nn0.Fzqt6WBr9vq17jV8hDGm5Nw2chIC2Yern7ePfQ5Sq-4",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),V=e.createContext(void 0),B=({children:t})=>{const[s,n]=e.useState(null),[a,r]=e.useState(null),[i,o]=e.useState(!0);e.useEffect(()=>{l();const{data:{subscription:e}}=$.auth.onAuthStateChange(async(e,t)=>{if(null==t?void 0:t.user){if(r(t.user),"USER_UPDATED"===e&&t.user.email&&(null==s?void 0:s.email)!==t.user.email)try{const{error:e}=await $.from("users").update({email:t.user.email}).eq("id",t.user.id)}catch(a){}await c(t.user.id)}else r(null),n(null);o(!1)});return()=>{e.unsubscribe()}},[]);const l=async()=>{try{const e=new Promise((e,t)=>setTimeout(()=>t(new Error("Session timeout")),3e4)),t=$.auth.getSession(),{data:{session:s},error:n}=await Promise.race([t,e]);if(n)return void o(!1);(null==s?void 0:s.user)&&(r(s.user),await c(s.user.id))}catch(e){e instanceof Error&&e.message}finally{o(!1)}},c=async e=>{var t;try{const{data:s,error:a}=await $.from("users").select("\n          id,\n          name,\n          role,\n          family_id,\n          birth_date,\n          age,\n          created_at,\n          families!inner(id, name)\n        ").eq("id",e).single();if(a)return;if(s){const{data:e}=await $.auth.getUser(),a={id:s.id,name:s.name,email:(null==(t=null==e?void 0:e.user)?void 0:t.email)||"",role:s.role,familyId:s.family_id,birthDate:s.birth_date?new Date(s.birth_date):void 0,age:s.age,createdAt:new Date(s.created_at)};n(a)}}catch(s){}};return R.jsx(V.Provider,{value:{user:s,supabaseUser:a,login:async(e,t)=>{try{const{error:s}=await $.auth.signInWithPassword({email:e,password:t});if(s)throw s}catch(s){throw s}},logout:async()=>{try{const{error:e}=await $.auth.signOut();if(e)throw e}catch(e){throw e}},register:async(e,t,s,n)=>{try{const{data:a,error:r}=await $.auth.signUp({email:e,password:t});if(r)throw r;if(a.user){let e;if("PARENT"===n){const{data:t,error:n}=await $.from("families").insert({name:`${s}さんの家族`}).select().single();if(n)throw n;e=t.id}else{const{data:t,error:s}=await $.from("families").select("id").limit(1).single();if(s)throw s;e=t.id}const{error:t}=await $.from("users").insert({id:a.user.id,family_id:e,name:s,role:n});if(t)throw t}}catch(a){throw a}},updateUser:e=>{s&&n({...s,...e})},loading:i},children:t})},Y=()=>{const t=e.useContext(V);if(void 0===t)throw new Error("useAuth must be used within an AuthProvider");return t},H=()=>{if("Notification"in window&&"granted"===Notification.permission){const e=new Notification("アプリの更新が利用可能です",{body:"タップしてページを再読み込みし、最新バージョンを取得してください",icon:"/pwa-192x192.png",badge:"/pwa-64x64.png",requireInteraction:!0});e.onclick=()=>{window.location.reload(),e.close()}}},X=e.createContext(void 0),J=({children:t})=>{const{user:s}=Y(),[n,a]=e.useState([]),r=e=>{const t={...e,id:Math.random().toString(36).substr(2,9),createdAt:new Date,read:!1};var s,n,r;a(e=>[t,...e]),s=e.title,n=e.message,"Notification"in window&&"granted"===Notification.permission&&new Notification(s,{body:n,icon:r||"/pwa-192x192.png",badge:"/pwa-64x64.png"})},i=n.filter(e=>!e.read).length;e.useEffect(()=>{if(!(null==s?void 0:s.familyId))return;const e=$.channel("task_completions").on("postgres_changes",{event:"INSERT",schema:"public",table:"task_completions",filter:`family_id=eq.${s.familyId}`},e=>{"PARENT"===s.role&&e.new.child_id!==s.id&&r({title:"🎯 タスク完了報告",message:"お子様がタスクを完了しました！承認をお待ちしています。",type:"task_completed",data:e.new})}).subscribe(),t=$.channel("task_approvals").on("postgres_changes",{event:"UPDATE",schema:"public",table:"task_completions",filter:`child_id=eq.${s.id}`},e=>{if("CHILD"===s.role){const t=e.new.status;"APPROVED"===t?r({title:"✅ タスク承認",message:"タスクが承認されました！ポイントを獲得しました。",type:"task_approved",data:e.new}):"REJECTED"===t&&r({title:"❌ タスク却下",message:"タスクが却下されました。もう一度挑戦してみましょう。",type:"task_rejected",data:e.new})}}).subscribe(),n=$.channel("new_tasks").on("postgres_changes",{event:"INSERT",schema:"public",table:"tasks",filter:`family_id=eq.${s.familyId}`},e=>{"CHILD"===s.role&&(e.new.assigned_to&&e.new.assigned_to!==s.id||r({title:"🆕 新しいクエスト",message:`新しいクエスト「${e.new.title}」が追加されました！`,type:"new_task",data:e.new}))}).subscribe(),a=$.channel("point_transactions").on("postgres_changes",{event:"INSERT",schema:"public",table:"point_transactions",filter:`user_id=eq.${s.id}`},e=>{"CHILD"===s.role&&"EARNED"===e.new.type&&r({title:"💎 ポイント獲得",message:`${e.new.amount}ポイントを獲得しました！`,type:"points_awarded",data:e.new})}).subscribe();return()=>{e.unsubscribe(),t.unsubscribe(),n.unsubscribe(),a.unsubscribe()}},[null==s?void 0:s.familyId,null==s?void 0:s.id,null==s?void 0:s.role]);const o={notifications:n,unreadCount:i,markAsRead:e=>{a(t=>t.map(t=>t.id===e?{...t,read:!0}:t))},markAllAsRead:()=>{a(e=>e.map(e=>({...e,read:!0})))},addNotification:r,clearNotifications:()=>{a([])}};return R.jsx(X.Provider,{value:o,children:t})},G=()=>{const[t,s]=e.useState(!0),[n,a]=e.useState({email:"",password:"",name:"",role:"PARENT"}),[r,u]=e.useState(""),[p,h]=e.useState(!1),{login:x,register:f}=Y();return R.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-400 via-pink-500 to-red-500 flex items-center justify-center p-4",children:R.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl p-8 w-full max-w-md",children:[R.jsxs("div",{className:"text-center mb-8",children:[R.jsx("div",{className:"text-6xl mb-4",children:"🏠"}),R.jsx("h1",{className:"text-3xl font-bold text-purple-800 mb-2",children:"おこづかいクエスト"}),R.jsx("p",{className:"text-purple-600",children:t?"ログインしてください":"新しいアカウントを作成"})]}),r&&R.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-3",children:[R.jsx(i,{className:"w-5 h-5 text-red-500"}),R.jsx("p",{className:"text-red-700 text-sm",children:r})]}),R.jsxs("form",{onSubmit:async e=>{e.preventDefault(),u(""),h(!0);try{t?await x(n.email,n.password):(await f(n.email,n.password,n.name,n.role),alert("アカウントが作成されました！ログインしてください。"),s(!0))}catch(a){u(a.message||"エラーが発生しました")}finally{h(!1)}},className:"space-y-6",children:[!t&&R.jsxs(R.Fragment,{children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"お名前"}),R.jsxs("div",{className:"relative",children:[R.jsx(o,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),R.jsx("input",{type:"text",value:n.name,onChange:e=>a({...n,name:e.target.value}),className:"input-field pl-10",placeholder:"山田太郎",required:!0})]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"役割"}),R.jsxs("select",{value:n.role,onChange:e=>a({...n,role:e.target.value}),className:"input-field",required:!0,children:[R.jsx("option",{value:"PARENT",children:"👨‍👩‍👧‍👦 保護者"}),R.jsx("option",{value:"CHILD",children:"🧒 子供"})]})]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"メールアドレス"}),R.jsxs("div",{className:"relative",children:[R.jsx(l,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),R.jsx("input",{type:"email",value:n.email,onChange:e=>a({...n,email:e.target.value}),className:"input-field pl-10",placeholder:"example@email.com",required:!0})]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"パスワード"}),R.jsxs("div",{className:"relative",children:[R.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),R.jsx("input",{type:"password",value:n.password,onChange:e=>a({...n,password:e.target.value}),className:"input-field pl-10",placeholder:"••••••••",minLength:6,required:!0})]}),!t&&R.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"6文字以上で入力してください"})]}),R.jsx("button",{type:"submit",disabled:p,className:"w-full py-3 px-4 rounded-2xl font-bold text-lg transition-all flex items-center justify-center gap-3 "+(p?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:shadow-lg"),children:p?"処理中...":t?R.jsxs(R.Fragment,{children:[R.jsx(d,{className:"w-5 h-5"}),"ログイン"]}):R.jsxs(R.Fragment,{children:[R.jsx(m,{className:"w-5 h-5"}),"アカウント作成"]})})]}),R.jsx("div",{className:"mt-6 text-center",children:R.jsx("button",{onClick:()=>{s(!t),a({email:"",password:"",name:"",role:"PARENT"}),u("")},className:"text-purple-600 hover:text-purple-800 text-sm font-medium",children:t?"アカウントをお持ちでない方はこちら":"すでにアカウントをお持ちの方はこちら"})})]})})},Z=()=>{const{notifications:t,unreadCount:s,markAsRead:n,markAllAsRead:a,clearNotifications:r}=(()=>{const t=e.useContext(X);if(!t)throw new Error("useNotifications must be used within NotificationProvider");return t})(),[o,l]=e.useState(!1),c=e=>{switch(e){case"task_completed":return R.jsx(h,{className:"w-5 h-5 text-blue-500"});case"task_approved":return R.jsx(f,{className:"w-5 h-5 text-green-500"});case"task_rejected":return R.jsx(i,{className:"w-5 h-5 text-red-500"});case"points_awarded":return R.jsx(x,{className:"w-5 h-5 text-purple-500"});case"new_task":return R.jsx(h,{className:"w-5 h-5 text-orange-500"});default:return R.jsx(u,{className:"w-5 h-5 text-gray-500"})}},d=e=>{const t=(new Date).getTime()-e.getTime(),s=Math.floor(t/6e4),n=Math.floor(t/36e5),a=Math.floor(t/864e5);return s<1?"たった今":s<60?`${s}分前`:n<24?`${n}時間前`:`${a}日前`};return R.jsxs("div",{className:"relative",children:[R.jsxs("button",{onClick:()=>l(!o),className:"relative p-2 text-gray-600 hover:text-purple-600 transition-colors",children:[R.jsx(u,{className:"w-6 h-6"}),s>0&&R.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold",children:s>9?"9+":s})]}),o&&R.jsxs(R.Fragment,{children:[R.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>l(!1)}),R.jsxs("div",{className:"absolute right-0 top-full mt-2 w-80 bg-white rounded-2xl shadow-2xl border border-gray-200 z-50 max-h-96 overflow-hidden",children:[R.jsx("div",{className:"p-4 border-b border-gray-100 bg-gradient-to-r from-purple-50 to-pink-50",children:R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("h3",{className:"font-bold text-gray-800 flex items-center gap-2",children:[R.jsx(u,{className:"w-5 h-5 text-purple-600"}),"通知"]}),R.jsxs("div",{className:"flex items-center gap-2",children:[s>0&&R.jsx("button",{onClick:a,className:"text-sm text-purple-600 hover:text-purple-800 font-medium",children:"すべて既読"}),R.jsx("button",{onClick:()=>l(!1),className:"p-1 text-gray-400 hover:text-gray-600",children:R.jsx(p,{className:"w-4 h-4"})})]})]})}),R.jsx("div",{className:"max-h-64 overflow-y-auto",children:0===t.length?R.jsxs("div",{className:"p-8 text-center text-gray-500",children:[R.jsx(u,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),R.jsx("p",{children:"通知はありません"})]}):t.map(e=>R.jsx("div",{onClick:()=>n(e.id),className:"p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 transition-colors "+(e.read?"":"bg-blue-50 border-l-4 border-l-blue-500"),children:R.jsxs("div",{className:"flex items-start gap-3",children:[c(e.type),R.jsxs("div",{className:"flex-1 min-w-0",children:[R.jsx("h4",{className:"font-medium text-sm "+(e.read?"text-gray-700":"text-gray-900"),children:e.title}),R.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.message}),R.jsx("p",{className:"text-xs text-gray-400 mt-2",children:d(e.createdAt)})]}),!e.read&&R.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2"})]})},e.id))}),t.length>0&&R.jsx("div",{className:"p-3 border-t border-gray-100 bg-gray-50",children:R.jsx("button",{onClick:r,className:"w-full text-sm text-gray-600 hover:text-gray-800 font-medium",children:"すべての通知を削除"})})]})]})]})},K=({onClose:t})=>{const{user:s,updateUser:n}=Y(),[a,r]=e.useState(!1),[d,m]=e.useState(null),[u,h]=e.useState(null),[x,v]=e.useState(!1),[y,j]=e.useState(!1),[N,k]=e.useState(!1),[E,C]=e.useState({email:(null==s?void 0:s.email)||"",name:(null==s?void 0:s.name)||"",currentPassword:"",newPassword:"",confirmPassword:""});return R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:R.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 rounded-3xl p-6 lg:p-8 w-full max-w-2xl border-4 border-purple-300 shadow-2xl max-h-[90vh] overflow-y-auto",children:[R.jsxs("div",{className:"flex items-center justify-between mb-6",children:[R.jsxs("h2",{className:"text-2xl lg:text-3xl font-bold text-purple-800 flex items-center gap-3",children:[R.jsx(o,{className:"w-8 h-8"}),"⚙️ アカウント設定"]}),R.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors",children:R.jsx(p,{className:"w-6 h-6"})})]}),d&&R.jsxs("div",{className:"mb-6 p-4 bg-green-50 border-2 border-green-200 rounded-2xl flex items-center gap-3",children:[R.jsx(f,{className:"w-6 h-6 text-green-600"}),R.jsx("p",{className:"text-green-800 font-medium",children:d})]}),u&&R.jsxs("div",{className:"mb-6 p-4 bg-red-50 border-2 border-red-200 rounded-2xl flex items-center gap-3",children:[R.jsx(i,{className:"w-6 h-6 text-red-600"}),R.jsx("p",{className:"text-red-800 font-medium",children:u})]}),R.jsxs("div",{className:"space-y-8",children:[R.jsxs("div",{className:"space-y-4",children:[R.jsxs("h3",{className:"text-xl font-bold text-purple-700 flex items-center gap-2",children:[R.jsx(o,{className:"w-6 h-6"}),"基本情報"]}),R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-2",children:"📝 お名前"}),R.jsxs("div",{className:"flex gap-3",children:[R.jsx("input",{type:"text",value:E.name,onChange:e=>C({...E,name:e.target.value}),className:"flex-1 input-field",placeholder:"お名前を入力"}),R.jsxs("button",{onClick:async()=>{if(E.name&&E.name!==(null==s?void 0:s.name)){r(!0),h(null),m(null);try{const{error:e}=await $.from("users").update({name:E.name}).eq("id",null==s?void 0:s.id);if(e)throw e;m("名前が正常に更新されました"),n&&n({...s,name:E.name})}catch(e){h(e.message||"名前の更新に失敗しました")}finally{r(!1)}}else h("新しい名前を入力してください")},disabled:a||!E.name||E.name===(null==s?void 0:s.name),className:"btn-primary px-4 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[R.jsx(w,{className:"w-4 h-4"}),"更新"]})]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-2",children:"📧 メールアドレス"}),R.jsxs("div",{className:"flex gap-3",children:[R.jsxs("div",{className:"flex-1 relative",children:[R.jsx(l,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-purple-500"}),R.jsx("input",{type:"email",value:E.email,onChange:e=>C({...E,email:e.target.value}),className:"input-field pl-11",placeholder:"新しいメールアドレス"})]}),R.jsxs("button",{onClick:async()=>{if(E.email&&E.email!==(null==s?void 0:s.email)){r(!0),h(null),m(null);try{const{error:e}=await $.auth.updateUser({email:E.email});if(e)throw e;m(`新しいメールアドレス（${E.email}）に確認メールを送信しました。メール内のリンクをクリックして変更を完了してください。現在のメールアドレスは変更されていません。`),C({...E,email:(null==s?void 0:s.email)||""})}catch(e){h(e.message||"メールアドレスの更新に失敗しました")}finally{r(!1)}}else h("新しいメールアドレスを入力してください")},disabled:a||!E.email||E.email===(null==s?void 0:s.email),className:"btn-primary px-4 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[R.jsx(w,{className:"w-4 h-4"}),"更新"]})]}),R.jsx("p",{className:"text-xs text-purple-600 mt-2",children:"※ メールアドレス変更後は確認メールで認証が必要です"})]})]})]}),R.jsxs("div",{className:"space-y-4",children:[R.jsxs("h3",{className:"text-xl font-bold text-purple-700 flex items-center gap-2",children:[R.jsx(c,{className:"w-6 h-6"}),"パスワード変更"]}),R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-2",children:"🔒 現在のパスワード"}),R.jsxs("div",{className:"relative",children:[R.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-purple-500"}),R.jsx("input",{type:x?"text":"password",value:E.currentPassword,onChange:e=>C({...E,currentPassword:e.target.value}),className:"input-field pl-11 pr-11",placeholder:"現在のパスワード"}),R.jsx("button",{type:"button",onClick:()=>v(!x),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-purple-500 hover:text-purple-700",children:x?R.jsx(g,{className:"w-5 h-5"}):R.jsx(b,{className:"w-5 h-5"})})]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-2",children:"🆕 新しいパスワード"}),R.jsxs("div",{className:"relative",children:[R.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-purple-500"}),R.jsx("input",{type:y?"text":"password",value:E.newPassword,onChange:e=>C({...E,newPassword:e.target.value}),className:"input-field pl-11 pr-11",placeholder:"新しいパスワード（6文字以上）"}),R.jsx("button",{type:"button",onClick:()=>j(!y),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-purple-500 hover:text-purple-700",children:y?R.jsx(g,{className:"w-5 h-5"}):R.jsx(b,{className:"w-5 h-5"})})]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-bold text-purple-700 mb-2",children:"✅ パスワード確認"}),R.jsxs("div",{className:"relative",children:[R.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-purple-500"}),R.jsx("input",{type:N?"text":"password",value:E.confirmPassword,onChange:e=>C({...E,confirmPassword:e.target.value}),className:"input-field pl-11 pr-11",placeholder:"新しいパスワードを再入力"}),R.jsx("button",{type:"button",onClick:()=>k(!N),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-purple-500 hover:text-purple-700",children:N?R.jsx(g,{className:"w-5 h-5"}):R.jsx(b,{className:"w-5 h-5"})})]})]}),R.jsxs("button",{onClick:async()=>{if(E.currentPassword&&E.newPassword&&E.confirmPassword)if(E.newPassword===E.confirmPassword)if(E.newPassword.length<6)h("新しいパスワードは6文字以上で入力してください");else{r(!0),h(null),m(null);try{const{error:e}=await $.auth.signInWithPassword({email:(null==s?void 0:s.email)||"",password:E.currentPassword});if(e)throw new Error("現在のパスワードが正しくありません");const{error:t}=await $.auth.updateUser({password:E.newPassword});if(t)throw t;m("パスワードが正常に更新されました"),C({...E,currentPassword:"",newPassword:"",confirmPassword:""})}catch(e){h(e.message||"パスワードの更新に失敗しました")}finally{r(!1)}}else h("新しいパスワードが一致しません");else h("すべてのパスワードフィールドを入力してください")},disabled:a||!E.currentPassword||!E.newPassword||!E.confirmPassword,className:"w-full btn-primary py-3 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[R.jsx(c,{className:"w-5 h-5"}),a?"更新中...":"🔐 パスワードを更新"]})]})]})]}),R.jsx("div",{className:"mt-8 pt-6 border-t border-purple-200 flex justify-center gap-4",children:R.jsx("button",{onClick:t,className:"btn-secondary px-8 py-3",children:"🔙 閉じる"})})]})})},Q=s.lazy(()=>r(()=>import("./ParentDashboard-9b3c3e20.js"),["assets/ParentDashboard-9b3c3e20.js","assets/supabase-c91fe37d.js","assets/vendor-18e24f2a.js","assets/database-c6017a67.js","assets/dateUtils-d91f8443.js","assets/icons-61d3c260.js","assets/routing-3469486c.js"])),ee=s.lazy(()=>r(()=>import("./ChildDashboard-099cc47b.js"),["assets/ChildDashboard-099cc47b.js","assets/supabase-c91fe37d.js","assets/vendor-18e24f2a.js","assets/database-c6017a67.js","assets/icons-61d3c260.js","assets/routing-3469486c.js"])),te=()=>{const{user:t,logout:s}=Y(),[n,a]=e.useState(!1);return t?R.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50",children:[R.jsx("header",{className:"bg-white shadow-sm border-b",children:R.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:R.jsxs("div",{className:"flex justify-between items-center h-16",children:[R.jsxs("div",{className:"flex items-center gap-3",children:[R.jsx("div",{className:"w-8 h-8 bg-primary-500 rounded-full flex items-center justify-center",children:R.jsx(o,{className:"w-4 h-4 text-white"})}),R.jsxs("div",{children:[R.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"🏰 おこづかいクエスト"}),R.jsxs("p",{className:"text-sm text-gray-600",children:[t.name,"さん (","PARENT"===t.role?"保護者":"お子様",")"]})]})]}),R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx(Z,{}),R.jsxs("button",{onClick:()=>a(!0),className:"flex items-center gap-2 px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors",title:"アカウント設定",children:[R.jsx(v,{className:"w-4 h-4"}),R.jsx("span",{className:"hidden md:inline",children:"設定"})]}),R.jsxs("button",{onClick:s,className:"flex items-center gap-2 px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors",children:[R.jsx(y,{className:"w-4 h-4"}),R.jsx("span",{className:"hidden md:inline",children:"ログアウト"})]})]})]})})}),R.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:R.jsx(e.Suspense,{fallback:R.jsx("div",{className:"flex items-center justify-center h-64",children:R.jsxs("div",{className:"text-center",children:[R.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-purple-500 border-t-transparent mx-auto mb-4"}),R.jsx("p",{className:"text-purple-600 text-lg font-medium",children:"ダッシュボードを読み込み中..."})]})}),children:"PARENT"===t.role?R.jsx(Q,{}):R.jsx(ee,{})})}),n&&R.jsx(K,{onClose:()=>a(!1)})]}):null};var se=Object.defineProperty,ne=(e,t,s)=>(((e,t,s)=>{t in e?se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class ae extends e.Component{constructor(e){super(e),ne(this,"handleReload",()=>{window.location.reload()}),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?R.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-pink-50 flex items-center justify-center p-4",children:R.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl p-8 w-full max-w-md text-center",children:[R.jsx("div",{className:"text-red-500 mb-4",children:R.jsx(j,{className:"w-16 h-16 mx-auto"})}),R.jsx("h1",{className:"text-2xl font-bold text-red-800 mb-4",children:"エラーが発生しました"}),R.jsx("p",{className:"text-gray-600 mb-6",children:"アプリの読み込み中に問題が発生しました。 ページを再読み込みして再試行してください。"}),R.jsxs("button",{onClick:this.handleReload,className:"w-full bg-gradient-to-r from-red-500 to-pink-500 text-white font-bold py-3 px-6 rounded-2xl hover:shadow-lg transition-all flex items-center justify-center gap-2",children:[R.jsx(N,{className:"w-5 h-5"}),"ページを再読み込み"]}),!1]})}):this.props.children}}const re=()=>{const[t,s]=e.useState(null),[n,a]=e.useState(!1),[r,i]=e.useState(!1);e.useEffect(()=>{if(window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone||localStorage.getItem("pwa-prompt-dismissed"))return;const e=e=>{e.preventDefault(),s(e),a(!0)};window.addEventListener("beforeinstallprompt",e);const t=/iPad|iPhone|iPod/.test(navigator.userAgent),n=window.navigator.standalone;return!t||n||localStorage.getItem("pwa-prompt-dismissed")||setTimeout(()=>a(!0),5e3),()=>{window.removeEventListener("beforeinstallprompt",e)}},[]);const o=()=>{a(!1),i(!0),localStorage.setItem("pwa-prompt-dismissed","true")},l=/iPad|iPhone|iPod/.test(navigator.userAgent);return!n||r?null:R.jsx("div",{className:"fixed bottom-4 left-4 right-4 z-50 md:left-auto md:right-4 md:max-w-sm",children:R.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-2xl shadow-2xl p-4",children:R.jsxs("div",{className:"flex items-start gap-3",children:[R.jsx("div",{className:"bg-white bg-opacity-20 rounded-full p-2",children:R.jsx(k,{className:"w-6 h-6"})}),R.jsxs("div",{className:"flex-1",children:[R.jsx("h3",{className:"font-bold text-lg mb-1",children:"アプリをインストール"}),R.jsx("p",{className:"text-sm opacity-90 mb-3",children:l?"このアプリをホーム画面に追加して、より便利にご利用ください。":"アプリをインストールして、オフラインでも使用できるようにしましょう。"}),l?R.jsx("div",{className:"text-xs opacity-80 mb-3",children:R.jsx("p",{children:"📱 Safari で「共有」→「ホーム画面に追加」をタップ"})}):null,R.jsxs("div",{className:"flex gap-2",children:[!l&&R.jsxs("button",{onClick:async()=>{t&&(t.prompt(),await t.userChoice,s(null),a(!1))},className:"flex-1 bg-white text-purple-600 font-bold py-2 px-4 rounded-lg flex items-center justify-center gap-2 hover:bg-gray-100 transition-colors",children:[R.jsx(E,{className:"w-4 h-4"}),"インストール"]}),R.jsx("button",{onClick:o,className:"bg-white bg-opacity-20 hover:bg-opacity-30 text-white font-medium py-2 px-4 rounded-lg transition-colors",children:"後で"})]})]}),R.jsx("button",{onClick:o,className:"text-white text-opacity-70 hover:text-opacity-100 transition-colors",children:R.jsx(p,{className:"w-5 h-5"})})]})})})},ie=()=>{const e=navigator.userAgent,t=/iPad|iPhone|iPod/.test(e),s=t&&/Safari/.test(e)&&!/CriOS|FxiOS/.test(e),n=e.match(/OS (\d+)_(\d+)_?(\d+)?/),a=n?`${n[1]}.${n[2]}${n[3]?"."+n[3]:""}`:"Unknown",r=window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone,i=parseInt(a.split(".")[0]),o=parseInt(a.split(".")[1]);return{isIOS:t,isiOSSafari:s,version:a,isPWAInstalled:r,supportsServiceWorker:i>14||14===i&&o>=3}},oe=()=>{const e=ie();if(e.isIOS){if(e.isiOSSafari){const e=()=>{const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`)};e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",()=>{setTimeout(e,100)});const t=()=>{const e=document.activeElement;!e||"INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName||setTimeout(()=>{e.scrollIntoView({behavior:"smooth",block:"center"})},300)};document.addEventListener("focusin",t),document.documentElement.style.webkitOverflowScrolling="touch"}e.isiOSSafari&&!e.isPWAInstalled&&setTimeout(()=>{(()=>{const e=ie();if(!e.isIOS||e.isPWAInstalled)return;const t=document.createElement("div");if(t.className="ios-install-prompt",t.style.cssText="\n    position: fixed;\n    bottom: 20px;\n    left: 20px;\n    right: 20px;\n    background: linear-gradient(135deg, #007AFF 0%, #0051D5 100%);\n    color: white;\n    padding: 16px;\n    border-radius: 12px;\n    box-shadow: 0 8px 32px rgba(0,122,255,0.3);\n    z-index: 10000;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n    animation: slideUp 0.3s ease-out;\n  ",t.innerHTML='\n    <div style="display: flex; align-items: center; gap: 12px;">\n      <div style="font-size: 24px;">📱</div>\n      <div style="flex: 1;">\n        <div style="font-weight: 600; margin-bottom: 4px;">アプリをインストール</div>\n        <div style="font-size: 14px; opacity: 0.9;">\n          Safariの共有ボタン → 「ホーム画面に追加」\n        </div>\n      </div>\n      <button onclick="this.parentElement.parentElement.remove()" style="\n        background: rgba(255,255,255,0.2);\n        border: none;\n        color: white;\n        width: 32px;\n        height: 32px;\n        border-radius: 16px;\n        cursor: pointer;\n        font-size: 18px;\n      ">×</button>\n    </div>\n  ',!document.querySelector("#ios-install-styles")){const e=document.createElement("style");e.id="ios-install-styles",e.textContent="\n      @keyframes slideUp {\n        from { transform: translateY(100%); opacity: 0; }\n        to { transform: translateY(0); opacity: 1; }\n      }\n    ",document.head.appendChild(e)}document.body.appendChild(t),setTimeout(()=>{t.parentNode&&(t.style.animation="slideUp 0.3s ease-out reverse",setTimeout(()=>t.remove(),300))},1e4)})()},3e3)}},le=()=>{const e=window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone||document.referrer.includes("android-app://");return{isInstalled:e,supportsPWA:"serviceWorker"in navigator,hasNotificationSupport:"Notification"in window,hasVibrationSupport:"vibrate"in navigator,isStandalone:e}},ce=()=>{"vibrate"in navigator&&navigator.vibrate(10)},de=()=>{"vibrate"in navigator&&navigator.vibrate(25)},me=()=>{"vibrate"in navigator&&navigator.vibrate([25,25,25])},ue=e=>{let t=0,s=0,n=!1,a=null;if(document.addEventListener("touchstart",e=>{0===window.scrollY&&(t=e.touches[0].clientY,n=!0,a||(a=(()=>{const e=document.createElement("div");return e.style.cssText="\n      position: fixed;\n      top: -60px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 40px;\n      height: 40px;\n      background: white;\n      border-radius: 20px;\n      box-shadow: 0 2px 12px rgba(0,0,0,0.15);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 9999;\n      transition: transform 0.3s ease;\n    ",e.innerHTML="🔄",document.body.appendChild(e),e})()))},{passive:!1}),document.addEventListener("touchmove",e=>{if(!n)return;s=e.touches[0].clientY;const r=Math.max(0,s-t);if(r>0&&0===window.scrollY&&(e.preventDefault(),a)){const e=Math.min(r/100,1);a.style.transform=`translateX(-50%) translateY(${.5*r}px) rotate(${360*e}deg)`}},{passive:!1}),document.addEventListener("touchend",()=>{if(!n)return;n=!1,s-t>100?(de(),a&&(a.style.animation="spin 1s linear infinite"),e().finally(()=>{a&&(a.style.transform="translateX(-50%) translateY(-60px)",setTimeout(()=>{null==a||a.remove(),a=null},300))})):a&&(a.style.transform="translateX(-50%) translateY(-60px)",setTimeout(()=>{null==a||a.remove(),a=null},300))}),!document.querySelector("#pull-refresh-styles")){const e=document.createElement("style");e.id="pull-refresh-styles",e.textContent="\n      @keyframes spin {\n        from { transform: translateX(-50%) rotate(0deg); }\n        to { transform: translateX(-50%) rotate(360deg); }\n      }\n    ",document.head.appendChild(e)}},pe=()=>{if(le().isInstalled)return;const e=/iPad|iPhone|iPod/.test(navigator.userAgent),t=/Android/.test(navigator.userAgent);if(!e&&!t)return;((e,t,s)=>{const n=document.createElement("div");n.className="mobile-modal-overlay",n.style.cssText="\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.5);\n    z-index: 10000;\n    backdrop-filter: blur(4px);\n    animation: fadeIn 0.2s ease-out;\n  ";const a=document.createElement("div");a.className="mobile-modal",a.style.cssText="\n    position: fixed;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    background: white;\n    border-radius: 16px 16px 0 0;\n    padding: 24px;\n    max-height: 70vh;\n    overflow-y: auto;\n    animation: slideUp 0.3s ease-out;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n  ",a.innerHTML=`\n    <div style="width: 40px; height: 4px; background: #e0e0e0; border-radius: 2px; margin: 0 auto 16px;"></div>\n    <h3 style="font-size: 18px; font-weight: 600; margin: 0 0 12px; color: #333;">${e}</h3>\n    <p style="font-size: 16px; color: #666; margin: 0 0 24px; line-height: 1.5;">${t}</p>\n    <div class="modal-actions" style="display: flex; flex-direction: column; gap: 12px;"></div>\n  `;const r=a.querySelector(".modal-actions");s.forEach(e=>{const t=document.createElement("button");t.textContent=e.text,t.style.cssText=`\n      padding: 16px;\n      border: none;\n      border-radius: 12px;\n      font-size: 16px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.2s ease;\n      ${"danger"===e.style?"background: #ff3b30; color: white;":"primary"===e.style?"background: #007aff; color: white;":"background: #f2f2f7; color: #007aff;"}\n    `,t.addEventListener("click",()=>{ce(),e.action(),i()}),r.appendChild(t)});const i=()=>{n.style.animation="fadeIn 0.2s ease-out reverse",a.style.animation="slideUp 0.3s ease-out reverse",setTimeout(()=>n.remove(),300)};if(n.addEventListener("click",e=>{e.target===n&&i()}),n.appendChild(a),document.body.appendChild(n),!document.querySelector("#mobile-modal-styles")){const e=document.createElement("style");e.id="mobile-modal-styles",e.textContent="\n      @keyframes fadeIn {\n        from { opacity: 0; }\n        to { opacity: 1; }\n      }\n      @keyframes slideUp {\n        from { transform: translateY(100%); }\n        to { transform: translateY(0); }\n      }\n    ",document.head.appendChild(e)}})("📱 アプリをインストール",`このアプリをホーム画面に追加して、ネイティブアプリのように使いませんか？\n\n${e?"1. 画面下部の共有ボタン（□↑）をタップ\n2. 「ホーム画面に追加」を選択\n3. 「追加」をタップ":"1. メニューから「ホーム画面に追加」を選択\n2. 「インストール」をタップ"}`,[{text:"後で",action:()=>{localStorage.setItem("install-prompt-dismissed",(Date.now()+864e5).toString())}},{text:"インストール方法を見る",action:()=>{me()},style:"primary"}])},he=()=>{const{user:t,loading:s}=Y();return e.useEffect(()=>{(async()=>{if("serviceWorker"in navigator)try{const e=`/sw.js?v=${Date.now()}`,t=await navigator.serviceWorker.register(e);return t.addEventListener("updatefound",()=>{const e=t.installing;e&&e.addEventListener("statechange",()=>{"installed"===e.state&&navigator.serviceWorker.controller&&H()})}),navigator.serviceWorker.addEventListener("message",e=>{e.data&&e.data.type}),setInterval(()=>{t.active&&t.active.postMessage({type:"CLEANUP_CACHE"})},18e5),t}catch(e){return null}})(),((e,t)=>{const s=()=>{null==t||t()};window.addEventListener("online",()=>{null==e||e()}),window.addEventListener("offline",s),navigator.onLine||s()})(()=>{},()=>{}),(()=>{if("performance"in window&&"PerformanceObserver"in window)try{new PerformanceObserver(e=>{e.getEntries().forEach(e=>{})}).observe({entryTypes:["paint","navigation","resource"]})}catch(e){}})(),oe(),(()=>{const e=le();ue(async()=>{window.location.reload()});const t=localStorage.getItem("install-prompt-dismissed");(!t||Date.now()>parseInt(t))&&setTimeout(()=>{pe()},5e3),document.addEventListener("click",e=>{const t=e.target;("BUTTON"===t.tagName||t.closest("button"))&&ce()})})(),t&&(async()=>{if("Notification"in window)return"granted"===await Notification.requestPermission()})()},[t]),s?R.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-400 via-pink-500 to-red-500",children:R.jsxs("div",{className:"text-center",children:[R.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-white border-t-transparent mx-auto mb-4"}),R.jsx("p",{className:"text-white text-lg font-medium",children:"読み込み中..."})]})}):R.jsxs(R.Fragment,{children:[t?R.jsx(J,{children:R.jsx(te,{})}):R.jsx(G,{}),R.jsx(re,{})]})},xe=()=>R.jsx(ae,{children:R.jsx(B,{children:R.jsx(he,{})})});(()=>{const e=z(),t=document.documentElement;Object.entries(e).forEach(([e,s])=>{t.classList.add(s?e:`no-${e}`)})})(),z();const fe=(()=>{const e=z(),t=[];e.promises||t.push("promises"),e.fetch||t.push("fetch"),e.localStorage||t.push("localStorage");const s=navigator.userAgent;let n="Unknown",a="Unknown",r="Unknown";if(s.includes("Chrome")){n="Chrome";const e=s.match(/Chrome\/(\d+)/);a=e?e[1]:"Unknown",r="Blink"}else if(s.includes("Firefox")){n="Firefox";const e=s.match(/Firefox\/(\d+)/);a=e?e[1]:"Unknown",r="Gecko"}else if(s.includes("Safari")&&!s.includes("Chrome")){n="Safari";const e=s.match(/Version\/(\d+)/);a=e?e[1]:"Unknown",r="WebKit"}else if(s.includes("Edge")){n="Edge";const e=s.match(/Edge\/(\d+)/);a=e?e[1]:"Unknown",r="EdgeHTML"}return{compatible:0===t.length,missingFeatures:t,browserInfo:{name:n,version:a,engine:r}}})();if(!fe.compatible){const e=fe.missingFeatures.filter(e=>["fetch","promises","localStorage"].includes(e));if(e.length>0){const t=`このブラウザは一部の機能をサポートしていません: ${e.join(", ")}。最新のブラウザをご使用ください。`,s=document.createElement("div");s.innerHTML=`\n      <div style="\n        background-color: #fef3cd;\n        border: 1px solid #ffeaa7;\n        color: #856404;\n        padding: 12px;\n        text-align: center;\n        font-family: system-ui, -apple-system, sans-serif;\n        font-size: 14px;\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        z-index: 9999;\n        box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n      ">\n        <strong>ブラウザ互換性の警告:</strong> ${t}\n        <button onclick="this.parentElement.style.display='none'" style="\n          background: none;\n          border: none;\n          color: #856404;\n          font-weight: bold;\n          margin-left: 10px;\n          cursor: pointer;\n        ">×</button>\n      </div>\n    `,document.body.insertBefore(s,document.body.firstChild)}}window.addEventListener("error",e=>{if(e.error&&"ChunkLoadError"===e.error.name){confirm("アプリケーションの読み込みでエラーが発生しました。ページを再読み込みしますか？")&&window.location.reload()}}),window.addEventListener("unhandledrejection",e=>{var t;if(e.preventDefault(),e.reason&&"object"==typeof e.reason&&("ChunkLoadError"===e.reason.name||(null==(t=e.reason.message)?void 0:t.includes("Loading chunk")))){confirm("アプリケーションの更新中にエラーが発生しました。ページを再読み込みしますか？")&&window.location.reload()}}),"performance"in window&&performance.mark&&performance.mark("app-start");const we=M.createRoot(document.getElementById("root"));try{we.render(R.jsx(s.StrictMode,{children:R.jsx(n,{children:R.jsx(xe,{})})})),"performance"in window&&performance.mark&&(performance.mark("app-rendered"),performance.measure("app-startup","app-start","app-rendered"))}catch(ge){const e='\n    <div style="\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      min-height: 100vh;\n      font-family: system-ui, -apple-system, sans-serif;\n      text-align: center;\n      padding: 20px;\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n    ">\n      <h1 style="margin-bottom: 20px;">アプリケーションエラー</h1>\n      <p style="margin-bottom: 30px; max-width: 500px; line-height: 1.6;">\n        申し訳ございませんが、アプリケーションの読み込み中にエラーが発生しました。\n        ブラウザを更新するか、しばらく時間をおいてから再度お試しください。\n      </p>\n      <button onclick="window.location.reload()" style="\n        background: white;\n        color: #667eea;\n        border: none;\n        padding: 12px 24px;\n        border-radius: 6px;\n        font-size: 16px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: transform 0.2s;\n      " onmouseover="this.style.transform=\'scale(1.05)\'" onmouseout="this.style.transform=\'scale(1)\'">\n        ページを再読み込み\n      </button>\n    </div>\n  ';document.getElementById("root").innerHTML=e}export{R as j,$ as s,Y as u};
