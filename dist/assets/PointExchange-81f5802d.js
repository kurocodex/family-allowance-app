import{u as k,j as e}from"./index-b8b8b179.js";import{r as i}from"./vendor-ce4ffebd.js";import{s as x}from"./storage-8020bd0d.js";import{c as E}from"./dateUtils-280973c0.js";import{W as D,e as A,o as I,D as C,p as H,H as M}from"./icons-09cb8d8e.js";import"./routing-89dfa7f7.js";import"./supabase-e6e84841.js";const q=()=>{k();const[m,P]=i.useState([]),[d,f]=i.useState(""),[r,g]=i.useState(100),[a]=i.useState({pointsPerYen:10,minimumExchange:100}),[o,p]=i.useState("exchange"),[b,$]=i.useState({});i.useEffect(()=>{S()},[]),i.useEffect(()=>{v()},[m]);const S=()=>{const t=x.getUsers().filter(s=>s.role==="CHILD");P(t),t.length>0&&!d&&f(t[0].id)},v=()=>{const t={};m.forEach(s=>{const l=x.getPointTransactions().filter(c=>c.userId===s.id),h=l.filter(c=>c.type==="EARNED").reduce((c,N)=>c+N.amount,0),j=l.filter(c=>c.type==="EXCHANGED").reduce((c,N)=>c+N.amount,0),B=h-j,Y=Math.floor(j/a.pointsPerYen);t[s.id]={totalEarned:h,totalSpent:j,currentBalance:B,totalExchanged:Y}}),$(t)},T=()=>{if(!d||r<a.minimumExchange)return;const t=b[d];if(!t||t.currentBalance<r){alert("æ®‹é«˜ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚");return}const s=Math.floor(r/a.pointsPerYen);if(confirm(`${r}ãƒã‚¤ãƒ³ãƒˆã‚’${s}å††ã«äº¤æ›ã—ã¾ã™ã‹ï¼Ÿ`)){const l=x.getPointTransactions(),h={id:x.generateId(),userId:d,type:"EXCHANGED",amount:r,description:`ãƒã‚¤ãƒ³ãƒˆäº¤æ›: ${r}pt â†’ ${s}å††`,createdAt:new Date};l.push(h),x.savePointTransactions(l),v(),g(a.minimumExchange),alert(`äº¤æ›å®Œäº†ï¼${s}å††ã‚’ãŠæ¸¡ã—ã—ã¦ãã ã•ã„ã€‚`)}},y=t=>x.getPointTransactions().filter(s=>s.userId===t&&s.type==="EXCHANGED").sort((s,l)=>new Date(l.createdAt).getTime()-new Date(s.createdAt).getTime()),n=b[d],w=Math.floor(r/a.pointsPerYen),u=r>=a.minimumExchange&&n&&n.currentBalance>=r;return m.length===0?e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(D,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-bold text-gray-700 mb-2",children:"ã¾ã ãŠå­æ§˜ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“"}),e.jsx("p",{className:"text-gray-500",children:"ãƒã‚¤ãƒ³ãƒˆäº¤æ›ã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯ã€ã¾ãšãŠå­æ§˜ã‚’ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-purple-800",children:"ğŸ’° ãƒã‚¤ãƒ³ãƒˆäº¤æ›ã‚·ã‚¹ãƒ†ãƒ "}),e.jsxs("div",{className:"flex items-center gap-3 bg-gradient-to-r from-green-100 to-blue-100 px-4 py-2 rounded-full border-2 border-green-300",children:[e.jsx(A,{className:"w-6 h-6 text-green-600"}),e.jsxs("span",{className:"font-bold text-green-800",children:[a.pointsPerYen,"ãƒã‚¤ãƒ³ãƒˆ = 1å††"]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ğŸ‘§ ãŠå­æ§˜ã‚’é¸æŠ"}),e.jsx("select",{value:d,onChange:t=>f(t.target.value),className:"input-field max-w-md",children:m.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.birthDate?`${E(t.birthDate)}æ­³`:`${t.age||0}æ­³`,")"]},t.id))})]}),n&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"p-4 bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl border-2 border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-600 text-sm font-medium",children:"ç²å¾—ç·ãƒã‚¤ãƒ³ãƒˆ"}),e.jsx("p",{className:"text-2xl font-bold text-blue-800",children:n.totalEarned})]})]})}),e.jsx("div",{className:"p-4 bg-gradient-to-br from-green-50 to-green-100 rounded-2xl border-2 border-green-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(D,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-green-600 text-sm font-medium",children:"ç¾åœ¨ã®æ®‹é«˜"}),e.jsx("p",{className:"text-2xl font-bold text-green-800",children:n.currentBalance})]})]})}),e.jsx("div",{className:"p-4 bg-gradient-to-br from-red-50 to-red-100 rounded-2xl border-2 border-red-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{className:"w-8 h-8 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-600 text-sm font-medium",children:"ä½¿ç”¨ãƒã‚¤ãƒ³ãƒˆ"}),e.jsx("p",{className:"text-2xl font-bold text-red-800",children:n.totalSpent})]})]})}),e.jsx("div",{className:"p-4 bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-2xl border-2 border-yellow-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(C,{className:"w-8 h-8 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-yellow-600 text-sm font-medium",children:"äº¤æ›ç·é‡‘é¡"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-800",children:["Â¥",n.totalExchanged]})]})]})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx("button",{onClick:()=>p("exchange"),className:`px-6 py-3 rounded-full font-bold transition-all ${o==="exchange"?"bg-gradient-to-r from-green-500 to-blue-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"ğŸ’± ãƒã‚¤ãƒ³ãƒˆäº¤æ›"}),e.jsx("button",{onClick:()=>p("history"),className:`px-6 py-3 rounded-full font-bold transition-all ${o==="history"?"bg-gradient-to-r from-green-500 to-blue-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"ğŸ“œ äº¤æ›å±¥æ­´"}),e.jsx("button",{onClick:()=>p("balance"),className:`px-6 py-3 rounded-full font-bold transition-all ${o==="balance"?"bg-gradient-to-r from-green-500 to-blue-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"ğŸ’° å…¨ä½“æ®‹é«˜"})]}),o==="exchange"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-green-700 mb-6",children:"ğŸ’± ãƒã‚¤ãƒ³ãƒˆäº¤æ›"}),e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-lg font-bold text-green-700 mb-3",children:"äº¤æ›ã™ã‚‹ãƒã‚¤ãƒ³ãƒˆæ•°"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:r,onChange:t=>g(parseInt(t.target.value)||0),className:"input-field text-center text-2xl pr-16",min:a.minimumExchange,step:a.pointsPerYen,placeholder:"100"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-green-600 font-bold",children:"pt"})]}),e.jsxs("p",{className:"text-sm text-green-600 mt-2 text-center",children:["æœ€å°äº¤æ›: ",a.minimumExchange,"ãƒã‚¤ãƒ³ãƒˆ"]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-3xl font-bold text-green-600",children:[r,"pt"]}),e.jsx("div",{className:"text-sm text-green-700",children:"ãƒã‚¤ãƒ³ãƒˆ"})]}),e.jsx(H,{className:"w-8 h-8 text-gray-400"}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-3xl font-bold text-blue-600",children:["Â¥",w]}),e.jsx("div",{className:"text-sm text-blue-700",children:"å††"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-yellow-50 rounded-lg border border-yellow-200",children:e.jsxs("p",{className:"text-yellow-800 text-sm",children:[e.jsx("strong",{children:"æ³¨æ„:"})," äº¤æ›ã—ãŸãƒã‚¤ãƒ³ãƒˆã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚"]})}),e.jsx("button",{onClick:T,disabled:!u,className:`w-full py-4 px-6 rounded-2xl font-bold text-lg transition-all ${u?"bg-gradient-to-r from-green-500 to-blue-500 text-white hover:shadow-lg":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:u?`ğŸ’° ${w}å††ã«äº¤æ›ã™ã‚‹`:r<a.minimumExchange?`æœ€å°${a.minimumExchange}ãƒã‚¤ãƒ³ãƒˆå¿…è¦`:"æ®‹é«˜ãŒä¸è¶³ã—ã¦ã„ã¾ã™"})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-3 text-center",children:"ã‚¯ã‚¤ãƒƒã‚¯äº¤æ›"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[100,500,1e3].map(t=>{const s=Math.floor(t/a.pointsPerYen),l=n&&n.currentBalance>=t;return e.jsxs("button",{onClick:()=>g(t),disabled:!l,className:`p-3 rounded-lg text-sm font-medium transition-all ${l?"bg-blue-100 text-blue-700 hover:bg-blue-200":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:[t,"pt",e.jsx("br",{}),"Â¥",s]},t)})})]})]})]}),o==="history"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-blue-700 mb-6",children:"ğŸ“œ äº¤æ›å±¥æ­´"}),e.jsxs("div",{className:"space-y-3",children:[y(d).map(t=>{const s=Math.floor(t.amount/a.pointsPerYen);return e.jsx("div",{className:"p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(C,{className:"w-6 h-6 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gray-800",children:t.description}),e.jsxs("p",{className:"text-sm text-gray-600",children:[new Date(t.createdAt).toLocaleDateString("ja-JP")," ",new Date(t.createdAt).toLocaleTimeString("ja-JP")]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-red-600",children:["-",t.amount,"pt"]}),e.jsxs("p",{className:"text-sm font-bold text-green-600",children:["+Â¥",s]})]})]})},t.id)}),y(d).length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(M,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"ã¾ã äº¤æ›å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“"})]})]})]}),o==="balance"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-purple-700 mb-6",children:"ğŸ’° å…¨ä½“æ®‹é«˜"}),e.jsx("div",{className:"space-y-4",children:m.map(t=>{const s=b[t.id];return s?e.jsxs("div",{className:"p-6 bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl border-2 border-purple-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-xl font-bold text-purple-800",children:t.name}),e.jsx("p",{className:"text-purple-600",children:t.birthDate?`${E(t.birthDate)}æ­³`:`${t.age||0}æ­³`})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold text-purple-700",children:[s.currentBalance,"pt"]}),e.jsx("p",{className:"text-sm text-purple-600",children:"ç¾åœ¨ã®æ®‹é«˜"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-3 bg-white rounded-lg border border-purple-200",children:[e.jsx("p",{className:"text-xs text-purple-600 mb-1",children:"ç²å¾—ç·æ•°"}),e.jsxs("p",{className:"font-bold text-purple-800",children:[s.totalEarned,"pt"]})]}),e.jsxs("div",{className:"p-3 bg-white rounded-lg border border-purple-200",children:[e.jsx("p",{className:"text-xs text-purple-600 mb-1",children:"ä½¿ç”¨ç·æ•°"}),e.jsxs("p",{className:"font-bold text-red-600",children:[s.totalSpent,"pt"]})]}),e.jsxs("div",{className:"p-3 bg-white rounded-lg border border-purple-200",children:[e.jsx("p",{className:"text-xs text-purple-600 mb-1",children:"äº¤æ›ç·é¡"}),e.jsxs("p",{className:"font-bold text-green-600",children:["Â¥",s.totalExchanged]})]})]})]},t.id):null})})]})]})]})};export{q as default};
