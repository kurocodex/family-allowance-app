import{u as e,j as t}from"./index-9ea7fdb9.js";import{r as s}from"./vendor-18e24f2a.js";import{s as r}from"./storage-afc0bc2e.js";import{c as l}from"./dateUtils-d91f8443.js";import{W as a,k as n,u as d,v as i,w as c,H as x}from"./icons-61d3c260.js";import"./routing-3469486c.js";import"./supabase-c91fe37d.js";const o=({children:o})=>{e();const[m,h]=s.useState(""),[g,p]=s.useState(100),[b]=s.useState({pointsPerYen:10,minimumExchange:100}),[u,j]=s.useState("exchange"),[N,f]=s.useState({});s.useEffect(()=>{o.length>0&&!m&&h(o[0].id)},[o,m]),s.useEffect(()=>{v()},[o]);const v=()=>{const e={};o.forEach(t=>{const s=r.getPointTransactions().filter(e=>e.userId===t.id),l=s.filter(e=>"EARNED"===e.type).reduce((e,t)=>e+t.amount,0),a=s.filter(e=>"EXCHANGED"===e.type).reduce((e,t)=>e+t.amount,0),n=l-a,d=Math.floor(a/b.pointsPerYen);e[t.id]={totalEarned:l,totalSpent:a,currentBalance:n,totalExchanged:d}}),f(e)},y=e=>r.getPointTransactions().filter(t=>t.userId===e&&"EXCHANGED"===t.type).sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()),w=N[m],E=Math.floor(g/b.pointsPerYen),D=g>=b.minimumExchange&&w&&w.currentBalance>=g;return 0===o.length?t.jsxs("div",{className:"card text-center py-12",children:[t.jsx(a,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-bold text-gray-700 mb-2",children:"まだお子様が登録されていません"}),t.jsx("p",{className:"text-gray-500",children:"ポイント交換を利用するには、まずお子様を登録してください。"})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[t.jsx("h2",{className:"text-3xl font-bold text-purple-800",children:"💰 ポイント交換システム"}),t.jsxs("div",{className:"flex items-center gap-3 bg-gradient-to-r from-green-100 to-blue-100 px-4 py-2 rounded-full border-2 border-green-300",children:[t.jsx(n,{className:"w-6 h-6 text-green-600"}),t.jsxs("span",{className:"font-bold text-green-800",children:[b.pointsPerYen,"ポイント = 1円"]})]})]}),t.jsxs("div",{className:"card",children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"👧 お子様を選択"}),t.jsx("select",{value:m,onChange:e=>h(e.target.value),className:"input-field max-w-md",children:o.map(e=>t.jsxs("option",{value:e.id,children:[e.name," (",e.birthDate?`${l(e.birthDate)}歳`:`${e.age||0}歳`,")"]},e.id))})]}),w&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[t.jsx("div",{className:"p-4 bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl border-2 border-blue-200",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(n,{className:"w-8 h-8 text-blue-600"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-blue-600 text-sm font-medium",children:"獲得総ポイント"}),t.jsx("p",{className:"text-2xl font-bold text-blue-800",children:w.totalEarned})]})]})}),t.jsx("div",{className:"p-4 bg-gradient-to-br from-green-50 to-green-100 rounded-2xl border-2 border-green-200",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(a,{className:"w-8 h-8 text-green-600"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-green-600 text-sm font-medium",children:"現在の残高"}),t.jsx("p",{className:"text-2xl font-bold text-green-800",children:w.currentBalance})]})]})}),t.jsx("div",{className:"p-4 bg-gradient-to-br from-red-50 to-red-100 rounded-2xl border-2 border-red-200",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(d,{className:"w-8 h-8 text-red-600"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-red-600 text-sm font-medium",children:"使用ポイント"}),t.jsx("p",{className:"text-2xl font-bold text-red-800",children:w.totalSpent})]})]})}),t.jsx("div",{className:"p-4 bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-2xl border-2 border-yellow-200",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(i,{className:"w-8 h-8 text-yellow-600"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-yellow-600 text-sm font-medium",children:"交換総金額"}),t.jsxs("p",{className:"text-2xl font-bold text-yellow-800",children:["¥",w.totalExchanged]})]})]})})]})]}),t.jsxs("div",{className:"card",children:[t.jsxs("div",{className:"flex gap-2 mb-6",children:[t.jsx("button",{onClick:()=>j("exchange"),className:"px-6 py-3 rounded-full font-bold transition-all "+("exchange"===u?"bg-gradient-to-r from-green-500 to-blue-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"💱 ポイント交換"}),t.jsx("button",{onClick:()=>j("history"),className:"px-6 py-3 rounded-full font-bold transition-all "+("history"===u?"bg-gradient-to-r from-green-500 to-blue-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"📜 交換履歴"}),t.jsx("button",{onClick:()=>j("balance"),className:"px-6 py-3 rounded-full font-bold transition-all "+("balance"===u?"bg-gradient-to-r from-green-500 to-blue-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"💰 全体残高"})]}),"exchange"===u&&t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-bold text-green-700 mb-6",children:"💱 ポイント交換"}),t.jsxs("div",{className:"max-w-md mx-auto",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-lg font-bold text-green-700 mb-3",children:"交換するポイント数"}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"number",value:g,onChange:e=>p(parseInt(e.target.value)||0),className:"input-field text-center text-2xl pr-16",min:b.minimumExchange,step:b.pointsPerYen,placeholder:"100"}),t.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-green-600 font-bold",children:"pt"})]}),t.jsxs("p",{className:"text-sm text-green-600 mt-2 text-center",children:["最小交換: ",b.minimumExchange,"ポイント"]})]}),t.jsxs("div",{className:"flex items-center justify-center gap-4 mb-6",children:[t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"text-3xl font-bold text-green-600",children:[g,"pt"]}),t.jsx("div",{className:"text-sm text-green-700",children:"ポイント"})]}),t.jsx(c,{className:"w-8 h-8 text-gray-400"}),t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"text-3xl font-bold text-blue-600",children:["¥",E]}),t.jsx("div",{className:"text-sm text-blue-700",children:"円"})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"p-4 bg-yellow-50 rounded-lg border border-yellow-200",children:t.jsxs("p",{className:"text-yellow-800 text-sm",children:[t.jsx("strong",{children:"注意:"})," 交換したポイントは元に戻せません。"]})}),t.jsx("button",{onClick:()=>{if(!m||g<b.minimumExchange)return;const e=N[m];if(!e||e.currentBalance<g)return void alert("残高が不足しています。");const t=Math.floor(g/b.pointsPerYen);if(confirm(`${g}ポイントを${t}円に交換しますか？`)){const e=r.getPointTransactions(),s={id:r.generateId(),userId:m,type:"EXCHANGED",amount:g,description:`ポイント交換: ${g}pt → ${t}円`,createdAt:new Date};e.push(s),r.savePointTransactions(e),v(),p(b.minimumExchange),alert(`交換完了！${t}円をお渡ししてください。`)}},disabled:!D,className:"w-full py-4 px-6 rounded-2xl font-bold text-lg transition-all "+(D?"bg-gradient-to-r from-green-500 to-blue-500 text-white hover:shadow-lg":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:D?`💰 ${E}円に交換する`:g<b.minimumExchange?`最小${b.minimumExchange}ポイント必要`:"残高が不足しています"})]}),t.jsxs("div",{className:"mt-6",children:[t.jsx("p",{className:"text-sm font-medium text-gray-700 mb-3 text-center",children:"クイック交換"}),t.jsx("div",{className:"grid grid-cols-3 gap-2",children:[100,500,1e3].map(e=>{const s=Math.floor(e/b.pointsPerYen),r=w&&w.currentBalance>=e;return t.jsxs("button",{onClick:()=>p(e),disabled:!r,className:"p-3 rounded-lg text-sm font-medium transition-all "+(r?"bg-blue-100 text-blue-700 hover:bg-blue-200":"bg-gray-100 text-gray-400 cursor-not-allowed"),children:[e,"pt",t.jsx("br",{}),"¥",s]},e)})})]})]})]}),"history"===u&&t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-bold text-blue-700 mb-6",children:"📜 交換履歴"}),t.jsxs("div",{className:"space-y-3",children:[y(m).map(e=>{const s=Math.floor(e.amount/b.pointsPerYen);return t.jsx("div",{className:"p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg border border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(i,{className:"w-6 h-6 text-green-600"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-bold text-gray-800",children:e.description}),t.jsxs("p",{className:"text-sm text-gray-600",children:[new Date(e.createdAt).toLocaleDateString("ja-JP")," ",new Date(e.createdAt).toLocaleTimeString("ja-JP")]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("p",{className:"font-bold text-red-600",children:["-",e.amount,"pt"]}),t.jsxs("p",{className:"text-sm font-bold text-green-600",children:["+¥",s]})]})]})},e.id)}),0===y(m).length&&t.jsxs("div",{className:"text-center py-8",children:[t.jsx(x,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500",children:"まだ交換履歴がありません"})]})]})]}),"balance"===u&&t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-bold text-purple-700 mb-6",children:"💰 全体残高"}),t.jsx("div",{className:"space-y-4",children:o.map(e=>{const s=N[e.id];return s?t.jsxs("div",{className:"p-6 bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl border-2 border-purple-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-xl font-bold text-purple-800",children:e.name}),t.jsx("p",{className:"text-purple-600",children:e.birthDate?`${l(e.birthDate)}歳`:`${e.age||0}歳`})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("p",{className:"text-2xl font-bold text-purple-700",children:[s.currentBalance,"pt"]}),t.jsx("p",{className:"text-sm text-purple-600",children:"現在の残高"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"p-3 bg-white rounded-lg border border-purple-200",children:[t.jsx("p",{className:"text-xs text-purple-600 mb-1",children:"獲得総数"}),t.jsxs("p",{className:"font-bold text-purple-800",children:[s.totalEarned,"pt"]})]}),t.jsxs("div",{className:"p-3 bg-white rounded-lg border border-purple-200",children:[t.jsx("p",{className:"text-xs text-purple-600 mb-1",children:"使用総数"}),t.jsxs("p",{className:"font-bold text-red-600",children:[s.totalSpent,"pt"]})]}),t.jsxs("div",{className:"p-3 bg-white rounded-lg border border-purple-200",children:[t.jsx("p",{className:"text-xs text-purple-600 mb-1",children:"交換総額"}),t.jsxs("p",{className:"font-bold text-green-600",children:["¥",s.totalExchanged]})]})]})]},e.id):null})})]})]})]})};export{o as default};
