import{u as V,j as e}from"./index-c2744e47.js";import{r as m}from"./vendor-ce4ffebd.js";import{s as h}from"./storage-8020bd0d.js";import{c as Y}from"./dateUtils-280973c0.js";import{l as C,m as G,d as H,n as L,B as U,C as J}from"./icons-09cb8d8e.js";import"./routing-89dfa7f7.js";import"./supabase-e6e84841.js";const ee=()=>{V();const[x,v]=m.useState(""),[y,T]=m.useState([]),[a,E]=m.useState(null),[d,A]=m.useState("3months");m.useEffect(()=>{S()},[]),m.useEffect(()=>{x&&R(x)},[x,d]);const S=()=>{const s=h.getUsers().filter(r=>r.role==="CHILD");T(s),s.length>0&&!x&&v(s[0].id)},R=s=>{const r=h.getTasks(),i=h.getTaskCompletions().filter(t=>t.childId===s),c=h.getPointTransactions().filter(t=>t.userId===s);h.getEventResults().filter(t=>t.childId===s);const l=new Date,g=d==="1month"?1:d==="3months"?3:d==="6months"?6:999,w=new Date(l.getFullYear(),l.getMonth()-g,l.getDate()),p=d==="all"?i:i.filter(t=>new Date(t.submittedAt)>=w),P=d==="all"?c:c.filter(t=>new Date(t.createdAt)>=w),u=p.filter(t=>t.status==="APPROVED").length,M=p.filter(t=>t.status==="PENDING").length,j=p.length,b=P.filter(t=>t.type==="EARNED").reduce((t,n)=>t+n.amount,0),D=P.filter(t=>t.type==="EXCHANGED").reduce((t,n)=>t+n.amount,0),$=b-D,N={};p.filter(t=>t.status==="APPROVED").forEach(t=>{const n=r.find(f=>f.id===t.taskId);n&&(N[n.category]=(N[n.category]||0)+1)});const k=[];for(let t=g-1;t>=0;t--){const n=new Date(l.getFullYear(),l.getMonth()-t,1),f=new Date(l.getFullYear(),l.getMonth()-t+1,1),F=i.filter(o=>o.status==="APPROVED"&&new Date(o.submittedAt)>=n&&new Date(o.submittedAt)<f),I=c.filter(o=>o.type==="EARNED"&&new Date(o.createdAt)>=n&&new Date(o.createdAt)<f).reduce((o,B)=>o+B.amount,0);k.push({month:n.toLocaleDateString("ja-JP",{month:"short"}),completed:F.length,points:I})}const O={totalTasks:j,completedTasks:u,pendingTasks:M,totalPoints:$,earnedPoints:b,spentPoints:D,averagePointsPerTask:u>0?Math.round(b/u):0,categoryStats:N,monthlyProgress:k,completionRate:j>0?Math.round(u/j*100):0};E(O)};return y.length===0?e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(C,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-bold text-gray-700 mb-2",children:"まだお子様が登録されていません"}),e.jsx("p",{className:"text-gray-500",children:"統計を表示するには、まずお子様を登録してください。"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:e.jsx("h2",{className:"text-3xl font-bold text-purple-800",children:"📊 統計・レポート"})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"👧 お子様を選択"}),e.jsx("select",{value:x,onChange:s=>v(s.target.value),className:"input-field",children:y.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.birthDate?`${Y(s.birthDate)}歳`:`${s.age||0}歳`,")"]},s.id))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"📅 期間"}),e.jsxs("select",{value:d,onChange:s=>A(s.target.value),className:"input-field",children:[e.jsx("option",{value:"1month",children:"過去1ヶ月"}),e.jsx("option",{value:"3months",children:"過去3ヶ月"}),e.jsx("option",{value:"6months",children:"過去6ヶ月"}),e.jsx("option",{value:"all",children:"全期間"})]})]})]})}),a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(G,{className:"w-10 h-10 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-600 text-sm font-medium",children:"完了したクエスト"}),e.jsx("p",{className:"text-2xl font-bold text-blue-800",children:a.completedTasks})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{className:"w-10 h-10 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-green-600 text-sm font-medium",children:"現在の残高"}),e.jsx("p",{className:"text-2xl font-bold text-green-800",children:a.totalPoints})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{className:"w-10 h-10 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-600 text-sm font-medium",children:"達成率"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-800",children:[a.completionRate,"%"]})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(U,{className:"w-10 h-10 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-orange-600 text-sm font-medium",children:"平均ポイント/クエスト"}),e.jsx("p",{className:"text-2xl font-bold text-orange-800",children:a.averagePointsPerTask})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(J,{className:"w-8 h-8 text-blue-500"}),e.jsx("h3",{className:"text-xl font-bold text-blue-700",children:"📈 月次進捗"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-gray-700 mb-4",children:"完了したクエスト数"}),e.jsx("div",{className:"space-y-3",children:a.monthlyProgress.map((s,r)=>{const i=Math.max(...a.monthlyProgress.map(l=>l.completed),1),c=s.completed/i*100;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600 w-12",children:s.month}),e.jsxs("div",{className:"flex-1 bg-gray-200 rounded-full h-6 relative",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-400 to-blue-600 h-6 rounded-full transition-all",style:{width:`${c}%`}}),e.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-xs font-bold text-white",children:s.completed})]})]},r)})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-gray-700 mb-4",children:"獲得ポイント"}),e.jsx("div",{className:"space-y-3",children:a.monthlyProgress.map((s,r)=>{const i=Math.max(...a.monthlyProgress.map(l=>l.points),1),c=s.points/i*100;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600 w-12",children:s.month}),e.jsxs("div",{className:"flex-1 bg-gray-200 rounded-full h-6 relative",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-400 to-green-600 h-6 rounded-full transition-all",style:{width:`${c}%`}}),e.jsxs("span",{className:"absolute inset-0 flex items-center justify-center text-xs font-bold text-white",children:[s.points,"pt"]})]})]},r)})})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(C,{className:"w-8 h-8 text-purple-500"}),e.jsx("h3",{className:"text-xl font-bold text-purple-700",children:"📋 カテゴリ別実績"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[Object.entries(a.categoryStats).map(([s,r])=>{const i=Math.max(...Object.values(a.categoryStats),1),c=r/i*100,g={家事:"from-pink-400 to-pink-600",勉強:"from-blue-400 to-blue-600",運動:"from-green-400 to-green-600",その他:"from-gray-400 to-gray-600"}[s]||"from-purple-400 to-purple-600";return e.jsx("div",{className:"p-4 bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl border border-gray-200",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"font-bold text-gray-800 mb-2",children:s}),e.jsxs("div",{className:"relative w-20 h-20 mx-auto mb-3",children:[e.jsx("div",{className:"w-full h-full bg-gray-200 rounded-full"}),e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${g} rounded-full transition-all flex items-center justify-center`,style:{background:`conic-gradient(from 0deg, currentColor ${c*3.6}deg, transparent ${c*3.6}deg)`},children:e.jsx("div",{className:"bg-white rounded-full w-12 h-12 flex items-center justify-center",children:e.jsx("span",{className:"font-bold text-gray-800 text-sm",children:r})})})]}),e.jsx("p",{className:"text-xs text-gray-600",children:"完了数"})]})},s)}),Object.keys(a.categoryStats).length===0&&e.jsx("div",{className:"col-span-full text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"まだ完了したクエストがありません"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-6",children:"📊 詳細データ"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-bold text-gray-700",children:"クエスト実績"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-blue-50 rounded-lg",children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"完了したクエスト"}),e.jsxs("span",{className:"font-bold text-blue-800",children:[a.completedTasks,"個"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-yellow-50 rounded-lg",children:[e.jsx("span",{className:"text-yellow-700 font-medium",children:"確認待ちクエスト"}),e.jsxs("span",{className:"font-bold text-yellow-800",children:[a.pendingTasks,"個"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"合計クエスト"}),e.jsxs("span",{className:"font-bold text-gray-800",children:[a.totalTasks,"個"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-bold text-gray-700",children:"ポイント実績"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-blue-50 rounded-lg",children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"獲得総ポイント"}),e.jsxs("span",{className:"font-bold text-blue-800",children:[a.earnedPoints,"pt"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-red-50 rounded-lg",children:[e.jsx("span",{className:"text-red-700 font-medium",children:"使用ポイント"}),e.jsxs("span",{className:"font-bold text-red-800",children:[a.spentPoints,"pt"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-50 rounded-lg",children:[e.jsx("span",{className:"text-green-700 font-medium",children:"現在の残高"}),e.jsxs("span",{className:"font-bold text-green-800",children:[a.totalPoints,"pt"]})]})]})]})]})]})]})]})};export{ee as default};
